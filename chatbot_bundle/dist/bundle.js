/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={9418:(e,t,r)=>{"use strict";e=r.nmd(e);const n=(e=0)=>t=>`[${38+e};5;${t}m`,i=(e=0)=>(t,r,n)=>`[${38+e};2;${t};${r};${n}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,n]of Object.entries(t)){for(const[r,i]of Object.entries(n))t[r]={open:`[${i[0]}m`,close:`[${i[1]}m`},n[r]=t[r],e.set(i[0],i[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=n(),t.color.ansi16m=i(),t.bgColor.ansi256=n(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map((e=>e+e)).join(""));const n=Number.parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},2729:e=>{"use strict";const t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,s=new RegExp("^"+a.source),o=new RegExp(a.source+i.source,"gu"),l=new RegExp("\\d+"+i.source,"gu"),c=(e,i)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(i={pascalCase:!1,preserveConsecutiveUppercase:!1,...i},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const a=!1===i.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(i.locale),c=!1===i.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(i.locale);return 1===e.length?i.pascalCase?c(e):a(e):(e!==a(e)&&(e=((e,n,i)=>{let a=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];a&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),a=!1,o=s,s=!0,l++):s&&o&&r.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,a=!0):(a=n(c)===c&&i(c)!==c,o=s,s=i(c)===c&&n(c)!==c)}return e})(e,a,c)),e=e.replace(s,""),e=i.preserveConsecutiveUppercase?((e,t)=>(n.lastIndex=0,e.replace(n,(e=>t(e)))))(e,a):a(e),i.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,r)=>t(r))).replace(l,(e=>t(e)))))(e,c))};e.exports=c,e.exports.default=c},9478:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},228:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new i(n,a||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,i,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,a),!0;case 6:return u.fn.call(u.context,t,n,i,a,s),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||s(this,a);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||i&&!o[l].once||n&&o[l].context!==n)&&c.push(o[l]);c.length?this._events[a]=1===c.length?c[0]:c:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},4617:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},3290:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(228),i=r(6641),a=r(4774),s=()=>{},o=new i.TimeoutError;t.default=class extends n{constructor(e){var t,r,n,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,n)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const a=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(o)}));r(await a)}catch(e){n(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},9998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=0,i=e.length;for(;i>0;){const a=i/2|0;let s=n+a;r(e[s],t)<=0?(n=++s,i-=a+1):i=a}return n}},4774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9998);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const i=n.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(i,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},4116:(e,t,r)=>{"use strict";const n=r(5617),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class a extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((r,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=n.operation(t);o.attempt((async n=>{try{r(await e(n))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof a)o.stop(),s(e.originalError);else if(e instanceof TypeError&&(l=e.message,!i.includes(l)))o.stop(),s(e);else{((e,t,r)=>{const n=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=n})(e,n,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}o.retry(e)||s(o.mainError())}}var l}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=a},6641:(e,t,r)=>{"use strict";const n=r(4617);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}const a=(e,t,r)=>new Promise(((a,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);const o=setTimeout((()=>{if("function"==typeof r){try{a(r())}catch(e){s(e)}return}const n=r instanceof Error?r:new i("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(n)}),t);n(e.then(a,s),(()=>{clearTimeout(o)}))}));e.exports=a,e.exports.default=a,e.exports.TimeoutError=i},1020:(e,t,r)=>{"use strict";var n=r(1594),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:i,type:e,key:c,ref:u,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},4848:(e,t,r)=>{"use strict";e.exports=r(1020)},5617:(e,t,r)=>{e.exports=r(8303)},8303:(e,t,r)=>{var n=r(3961);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var a=0;a<n.length;a++){var s=n[a],o=e[s];e[s]=function(n){var i=t.operation(r),a=Array.prototype.slice.call(arguments,1),s=a.pop();a.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))})),i.attempt((function(){n.apply(e,a)}))}.bind(e,o),e[s].options=r}}},3961:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],a=i.message,s=(e[a]||0)+1;e[a]=s,s>=r&&(t=i,r=s)}return t}},3904:(e,t,r)=>{const n=Symbol("SemVer ANY");class i{static get ANY(){return n}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=i;const a=r(8587),{safeRe:s,t:o}=r(9718),l=r(2111),c=r(7272),u=r(3908),d=r(8311)},8311:(e,t,r)=>{const n=/\s+/g;class i{constructor(e,t){if(t=s(t),e instanceof i)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new i(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!y(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=a.get(t);if(r)return r;const n=this.options.loose,i=n?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];e=e.replace(i,I(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[d.COMPARATORTRIM],h),l("comparator trim",e),e=e.replace(u[d.TILDETRIM],p),l("tilde trim",e),e=e.replace(u[d.CARETTRIM],m),l("caret trim",e);let s=e.split(" ").map((e=>w(e,this.options))).join(" ").split(/\s+/).map((e=>A(e,this.options)));n&&(s=s.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE]))))),l("range list",s);const c=new Map,v=s.map((e=>new o(e,this.options)));for(const e of v){if(y(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const b=[...c.values()];return a.set(t,b),b}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Range is required");return this.set.some((r=>b(r,t)&&e.set.some((e=>b(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(C(this.set[t],e,this.options))return!0;return!1}}e.exports=i;const a=new(r(8794)),s=r(8587),o=r(3904),l=r(7272),c=r(3908),{safeRe:u,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:m}=r(9718),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=r(6874),y=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,b=(e,t)=>{let r=!0;const n=e.slice();let i=n.pop();for(;r&&n.length;)r=n.every((e=>i.intersects(e,t))),i=n.pop();return r},w=(e,t)=>(l("comp",e,t),e=T(e,t),l("caret",e),e=x(e,t),l("tildes",e),e=P(e,t),l("xrange",e),e=k(e,t),l("stars",e),e),_=e=>!e||"x"===e.toLowerCase()||"*"===e,x=(e,t)=>e.trim().split(/\s+/).map((e=>E(e,t))).join(" "),E=(e,t)=>{const r=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(r,((t,r,n,i,a)=>{let s;return l("tilde",e,t,r,n,i,a),_(r)?s="":_(n)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:_(i)?s=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:a?(l("replaceTilde pr",a),s=`>=${r}.${n}.${i}-${a} <${r}.${+n+1}.0-0`):s=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,l("tilde return",s),s}))},T=(e,t)=>e.trim().split(/\s+/).map((e=>S(e,t))).join(" "),S=(e,t)=>{l("caret",e,t);const r=t.loose?u[d.CARETLOOSE]:u[d.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,i,a,s)=>{let o;return l("caret",e,t,r,i,a,s),_(r)?o="":_(i)?o=`>=${r}.0.0${n} <${+r+1}.0.0-0`:_(a)?o="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===i?`>=${r}.${i}.${a}-${s} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}-${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===i?`>=${r}.${i}.${a}${n} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a} <${+r+1}.0.0-0`),l("caret return",o),o}))},P=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>O(e,t))).join(" ")),O=(e,t)=>{e=e.trim();const r=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(r,((r,n,i,a,s,o)=>{l("xRange",e,r,n,i,a,s,o);const c=_(i),u=c||_(a),d=u||_(s),h=d;return"="===n&&h&&(n=""),o=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&h?(u&&(a=0),s=0,">"===n?(n=">=",u?(i=+i+1,a=0,s=0):(a=+a+1,s=0)):"<="===n&&(n="<",u?i=+i+1:a=+a+1),"<"===n&&(o="-0"),r=`${n+i}.${a}.${s}${o}`):u?r=`>=${i}.0.0${o} <${+i+1}.0.0-0`:d&&(r=`>=${i}.${a}.0${o} <${i}.${+a+1}.0-0`),l("xRange return",r),r}))},k=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),A=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),I=e=>(t,r,n,i,a,s,o,l,c,u,d,h)=>`${r=_(n)?"":_(i)?`>=${n}.0.0${e?"-0":""}`:_(a)?`>=${n}.${i}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=_(c)?"":_(u)?`<${+c+1}.0.0-0`:_(d)?`<${c}.${+u+1}.0-0`:h?`<=${c}.${u}.${d}-${h}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),C=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},3908:(e,t,r)=>{const n=r(7272),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=r(6874),{safeRe:s,t:o}=r(9718),l=r(8587),{compareIdentifiers:c}=r(1123);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return c(r,i)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const r=this.build[t],i=e.build[t];if(n("build compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return c(r,i)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},7414:(e,t,r)=>{const n=r(144);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},2111:(e,t,r)=>{const n=r(4641),i=r(3999),a=r(5580),s=r(4089),o=r(7059),l=r(5200);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,c);case"!=":return i(e,r,c);case">":return a(e,r,c);case">=":return s(e,r,c);case"<":return o(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},6170:(e,t,r)=>{const n=r(3908),i=r(144),{safeRe:a,t:s}=r(9718);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?a[s.COERCERTLFULL]:a[s.COERCERTL];let i;for(;(i=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?a[s.COERCEFULL]:a[s.COERCE]);if(null===r)return null;const o=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return i(`${o}.${l}.${c}${u}${d}`,t)}},909:(e,t,r)=>{const n=r(3908);e.exports=(e,t,r)=>{const i=new n(e,r),a=new n(t,r);return i.compare(a)||i.compareBuild(a)}},1763:(e,t,r)=>{const n=r(560);e.exports=(e,t)=>n(e,t,!0)},560:(e,t,r)=>{const n=r(3908);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},1832:(e,t,r)=>{const n=r(144);e.exports=(e,t)=>{const r=n(e,null,!0),i=n(t,null,!0),a=r.compare(i);if(0===a)return null;const s=a>0,o=s?r:i,l=s?i:r,c=!!o.prerelease.length;if(l.prerelease.length&&!c)return l.patch||l.minor?o.patch?"patch":o.minor?"minor":"major":"major";const u=c?"pre":"";return r.major!==i.major?u+"major":r.minor!==i.minor?u+"minor":r.patch!==i.patch?u+"patch":"prerelease"}},4641:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>0===n(e,t,r)},5580:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>n(e,t,r)>0},4089:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>n(e,t,r)>=0},3007:(e,t,r)=>{const n=r(3908);e.exports=(e,t,r,i,a)=>{"string"==typeof r&&(a=i,i=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,i,a).version}catch(e){return null}}},7059:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>n(e,t,r)<0},5200:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>n(e,t,r)<=0},2938:(e,t,r)=>{const n=r(3908);e.exports=(e,t)=>new n(e,t).major},6254:(e,t,r)=>{const n=r(3908);e.exports=(e,t)=>new n(e,t).minor},3999:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>0!==n(e,t,r)},144:(e,t,r)=>{const n=r(3908);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},4493:(e,t,r)=>{const n=r(3908);e.exports=(e,t)=>new n(e,t).patch},1729:(e,t,r)=>{const n=r(144);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},9970:(e,t,r)=>{const n=r(560);e.exports=(e,t,r)=>n(t,e,r)},4277:(e,t,r)=>{const n=r(909);e.exports=(e,t)=>e.sort(((e,r)=>n(r,e,t)))},7638:(e,t,r)=>{const n=r(8311);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},3927:(e,t,r)=>{const n=r(909);e.exports=(e,t)=>e.sort(((e,r)=>n(e,r,t)))},6953:(e,t,r)=>{const n=r(144);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},9589:(e,t,r)=>{const n=r(9718),i=r(6874),a=r(3908),s=r(1123),o=r(144),l=r(6953),c=r(7414),u=r(3007),d=r(1832),h=r(2938),p=r(6254),m=r(4493),f=r(1729),g=r(560),y=r(9970),v=r(1763),b=r(909),w=r(3927),_=r(4277),x=r(5580),E=r(7059),T=r(4641),S=r(3999),P=r(4089),O=r(5200),k=r(2111),A=r(6170),I=r(3904),C=r(8311),R=r(7638),j=r(7631),N=r(9628),$=r(270),L=r(1261),M=r(3874),D=r(7075),U=r(5571),F=r(5342),V=r(6780),B=r(2525),Z=r(5032);e.exports={parse:o,valid:l,clean:c,inc:u,diff:d,major:h,minor:p,patch:m,prerelease:f,compare:g,rcompare:y,compareLoose:v,compareBuild:b,sort:w,rsort:_,gt:x,lt:E,eq:T,neq:S,gte:P,lte:O,cmp:k,coerce:A,Comparator:I,Range:C,satisfies:R,toComparators:j,maxSatisfying:N,minSatisfying:$,minVersion:L,validRange:M,outside:D,gtr:U,ltr:F,intersects:V,simplifyRange:B,subset:Z,SemVer:a,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},6874:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},7272:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},1123:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const n=t.test(e),i=t.test(r);return n&&i&&(e=+e,r=+r),e===r?0:n&&!i?-1:i&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},8794:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},8587:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},9718:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:a}=r(6874),s=r(7272),o=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.t={};let d=0;const h="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",a],[h,i]],m=(e,t,r)=>{const n=(e=>{for(const[t,r]of p)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),i=d++;s(e,i,t),u[e]=i,c[i]=t,o[i]=new RegExp(t,r?"g":void 0),l[i]=new RegExp(n,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),m("FULL",`^${c[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),m("LOOSE",`^${c[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),m("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[u.COERCE],!0),m("COERCERTLFULL",c[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},5571:(e,t,r)=>{const n=r(7075);e.exports=(e,t,r)=>n(e,t,">",r)},6780:(e,t,r)=>{const n=r(8311);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},5342:(e,t,r)=>{const n=r(7075);e.exports=(e,t,r)=>n(e,t,"<",r)},9628:(e,t,r)=>{const n=r(3908),i=r(8311);e.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new i(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(a&&-1!==s.compare(e)||(a=e,s=new n(a,r)))})),a}},270:(e,t,r)=>{const n=r(3908),i=r(8311);e.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new i(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(a&&1!==s.compare(e)||(a=e,s=new n(a,r)))})),a}},1261:(e,t,r)=>{const n=r(3908),i=r(8311),a=r(5580);e.exports=(e,t)=>{e=new i(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let s=null;i.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!a(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!s||r&&!a(r,s)||(r=s)}return r&&e.test(r)?r:null}},7075:(e,t,r)=>{const n=r(3908),i=r(3904),{ANY:a}=i,s=r(8311),o=r(7638),l=r(5580),c=r(7059),u=r(5200),d=r(4089);e.exports=(e,t,r,h)=>{let p,m,f,g,y;switch(e=new n(e,h),t=new s(t,h),r){case">":p=l,m=u,f=c,g=">",y=">=";break;case"<":p=c,m=d,f=l,g="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let s=null,o=null;if(n.forEach((e=>{e.semver===a&&(e=new i(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:f(e.semver,o.semver,h)&&(o=e)})),s.operator===g||s.operator===y)return!1;if((!o.operator||o.operator===g)&&m(e,o.semver))return!1;if(o.operator===y&&f(e,o.semver))return!1}return!0}},2525:(e,t,r)=>{const n=r(7638),i=r(560);e.exports=(e,t,r)=>{const a=[];let s=null,o=null;const l=e.sort(((e,t)=>i(e,t,r)));for(const e of l)n(e,t,r)?(o=e,s||(s=e)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);const c=[];for(const[e,t]of a)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},5032:(e,t,r)=>{const n=r(8311),i=r(3904),{ANY:a}=i,s=r(7638),o=r(560),l=[new i(">=0.0.0-0")],c=[new i(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===a){if(1===t.length&&t[0].semver===a)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===a){if(r.includePrerelease)return!0;t=c}const n=new Set;let i,u,p,m,f,g,y;for(const t of e)">"===t.operator||">="===t.operator?i=d(i,t,r):"<"===t.operator||"<="===t.operator?u=h(u,t,r):n.add(t.semver);if(n.size>1)return null;if(i&&u){if(p=o(i.semver,u.semver,r),p>0)return null;if(0===p&&(">="!==i.operator||"<="!==u.operator))return null}for(const e of n){if(i&&!s(e,String(i),r))return null;if(u&&!s(e,String(u),r))return null;for(const n of t)if(!s(e,String(n),r))return!1;return!0}let v=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,b=!(!i||r.includePrerelease||!i.semver.prerelease.length)&&i.semver;v&&1===v.prerelease.length&&"<"===u.operator&&0===v.prerelease[0]&&(v=!1);for(const e of t){if(y=y||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,i)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(m=d(i,e,r),m===e&&m!==i)return!1}else if(">="===i.operator&&!s(i.semver,String(e),r))return!1;if(u)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),"<"===e.operator||"<="===e.operator){if(f=h(u,e,r),f===e&&f!==u)return!1}else if("<="===u.operator&&!s(u.semver,String(e),r))return!1;if(!e.operator&&(u||i)&&0!==p)return!1}return!(i&&g&&!u&&0!==p||u&&y&&!i&&0!==p||b||v)},d=(e,t,r)=>{if(!e)return t;const n=o(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;const n=o(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let i=!1;e:for(const n of e.set){for(const e of t.set){const t=u(n,e,r);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},7631:(e,t,r)=>{const n=r(8311);e.exports=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},3874:(e,t,r)=>{const n=r(8311);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},1594:e=>{"use strict";e.exports=React}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n](a,a.exports,r),a.loaded=!0,a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e={};r.r(e),r.d(e,{JsonPatchError:()=>hc,_areEquals:()=>xc,applyOperation:()=>yc,applyPatch:()=>vc,applyReducer:()=>bc,deepClone:()=>pc,getValueByPointer:()=>gc,validate:()=>_c,validator:()=>wc});var t=r(1594),n=r.n(t);const i=ReactDOM;var a=r.n(i);const s=(...e)=>e.filter(((e,t,r)=>Boolean(e)&&r.indexOf(e)===t)).join(" ");var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const l=(0,t.forwardRef)((({color:e="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:a="",children:l,iconNode:c,...u},d)=>(0,t.createElement)("svg",{ref:d,...o,width:r,height:r,stroke:e,strokeWidth:i?24*Number(n)/Number(r):n,className:s("lucide",a),...u},[...c.map((([e,r])=>(0,t.createElement)(e,r))),...Array.isArray(l)?l:[l]]))),c=(e,r)=>{const n=(0,t.forwardRef)((({className:n,...i},a)=>{return(0,t.createElement)(l,{ref:a,iconNode:r,className:s(`lucide-${o=e,o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,n),...i});var o}));return n.displayName=`${e}`,n},u=c("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),d=c("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),h=c("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);var p=r(4848);const m=(0,t.createContext)(null);function f(e){const r=(0,t.useRef)(null);return null===r.current&&(r.current=e()),r.current}const g=(0,t.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class y extends t.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function v({children:e,isPresent:r}){const n=(0,t.useId)(),i=(0,t.useRef)(null),a=(0,t.useRef)({width:0,height:0,top:0,left:0}),{nonce:s}=(0,t.useContext)(g);return(0,t.useInsertionEffect)((()=>{const{width:e,height:t,top:o,left:l}=a.current;if(r||!i.current||!e||!t)return;i.current.dataset.motionPopId=n;const c=document.createElement("style");return s&&(c.nonce=s),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${n}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${o}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}}),[r]),(0,p.jsx)(y,{isPresent:r,childRef:i,sizeRef:a,children:t.cloneElement(e,{ref:i})})}const b=({children:e,initial:r,isPresent:n,onExitComplete:i,custom:a,presenceAffectsLayout:s,mode:o})=>{const l=f(w),c=(0,t.useId)(),u=(0,t.useMemo)((()=>({id:c,initial:r,isPresent:n,custom:a,onExitComplete:e=>{l.set(e,!0);for(const e of l.values())if(!e)return;i&&i()},register:e=>(l.set(e,!1),()=>l.delete(e))})),s?[Math.random()]:[n]);return(0,t.useMemo)((()=>{l.forEach(((e,t)=>l.set(t,!1)))}),[n]),t.useEffect((()=>{!n&&!l.size&&i&&i()}),[n]),"popLayout"===o&&(e=(0,p.jsx)(v,{isPresent:n,children:e})),(0,p.jsx)(m.Provider,{value:u,children:e})};function w(){return new Map}const _=(0,t.createContext)({}),x=e=>e;let E=x,T=x;const S=e=>e.key||"";function P(e){const r=[];return t.Children.forEach(e,(e=>{(0,t.isValidElement)(e)&&r.push(e)})),r}const O="undefined"!=typeof window,k=O?t.useLayoutEffect:t.useEffect,A=({children:e,exitBeforeEnter:r,custom:n,initial:i=!0,onExitComplete:a,presenceAffectsLayout:s=!0,mode:o="sync"})=>{T(!r,"Replace exitBeforeEnter with mode='wait'");const l=(0,t.useMemo)((()=>P(e)),[e]),c=l.map(S),u=(0,t.useRef)(!0),d=(0,t.useRef)(l),h=f((()=>new Map)),[m,g]=(0,t.useState)(l),[y,v]=(0,t.useState)(l);k((()=>{u.current=!1,d.current=l;for(let e=0;e<y.length;e++){const t=S(y[e]);c.includes(t)?h.delete(t):!0!==h.get(t)&&h.set(t,!1)}}),[y,c.length,c.join("-")]);const w=[];if(l!==m){let e=[...l];for(let t=0;t<y.length;t++){const r=y[t],n=S(r);c.includes(n)||(e.splice(t,0,r),w.push(r))}return"wait"===o&&w.length&&(e=w),v(P(e)),void g(l)}const{forceRender:x}=(0,t.useContext)(_);return(0,p.jsx)(p.Fragment,{children:y.map((e=>{const t=S(e),r=l===y||c.includes(t);return(0,p.jsx)(b,{isPresent:r,initial:!(u.current&&!i)&&void 0,custom:r?void 0:n,presenceAffectsLayout:s,mode:o,onExitComplete:r?void 0:()=>{if(!h.has(t))return;h.set(t,!0);let e=!0;h.forEach((t=>{t||(e=!1)})),e&&(null==x||x(),v(d.current),a&&a())},children:e},t)}))})};function I(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(r,n)=>"create"===n?e:(t.has(n)||t.set(n,e(n)),t.get(n))})}function C(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const R=e=>Array.isArray(e);function j(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function N(e){return"string"==typeof e||Array.isArray(e)}function $(e){const t=[{},{}];return null==e||e.values.forEach(((e,r)=>{t[0][r]=e.get(),t[1][r]=e.getVelocity()})),t}function L(e,t,r,n){if("function"==typeof t){const[i,a]=$(n);t=t(void 0!==r?r:e.custom,i,a)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[i,a]=$(n);t=t(void 0!==r?r:e.custom,i,a)}return t}function M(e,t,r){const n=e.getProps();return L(n,t,void 0!==r?r:n.custom,e)}const D=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],U=["initial",...D],F=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],V=new Set(F),B=e=>1e3*e,Z=e=>e/1e3,H={type:"spring",stiffness:500,damping:25,restSpeed:10},G={type:"keyframes",duration:.8},z={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},W=(e,{keyframes:t})=>t.length>2?G:V.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:H:z;function q(e,t){return e[t]||e.default||e}const J=e=>null!==e;function K(e,{repeat:t,repeatType:r="loop"},n){const i=e.filter(J),a=t&&"loop"!==r&&t%2==1?0:i.length-1;return a&&void 0!==n?n:i[a]}const X=["read","resolveKeyframes","update","preRender","render","postRender"];function Y(e,t){let r=!1,n=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>r=!0,s=X.reduce(((e,t)=>(e[t]=function(e){let t=new Set,r=new Set,n=!1,i=!1;const a=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1};function o(t){a.has(t)&&(l.schedule(t),e()),t(s)}const l={schedule:(e,i=!1,s=!1)=>{const o=s&&n?t:r;return i&&a.add(e),o.has(e)||o.add(e),e},cancel:e=>{r.delete(e),a.delete(e)},process:e=>{s=e,n?i=!0:(n=!0,[t,r]=[r,t],r.clear(),t.forEach(o),n=!1,i&&(i=!1,l.process(e)))}};return l}(a),e)),{}),{read:o,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:h}=s,p=()=>{const a=performance.now();r=!1,i.delta=n?1e3/60:Math.max(Math.min(a-i.timestamp,40),1),i.timestamp=a,i.isProcessing=!0,o.process(i),l.process(i),c.process(i),u.process(i),d.process(i),h.process(i),i.isProcessing=!1,r&&t&&(n=!1,e(p))};return{schedule:X.reduce(((t,a)=>{const o=s[a];return t[a]=(t,a=!1,s=!1)=>(r||(r=!0,n=!0,i.isProcessing||e(p)),o.schedule(t,a,s)),t}),{}),cancel:e=>{for(let t=0;t<X.length;t++)s[X[t]].cancel(e)},state:i,steps:s}}const{schedule:Q,cancel:ee,state:te,steps:re}=Y("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:x,!0),ne=e=>/^0[^.\s]+$/u.test(e),ie=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),ae=e=>t=>"string"==typeof t&&t.startsWith(e),se=ae("--"),oe=ae("var(--"),le=e=>!!oe(e)&&ce.test(e.split("/*")[0].trim()),ce=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ue=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function de(e,t,r=1){T(r<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[n,i]=function(e){const t=ue.exec(e);if(!t)return[,];const[,r,n,i]=t;return[`--${null!=r?r:n}`,i]}(e);if(!n)return;const a=window.getComputedStyle(t).getPropertyValue(n);if(a){const e=a.trim();return ie(e)?parseFloat(e):e}return le(i)?de(i,t,r+1):i}const he=(e,t,r)=>r>t?t:r<e?e:r,pe={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},me={...pe,transform:e=>he(0,1,e)},fe={...pe,default:1},ge=e=>Math.round(1e5*e)/1e5,ye=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,ve=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,be=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function we(e){return"string"==typeof e}const _e=e=>({test:t=>we(t)&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),xe=_e("deg"),Ee=_e("%"),Te=_e("px"),Se=_e("vh"),Pe=_e("vw"),Oe={...Ee,parse:e=>Ee.parse(e)/100,transform:e=>Ee.transform(100*e)},ke=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Ae=e=>e===pe||e===Te,Ie=(e,t)=>parseFloat(e.split(", ")[t]),Ce=(e,t)=>(r,{transform:n})=>{if("none"===n||!n)return 0;const i=n.match(/^matrix3d\((.+)\)$/u);if(i)return Ie(i[1],t);{const t=n.match(/^matrix\((.+)\)$/u);return t?Ie(t[1],e):0}},Re=new Set(["x","y","z"]),je=F.filter((e=>!Re.has(e))),Ne={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Ce(4,13),y:Ce(5,14)};Ne.translateX=Ne.x,Ne.translateY=Ne.y;const $e=e=>t=>t.test(e),Le=[pe,Te,Ee,xe,Pe,Se,{test:e=>"auto"===e,parse:e=>e}],Me=e=>Le.find($e(e)),De=new Set;let Ue=!1,Fe=!1;function Ve(){if(Fe){const e=Array.from(De).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),r=new Map;t.forEach((e=>{const t=function(e){const t=[];return je.forEach((r=>{const n=e.getValue(r);void 0!==n&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))})),t}(e);t.length&&(r.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=r.get(e);t&&t.forEach((([t,r])=>{var n;null===(n=e.getValue(t))||void 0===n||n.set(r)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}Fe=!1,Ue=!1,De.forEach((e=>e.complete())),De.clear()}function Be(){De.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(Fe=!0)}))}class Ze{constructor(e,t,r,n,i,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=n,this.element=i,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(De.add(this),Ue||(Ue=!0,Q.read(Be),Q.resolveKeyframes(Ve))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:n}=this;for(let i=0;i<e.length;i++)if(null===e[i])if(0===i){const i=null==n?void 0:n.get(),a=e[e.length-1];if(void 0!==i)e[0]=i;else if(r&&t){const n=r.readValue(t,a);null!=n&&(e[0]=n)}void 0===e[0]&&(e[0]=a),n&&void 0===i&&n.set(e[0])}else e[i]=e[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),De.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,De.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const He=(e,t)=>r=>Boolean(we(r)&&be.test(r)&&r.startsWith(e)||t&&!function(e){return null==e}(r)&&Object.prototype.hasOwnProperty.call(r,t)),Ge=(e,t,r)=>n=>{if(!we(n))return n;const[i,a,s,o]=n.match(ye);return{[e]:parseFloat(i),[t]:parseFloat(a),[r]:parseFloat(s),alpha:void 0!==o?parseFloat(o):1}},ze={...pe,transform:e=>Math.round((e=>he(0,255,e))(e))},We={test:He("rgb","red"),parse:Ge("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+ze.transform(e)+", "+ze.transform(t)+", "+ze.transform(r)+", "+ge(me.transform(n))+")"},qe={test:He("#"),parse:function(e){let t="",r="",n="",i="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),i=e.substring(4,5),t+=t,r+=r,n+=n,i+=i),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}},transform:We.transform},Je={test:He("hsl","hue"),parse:Ge("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Ee.transform(ge(t))+", "+Ee.transform(ge(r))+", "+ge(me.transform(n))+")"},Ke={test:e=>We.test(e)||qe.test(e)||Je.test(e),parse:e=>We.test(e)?We.parse(e):Je.test(e)?Je.parse(e):qe.parse(e),transform:e=>we(e)?e:e.hasOwnProperty("red")?We.transform(e):Je.transform(e)},Xe="number",Ye="color",Qe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function et(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},i=[];let a=0;const s=t.replace(Qe,(e=>(Ke.test(e)?(n.color.push(a),i.push(Ye),r.push(Ke.parse(e))):e.startsWith("var(")?(n.var.push(a),i.push("var"),r.push(e)):(n.number.push(a),i.push(Xe),r.push(parseFloat(e))),++a,"${}"))).split("${}");return{values:r,split:s,indexes:n,types:i}}function tt(e){return et(e).values}function rt(e){const{split:t,types:r}=et(e),n=t.length;return e=>{let i="";for(let a=0;a<n;a++)if(i+=t[a],void 0!==e[a]){const t=r[a];i+=t===Xe?ge(e[a]):t===Ye?Ke.transform(e[a]):e[a]}return i}}const nt=e=>"number"==typeof e?0:e,it={test:function(e){var t,r;return isNaN(e)&&we(e)&&((null===(t=e.match(ye))||void 0===t?void 0:t.length)||0)+((null===(r=e.match(ve))||void 0===r?void 0:r.length)||0)>0},parse:tt,createTransformer:rt,getAnimatableNone:function(e){const t=tt(e);return rt(e)(t.map(nt))}},at=new Set(["brightness","contrast","saturate","opacity"]);function st(e){const[t,r]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[n]=r.match(ye)||[];if(!n)return e;const i=r.replace(n,"");let a=at.has(t)?1:0;return n!==r&&(a*=100),t+"("+a+i+")"}const ot=/\b([a-z-]*)\(.*?\)/gu,lt={...it,getAnimatableNone:e=>{const t=e.match(ot);return t?t.map(st).join(" "):e}},ct={...pe,transform:Math.round},ut={borderWidth:Te,borderTopWidth:Te,borderRightWidth:Te,borderBottomWidth:Te,borderLeftWidth:Te,borderRadius:Te,radius:Te,borderTopLeftRadius:Te,borderTopRightRadius:Te,borderBottomRightRadius:Te,borderBottomLeftRadius:Te,width:Te,maxWidth:Te,height:Te,maxHeight:Te,size:Te,top:Te,right:Te,bottom:Te,left:Te,padding:Te,paddingTop:Te,paddingRight:Te,paddingBottom:Te,paddingLeft:Te,margin:Te,marginTop:Te,marginRight:Te,marginBottom:Te,marginLeft:Te,rotate:xe,rotateX:xe,rotateY:xe,rotateZ:xe,scale:fe,scaleX:fe,scaleY:fe,scaleZ:fe,skew:xe,skewX:xe,skewY:xe,distance:Te,translateX:Te,translateY:Te,translateZ:Te,x:Te,y:Te,z:Te,perspective:Te,transformPerspective:Te,opacity:me,originX:Oe,originY:Oe,originZ:Te,zIndex:ct,backgroundPositionX:Te,backgroundPositionY:Te,fillOpacity:me,strokeOpacity:me,numOctaves:ct},dt={...ut,color:Ke,backgroundColor:Ke,outlineColor:Ke,fill:Ke,stroke:Ke,borderColor:Ke,borderTopColor:Ke,borderRightColor:Ke,borderBottomColor:Ke,borderLeftColor:Ke,filter:lt,WebkitFilter:lt},ht=e=>dt[e];function pt(e,t){let r=ht(e);return r!==lt&&(r=it),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const mt=new Set(["auto","none","0"]);class ft extends Ze{constructor(e,t,r,n,i){super(e,t,r,n,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let r=0;r<e.length;r++){let n=e[r];if("string"==typeof n&&(n=n.trim(),le(n))){const i=de(n,t.current);void 0!==i&&(e[r]=i),r===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!ke.has(r)||2!==e.length)return;const[n,i]=e,a=Me(n),s=Me(i);if(a!==s)if(Ae(a)&&Ae(s))for(let t=0;t<e.length;t++){const r=e[t];"string"==typeof r&&(e[t]=parseFloat(r))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let t=0;t<e.length;t++)("number"==typeof(n=e[t])?0===n:null===n||"none"===n||"0"===n||ne(n))&&r.push(t);var n;r.length&&function(e,t,r){let n,i=0;for(;i<e.length&&!n;){const t=e[i];"string"==typeof t&&!mt.has(t)&&et(t).values.length&&(n=e[i]),i++}if(n&&r)for(const i of t)e[i]=pt(r,n)}(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;"height"===r&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ne[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const n=t[t.length-1];void 0!==n&&e.getValue(r,n).jump(n,!1)}measureEndState(){var e;const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const i=t.getValue(r);i&&i.jump(this.measuredOrigin,!1);const a=n.length-1,s=n[a];n[a]=Ne[r](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==s&&void 0===this.finalKeyframe&&(this.finalKeyframe=s),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((([e,r])=>{t.getValue(e).set(r)})),this.resolveNoneKeyframes()}}function gt(e){let t;return()=>(void 0===t&&(t=e()),t)}let yt;function vt(){yt=void 0}const bt={now:()=>(void 0===yt&&bt.set(te.isProcessing?te.timestamp:performance.now()),yt),set:e=>{yt=e,queueMicrotask(vt)}},wt=(e,t)=>!("zIndex"===t||"number"!=typeof e&&!Array.isArray(e)&&("string"!=typeof e||!it.test(e)&&"0"!==e||e.startsWith("url(")));class _t{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:a="loop",...s}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=bt.now(),this.options={autoplay:e,delay:t,type:r,repeat:n,repeatDelay:i,repeatType:a,...s},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Be(),Ve()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=bt.now(),this.hasAttemptedResolve=!0;const{name:r,type:n,velocity:i,delay:a,onComplete:s,onUpdate:o,isGenerator:l}=this.options;if(!l&&!function(e,t,r,n){const i=e[0];if(null===i)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],s=wt(i,t),o=wt(a,t);return E(s===o,`You are trying to animate ${t} from "${i}" to "${a}". ${i} is not an animatable value - to enable this animation set ${i} to a value animatable to ${a} via the \`style\` property.`),!(!s||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}(e)||"spring"===r&&n)}(e,r,n,i)){if(!a)return null==o||o(K(e,this.options,t)),null==s||s(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:t,...c},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}function xt(e,t){return t?e*(1e3/t):0}function Et(e,t,r){const n=Math.max(t-5,0);return xt(r-e(n),t-n)}const Tt=12;function St(e,t){return e*Math.sqrt(1-t*t)}const Pt=["duration","bounce"],Ot=["stiffness","damping","mass"];function kt(e,t){return t.some((t=>void 0!==e[t]))}function At({keyframes:e,restDelta:t,restSpeed:r,...n}){const i=e[0],a=e[e.length-1],s={done:!1,value:i},{stiffness:o,damping:l,mass:c,duration:u,velocity:d,isResolvedFromDuration:h}=function(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!kt(e,Ot)&&kt(e,Pt)){const r=function({duration:e=800,bounce:t=.25,velocity:r=0,mass:n=1}){let i,a;E(e<=B(10),"Spring duration must be 10 seconds or less");let s=1-t;s=he(.05,1,s),e=he(.01,10,Z(e)),s<1?(i=t=>{const n=t*s,i=n*e;return.001-(n-r)/St(t,s)*Math.exp(-i)},a=t=>{const n=t*s*e,a=n*r+r,o=Math.pow(s,2)*Math.pow(t,2)*e,l=Math.exp(-n),c=St(Math.pow(t,2),s);return(.001-i(t)>0?-1:1)*((a-o)*l)/c}):(i=t=>Math.exp(-t*e)*((t-r)*e+1)-.001,a=t=>Math.exp(-t*e)*(e*e*(r-t)));const o=function(e,t,r){let n=r;for(let r=1;r<Tt;r++)n-=e(n)/t(n);return n}(i,a,5/e);if(e=B(e),isNaN(o))return{stiffness:100,damping:10,duration:e};{const t=Math.pow(o,2)*n;return{stiffness:t,damping:2*s*Math.sqrt(n*t),duration:e}}}(e);t={...t,...r,mass:1},t.isResolvedFromDuration=!0}return t}({...n,velocity:-Z(n.velocity||0)}),p=d||0,m=l/(2*Math.sqrt(o*c)),f=a-i,g=Z(Math.sqrt(o/c)),y=Math.abs(f)<5;let v;if(r||(r=y?.01:2),t||(t=y?.005:.5),m<1){const e=St(g,m);v=t=>{const r=Math.exp(-m*g*t);return a-r*((p+m*g*f)/e*Math.sin(e*t)+f*Math.cos(e*t))}}else if(1===m)v=e=>a-Math.exp(-g*e)*(f+(p+g*f)*e);else{const e=g*Math.sqrt(m*m-1);v=t=>{const r=Math.exp(-m*g*t),n=Math.min(e*t,300);return a-r*((p+m*g*f)*Math.sinh(n)+e*f*Math.cosh(n))/e}}return{calculatedDuration:h&&u||null,next:e=>{const n=v(e);if(h)s.done=e>=u;else{let i=0;m<1&&(i=0===e?B(p):Et(v,e,n));const o=Math.abs(i)<=r,l=Math.abs(a-n)<=t;s.done=o&&l}return s.value=s.done?a:n,s}}}function It({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:s,min:o,max:l,restDelta:c=.5,restSpeed:u}){const d=e[0],h={done:!1,value:d},p=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let m=r*t;const f=d+m,g=void 0===s?f:s(f);g!==f&&(m=g-d);const y=e=>-m*Math.exp(-e/n),v=e=>g+y(e),b=e=>{const t=y(e),r=v(e);h.done=Math.abs(t)<=c,h.value=h.done?g:r};let w,_;const x=e=>{var t;t=h.value,(void 0!==o&&t<o||void 0!==l&&t>l)&&(w=e,_=At({keyframes:[h.value,p(h.value)],velocity:Et(v,e,h.value),damping:i,stiffness:a,restDelta:c,restSpeed:u}))};return x(0),{calculatedDuration:null,next:e=>{let t=!1;return _||void 0!==w||(t=!0,b(e),x(e)),void 0!==w&&e>=w?_.next(e-w):(!t&&b(e),h)}}}const Ct=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e;function Rt(e,t,r,n){if(e===t&&r===n)return x;return i=>0===i||1===i?i:Ct(function(e,t,r,n,i){let a,s,o=0;do{s=t+(r-t)/2,a=Ct(s,n,i)-e,a>0?r=s:t=s}while(Math.abs(a)>1e-7&&++o<12);return s}(i,0,1,e,r),t,n)}const jt=Rt(.42,0,1,1),Nt=Rt(0,0,.58,1),$t=Rt(.42,0,.58,1),Lt=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Mt=e=>t=>1-e(1-t),Dt=e=>1-Math.sin(Math.acos(e)),Ut=Mt(Dt),Ft=Lt(Dt),Vt=Rt(.33,1.53,.69,.99),Bt=Mt(Vt),Zt={linear:x,easeIn:jt,easeInOut:$t,easeOut:Nt,circIn:Dt,circInOut:Ft,circOut:Ut,backIn:Bt,backInOut:Lt(Bt),backOut:Vt,anticipate:e=>(e*=2)<1?.5*Bt(e):.5*(2-Math.pow(2,-10*(e-1)))},Ht=e=>{if(Array.isArray(e)){T(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,r,n,i]=e;return Rt(t,r,n,i)}return"string"==typeof e?(T(void 0!==Zt[e],`Invalid easing type '${e}'`),Zt[e]):e},Gt=(e,t)=>r=>t(e(r)),zt=(...e)=>e.reduce(Gt),Wt=(e,t,r)=>{const n=t-e;return 0===n?1:(r-e)/n},qt=(e,t,r)=>e+(t-e)*r;function Jt(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Kt(e,t){return r=>r>0?t:e}const Xt=(e,t,r)=>{const n=e*e,i=r*(t*t-n)+n;return i<0?0:Math.sqrt(i)},Yt=[qe,We,Je];function Qt(e){const t=(r=e,Yt.find((e=>e.test(r))));var r;if(E(Boolean(t),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(t))return!1;let n=t.parse(e);return t===Je&&(n=function({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,r/=100;let i=0,a=0,s=0;if(t/=100){const n=r<.5?r*(1+t):r+t-r*t,o=2*r-n;i=Jt(o,n,e+1/3),a=Jt(o,n,e),s=Jt(o,n,e-1/3)}else i=a=s=r;return{red:Math.round(255*i),green:Math.round(255*a),blue:Math.round(255*s),alpha:n}}(n)),n}const er=(e,t)=>{const r=Qt(e),n=Qt(t);if(!r||!n)return Kt(e,t);const i={...r};return e=>(i.red=Xt(r.red,n.red,e),i.green=Xt(r.green,n.green,e),i.blue=Xt(r.blue,n.blue,e),i.alpha=qt(r.alpha,n.alpha,e),We.transform(i))},tr=new Set(["none","hidden"]);function rr(e,t){return r=>qt(e,t,r)}function nr(e){return"number"==typeof e?rr:"string"==typeof e?le(e)?Kt:Ke.test(e)?er:sr:Array.isArray(e)?ir:"object"==typeof e?Ke.test(e)?er:ar:Kt}function ir(e,t){const r=[...e],n=r.length,i=e.map(((e,r)=>nr(e)(e,t[r])));return e=>{for(let t=0;t<n;t++)r[t]=i[t](e);return r}}function ar(e,t){const r={...e,...t},n={};for(const i in r)void 0!==e[i]&&void 0!==t[i]&&(n[i]=nr(e[i])(e[i],t[i]));return e=>{for(const t in n)r[t]=n[t](e);return r}}const sr=(e,t)=>{const r=it.createTransformer(t),n=et(e),i=et(t);return n.indexes.var.length===i.indexes.var.length&&n.indexes.color.length===i.indexes.color.length&&n.indexes.number.length>=i.indexes.number.length?tr.has(e)&&!i.values.length||tr.has(t)&&!n.values.length?function(e,t){return tr.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}(e,t):zt(ir(function(e,t){var r;const n=[],i={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const s=t.types[a],o=e.indexes[s][i[s]],l=null!==(r=e.values[o])&&void 0!==r?r:0;n[a]=l,i[s]++}return n}(n,i),i.values),r):(E(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),Kt(e,t))};function or(e,t,r){return"number"==typeof e&&"number"==typeof t&&"number"==typeof r?qt(e,t,r):nr(e)(e,t)}function lr({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const i=(e=>Array.isArray(e)&&"number"!=typeof e[0])(n)?n.map(Ht):Ht(n),a={done:!1,value:t[0]},s=function(e,t){return e.map((e=>e*t))}(r&&r.length===t.length?r:function(e){const t=[0];return function(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const i=Wt(0,t,n);e.push(qt(r,1,i))}}(t,e.length-1),t}(t),e),o=function(e,t,{clamp:r=!0,ease:n,mixer:i}={}){const a=e.length;if(T(a===t.length,"Both input and output ranges must be the same length"),1===a)return()=>t[0];if(2===a&&e[0]===e[1])return()=>t[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const s=function(e,t,r){const n=[],i=r||or,a=e.length-1;for(let r=0;r<a;r++){let a=i(e[r],e[r+1]);if(t){const e=Array.isArray(t)?t[r]||x:t;a=zt(e,a)}n.push(a)}return n}(t,n,i),o=s.length,l=t=>{let r=0;if(o>1)for(;r<e.length-2&&!(t<e[r+1]);r++);const n=Wt(e[r],e[r+1],t);return s[r](n)};return r?t=>l(he(e[0],e[a-1],t)):l}(s,t,{ease:Array.isArray(i)?i:(l=t,c=i,l.map((()=>c||$t)).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(a.value=o(t),a.done=t>=e,a)}}const cr=e=>{const t=({timestamp:t})=>e(t);return{start:()=>Q.update(t,!0),stop:()=>ee(t),now:()=>te.isProcessing?te.timestamp:bt.now()}},ur={decay:It,inertia:It,tween:lr,keyframes:lr,spring:At},dr=e=>e/100;class hr extends _t{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:r,element:n,keyframes:i}=this.options,a=(null==n?void 0:n.KeyframeResolver)||Ze;this.resolver=new a(i,((e,t)=>this.onKeyframesResolved(e,t)),t,r,n),this.resolver.scheduleResolve()}initPlayback(e){const{type:t="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:i,velocity:a=0}=this.options,s=ur[t]||lr;let o,l;s!==lr&&"number"!=typeof e[0]&&(o=zt(dr,or(e[0],e[1])),e=[0,100]);const c=s({...this.options,keyframes:e});"mirror"===i&&(l=s({...this.options,keyframes:[...e].reverse(),velocity:-a})),null===c.calculatedDuration&&(c.calculatedDuration=function(e){let t=0,r=e.next(t);for(;!r.done&&t<2e4;)t+=50,r=e.next(t);return t>=2e4?1/0:t}(c));const{calculatedDuration:u}=c,d=u+n;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:o,calculatedDuration:u,resolvedDuration:d,totalDuration:d*(r+1)-n}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,t=!1){const{resolved:r}=this;if(!r){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:n,generator:i,mirroredGenerator:a,mapPercentToKeyframes:s,keyframes:o,calculatedDuration:l,totalDuration:c,resolvedDuration:u}=r;if(null===this.startTime)return i.next(0);const{delay:d,repeat:h,repeatType:p,repeatDelay:m,onUpdate:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const g=this.currentTime-d*(this.speed>=0?1:-1),y=this.speed>=0?g<0:g>c;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let v=this.currentTime,b=i;if(h){const e=Math.min(this.currentTime,c)/u;let t=Math.floor(e),r=e%1;!r&&e>=1&&(r=1),1===r&&t--,t=Math.min(t,h+1),Boolean(t%2)&&("reverse"===p?(r=1-r,m&&(r-=m/u)):"mirror"===p&&(b=a)),v=he(0,1,r)*u}const w=y?{done:!1,value:o[0]}:b.next(v);s&&(w.value=s(w.value));let{done:_}=w;y||null===l||(_=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const x=null===this.holdTime&&("finished"===this.state||"running"===this.state&&_);return x&&void 0!==n&&(w.value=K(o,this.options,n)),f&&f(w.value),x&&this.finish(),w}get duration(){const{resolved:e}=this;return e?Z(e.calculatedDuration):0}get time(){return Z(this.currentTime)}set time(e){e=B(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Z(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=cr,onPlay:t,startTime:r}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=n):this.startTime=null!=r?r:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const pr=new Set(["opacity","clipPath","filter","transform"]),mr=e=>Array.isArray(e)&&"number"==typeof e[0];function fr(e){return Boolean(!e||"string"==typeof e&&e in yr||mr(e)||Array.isArray(e)&&e.every(fr))}const gr=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,yr={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:gr([0,.65,.55,1]),circOut:gr([.55,0,1,.45]),backIn:gr([.31,.01,.66,-.59]),backOut:gr([.33,1.53,.69,.99])};function vr(e){return br(e)||yr.easeOut}function br(e){return e?mr(e)?gr(e):Array.isArray(e)?e.map(vr):yr[e]:void 0}const wr=gt((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));class _r extends _t{constructor(e){super(e);const{name:t,motionValue:r,element:n,keyframes:i}=this.options;this.resolver=new ft(i,((e,t)=>this.onKeyframesResolved(e,t)),t,r,n),this.resolver.scheduleResolve()}initPlayback(e,t){var r;let{duration:n=300,times:i,ease:a,type:s,motionValue:o,name:l,startTime:c}=this.options;if(!(null===(r=o.owner)||void 0===r?void 0:r.current))return!1;if("spring"===(u=this.options).type||!fr(u.ease)){const{onComplete:t,onUpdate:r,motionValue:o,element:l,...c}=this.options,u=function(e,t){const r=new hr({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let n={done:!1,value:e[0]};const i=[];let a=0;for(;!n.done&&a<2e4;)n=r.sample(a),i.push(n.value),a+=10;return{times:void 0,keyframes:i,duration:a-10,ease:"linear"}}(e,c);1===(e=u.keyframes).length&&(e[1]=e[0]),n=u.duration,i=u.times,a=u.ease,s="keyframes"}var u;const d=function(e,t,r,{delay:n=0,duration:i=300,repeat:a=0,repeatType:s="loop",ease:o,times:l}={}){const c={[t]:r};l&&(c.offset=l);const u=br(o);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:n,duration:i,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:"reverse"===s?"alternate":"normal"})}(o.owner.current,l,e,{...this.options,duration:n,times:i,ease:a});return d.startTime=null!=c?c:this.calcStartTime(),this.pendingTimeline?(d.timeline=this.pendingTimeline,this.pendingTimeline=void 0):d.onfinish=()=>{const{onComplete:r}=this.options;o.set(K(e,this.options,t)),r&&r(),this.cancel(),this.resolveFinishedPromise()},{animation:d,duration:n,times:i,type:s,ease:a,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Z(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Z(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.currentTime=B(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return x;const{animation:r}=t;r.timeline=e,r.onfinish=null}else this.pendingTimeline=e;return x}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:r,duration:n,type:i,ease:a,times:s}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const{motionValue:e,onUpdate:t,onComplete:o,element:l,...c}=this.options,u=new hr({...c,keyframes:r,duration:n,type:i,ease:a,times:s,isGenerator:!0}),d=B(this.time);e.setWithVelocity(u.sample(d-10).value,u.sample(d).value,10)}const{onStop:o}=this.options;o&&o(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:i,damping:a,type:s}=e;return wr()&&r&&pr.has(r)&&t&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate&&!n&&"mirror"!==i&&0!==a&&"inertia"!==s}}const xr=gt((()=>void 0!==window.ScrollTimeline));class Er{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}then(e,t){return Promise.all(this.animations).then(e).catch(t)}getAll(e){return this.animations[0][e]}setAll(e,t){for(let r=0;r<this.animations.length;r++)this.animations[r][e]=t}attachTimeline(e){const t=this.animations.map((t=>{if(!xr()||!t.attachTimeline)return t.pause(),function(e,r){let n;const i=()=>{const{currentTime:e}=r,i=(null===e?0:e.value)/100;n!==i&&(e=>{t.time=t.duration*e})(i),n=i};return Q.update(i,!0),()=>ee(i)}(0,e);t.attachTimeline(e)}));return()=>{t.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const Tr=(e,t,r,n={},i,a,s)=>o=>{const l=q(n,e)||{},c=l.delay||n.delay||0;let{elapsed:u=0}=n;u-=B(c);let d={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-u,onUpdate:e=>{t.set(e),l.onUpdate&&l.onUpdate(e)},onComplete:()=>{o(),l.onComplete&&l.onComplete(),s&&s()},onStop:s,name:e,motionValue:t,element:a?void 0:i};(function({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:i,repeat:a,repeatType:s,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(l)||(d={...d,...W(e,d)}),d.duration&&(d.duration=B(d.duration)),d.repeatDelay&&(d.repeatDelay=B(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let h=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(h=!0)),h&&!a&&void 0!==t.get()){const e=K(d.keyframes,l);if(void 0!==e)return Q.update((()=>{d.onUpdate(e),d.onComplete()})),new Er([])}return!a&&_r.supports(d)?new _r(d):new hr(d)};function Sr(e,t){-1===e.indexOf(t)&&e.push(t)}function Pr(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class Or{constructor(){this.subscriptions=[]}add(e){return Sr(this.subscriptions,e),()=>Pr(this.subscriptions,e)}notify(e,t,r){const n=this.subscriptions.length;if(n)if(1===n)this.subscriptions[0](e,t,r);else for(let i=0;i<n;i++){const n=this.subscriptions[i];n&&n(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const kr={current:void 0};class Ar{constructor(e,t={}){this.version="11.5.6",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const r=bt.now();this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),t&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=bt.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Or);const r=this.events[e].add(t);return"change"===e?()=>{r(),Q.read((()=>{this.events.change.getSize()||this.stop()}))}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return kr.current&&kr.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=bt.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return xt(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ir(e,t){return new Ar(e,t)}function Cr(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,Ir(r))}const Rr=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),jr="data-"+Rr("framerAppearId");function Nr(e){return e.props[jr]}function $r(e){return V.has(e)?"transform":pr.has(e)?Rr(e):void 0}class Lr extends Ar{constructor(){super(...arguments),this.output=[],this.counts=new Map}add(e){const t=$r(e);if(!t)return;const r=this.counts.get(t)||0;this.counts.set(t,r+1),0===r&&(this.output.push(t),this.update());let n=!1;return()=>{if(n)return;n=!0;const e=this.counts.get(t)-1;this.counts.set(t,e),0===e&&(Pr(this.output,t),this.update())}}update(){this.set(this.output.length?this.output.join(", "):"auto")}}const Mr=e=>Boolean(e&&e.getVelocity);function Dr(e,t){var r;if(!e.applyWillChange)return;let n=e.getValue("willChange");return n||(null===(r=e.props.style)||void 0===r?void 0:r.willChange)||(n=new Lr("auto"),e.addValue("willChange",n)),i=n,Boolean(Mr(i)&&i.add)?n.add(t):void 0;var i}function Ur({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&!0!==t[r];return t[r]=!1,n}function Fr(e,t,{delay:r=0,transitionOverride:n,type:i}={}){var a;let{transition:s=e.getDefaultTransition(),transitionEnd:o,...l}=t;n&&(s=n);const c=[],u=i&&e.animationState&&e.animationState.getState()[i];for(const t in l){const n=e.getValue(t,null!==(a=e.latestValues[t])&&void 0!==a?a:null),i=l[t];if(void 0===i||u&&Ur(u,t))continue;const o={delay:r,...q(s||{},t)};let d=!1;if(window.MotionHandoffAnimation){const r=Nr(e);if(r){const e=window.MotionHandoffAnimation(r,t,Q);null!==e&&(o.startTime=e,d=!0)}}n.start(Tr(t,n,i,e.shouldReduceMotion&&V.has(t)?{type:!1}:o,e,d,Dr(e,t)));const h=n.animation;h&&c.push(h)}return o&&Promise.all(c).then((()=>{Q.update((()=>{o&&function(e,t){const r=M(e,t);let{transitionEnd:n={},transition:i={},...a}=r||{};a={...a,...n};for(const t in a)Cr(e,t,(s=a[t],R(s)?s[s.length-1]||0:s));var s}(e,o)}))})),c}function Vr(e,t,r={}){var n;const i=M(e,t,"exit"===r.type?null===(n=e.presenceContext)||void 0===n?void 0:n.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=i||{};r.transitionOverride&&(a=r.transitionOverride);const s=i?()=>Promise.all(Fr(e,i,r)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(n=0)=>{const{delayChildren:i=0,staggerChildren:s,staggerDirection:o}=a;return function(e,t,r=0,n=0,i=1,a){const s=[],o=(e.variantChildren.size-1)*n,l=1===i?(e=0)=>e*n:(e=0)=>o-e*n;return Array.from(e.variantChildren).sort(Br).forEach(((e,n)=>{e.notify("AnimationStart",t),s.push(Vr(e,t,{...a,delay:r+l(n)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(s)}(e,t,i+n,s,o,r)}:()=>Promise.resolve(),{when:l}=a;if(l){const[e,t]="beforeChildren"===l?[s,o]:[o,s];return e().then((()=>t()))}return Promise.all([s(),o(r.delay)])}function Br(e,t){return e.sortNodePosition(t)}const Zr=U.length;function Hr(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Hr(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let r=0;r<Zr;r++){const n=U[r],i=e.props[n];(N(i)||!1===i)&&(t[n]=i)}return t}const Gr=[...D].reverse(),zr=D.length;function Wr(e){let t=function(e){return t=>Promise.all(t.map((({animation:t,options:r})=>function(e,t,r={}){let n;if(e.notify("AnimationStart",t),Array.isArray(t)){const i=t.map((t=>Vr(e,t,r)));n=Promise.all(i)}else if("string"==typeof t)n=Vr(e,t,r);else{const i="function"==typeof t?M(e,t,r.custom):t;n=Promise.all(Fr(e,i,r))}return n.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,r))))}(e),r=Jr(),n=!0;const i=t=>(r,n)=>{var i;const a=M(e,n,"exit"===t?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);if(a){const{transition:e,transitionEnd:t,...n}=a;r={...r,...n,...t}}return r};function a(a){const{props:s}=e,o=Hr(e.parent)||{},l=[],c=new Set;let u={},d=1/0;for(let t=0;t<zr;t++){const m=Gr[t],f=r[m],g=void 0!==s[m]?s[m]:o[m],y=N(g),v=m===a?f.isActive:null;!1===v&&(d=t);let b=g===o[m]&&g!==s[m]&&y;if(b&&n&&e.manuallyAnimateOnMount&&(b=!1),f.protectedKeys={...u},!f.isActive&&null===v||!g&&!f.prevProp||C(g)||"boolean"==typeof g)continue;const w=(h=f.prevProp,"string"==typeof(p=g)?p!==h:!!Array.isArray(p)&&!j(p,h));let _=w||m===a&&f.isActive&&!b&&y||t>d&&y,x=!1;const E=Array.isArray(g)?g:[g];let T=E.reduce(i(m),{});!1===v&&(T={});const{prevResolvedValues:S={}}=f,P={...S,...T},O=t=>{_=!0,c.has(t)&&(x=!0,c.delete(t)),f.needsAnimating[t]=!0;const r=e.getValue(t);r&&(r.liveStyle=!1)};for(const e in P){const t=T[e],r=S[e];if(u.hasOwnProperty(e))continue;let n=!1;n=R(t)&&R(r)?!j(t,r):t!==r,n?null!=t?O(e):c.add(e):void 0!==t&&c.has(e)?O(e):f.protectedKeys[e]=!0}f.prevProp=g,f.prevResolvedValues=T,f.isActive&&(u={...u,...T}),n&&e.blockInitialAnimation&&(_=!1),_&&(!b||!w||x)&&l.push(...E.map((e=>({animation:e,options:{type:m}}))))}var h,p;if(c.size){const t={};c.forEach((r=>{const n=e.getBaseTarget(r),i=e.getValue(r);i&&(i.liveStyle=!0),t[r]=null!=n?n:null})),l.push({animation:t})}let m=Boolean(l.length);return!n||!1!==s.initial&&s.initial!==s.animate||e.manuallyAnimateOnMount||(m=!1),n=!1,m?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,n){var i;if(r[t].isActive===n)return Promise.resolve();null===(i=e.variantChildren)||void 0===i||i.forEach((e=>{var r;return null===(r=e.animationState)||void 0===r?void 0:r.setActive(t,n)})),r[t].isActive=n;const s=a(t);for(const e in r)r[e].protectedKeys={};return s},setAnimateFunction:function(r){t=r(e)},getState:()=>r,reset:()=>{r=Jr(),n=!0}}}function qr(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Jr(){return{animate:qr(!0),whileInView:qr(),whileHover:qr(),whileTap:qr(),whileDrag:qr(),whileFocus:qr(),exit:qr()}}class Kr{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Xr=0;const Yr={animation:{Feature:class extends Kr{constructor(e){super(e),e.animationState||(e.animationState=Wr(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();C(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends Kr{constructor(){super(...arguments),this.id=Xr++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const n=this.node.animationState.setActive("exit",!e);t&&!e&&n.then((()=>t(this.id)))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},Qr=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function en(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}function tn(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function rn(e,t,r,n){return tn(e,t,(e=>t=>Qr(t)&&e(t,en(t)))(r),n)}const nn=(e,t)=>Math.abs(e-t);class an{constructor(e,t,{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=ln(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,r=function(e,t){const r=nn(e.x,t.x),n=nn(e.y,t.y);return Math.sqrt(r**2+n**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!r)return;const{point:n}=e,{timestamp:i}=te;this.history.push({...n,timestamp:i});const{onStart:a,onMove:s}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),s&&s(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=sn(t,this.transformPagePoint),Q.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:r,onSessionEnd:n,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=ln("pointercancel"===e.type?this.lastMoveEventInfo:sn(t,this.transformPagePoint),this.history);this.startEvent&&r&&r(e,a),n&&n(e,a)},!Qr(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=r,this.contextWindow=n||window;const a=sn(en(e),this.transformPagePoint),{point:s}=a,{timestamp:o}=te;this.history=[{...s,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,ln(a,this.history)),this.removeListeners=zt(rn(this.contextWindow,"pointermove",this.handlePointerMove),rn(this.contextWindow,"pointerup",this.handlePointerUp),rn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ee(this.updatePoint)}}function sn(e,t){return t?{point:t(e.point)}:e}function on(e,t){return{x:e.x-t.x,y:e.y-t.y}}function ln({point:e},t){return{point:e,delta:on(e,un(t)),offset:on(e,cn(t)),velocity:dn(t,.1)}}function cn(e){return e[0]}function un(e){return e[e.length-1]}function dn(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const i=un(e);for(;r>=0&&(n=e[r],!(i.timestamp-n.timestamp>B(t)));)r--;if(!n)return{x:0,y:0};const a=Z(i.timestamp-n.timestamp);if(0===a)return{x:0,y:0};const s={x:(i.x-n.x)/a,y:(i.y-n.y)/a};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function hn(e){let t=null;return()=>null===t&&(t=e,()=>{t=null})}const pn=hn("dragHorizontal"),mn=hn("dragVertical");function fn(e){let t=!1;if("y"===e)t=mn();else if("x"===e)t=pn();else{const e=pn(),r=mn();e&&r?t=()=>{e(),r()}:(e&&e(),r&&r())}return t}function gn(){const e=fn(!0);return!e||(e(),!1)}function yn(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function vn(e){return e.max-e.min}function bn(e,t,r,n=.5){e.origin=n,e.originPoint=qt(t.min,t.max,e.origin),e.scale=vn(r)/vn(t),e.translate=qt(r.min,r.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function wn(e,t,r,n){bn(e.x,t.x,r.x,n?n.originX:void 0),bn(e.y,t.y,r.y,n?n.originY:void 0)}function _n(e,t,r){e.min=r.min+t.min,e.max=e.min+vn(t)}function xn(e,t,r){e.min=t.min-r.min,e.max=e.min+vn(t)}function En(e,t,r){xn(e.x,t.x,r.x),xn(e.y,t.y,r.y)}function Tn(e,t,r){return{min:void 0!==t?e.min+t:void 0,max:void 0!==r?e.max+r-(e.max-e.min):void 0}}function Sn(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}const Pn=.35;function On(e,t,r){return{min:kn(e,t),max:kn(e,r)}}function kn(e,t){return"number"==typeof e?e:e[t]||0}const An=()=>({x:{min:0,max:0},y:{min:0,max:0}});function In(e){return[e("x"),e("y")]}function Cn({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function Rn(e){return void 0===e||1===e}function jn({scale:e,scaleX:t,scaleY:r}){return!Rn(e)||!Rn(t)||!Rn(r)}function Nn(e){return jn(e)||$n(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function $n(e){return Ln(e.x)||Ln(e.y)}function Ln(e){return e&&"0%"!==e}function Mn(e,t,r){return r+t*(e-r)}function Dn(e,t,r,n,i){return void 0!==i&&(e=Mn(e,i,n)),Mn(e,r,n)+t}function Un(e,t=0,r=1,n,i){e.min=Dn(e.min,t,r,n,i),e.max=Dn(e.max,t,r,n,i)}function Fn(e,{x:t,y:r}){Un(e.x,t.translate,t.scale,t.originPoint),Un(e.y,r.translate,r.scale,r.originPoint)}const Vn=.999999999999,Bn=1.0000000000001;function Zn(e,t){e.min=e.min+t,e.max=e.max+t}function Hn(e,t,r,n,i=.5){Un(e,t,r,qt(e.min,e.max,i),n)}function Gn(e,t){Hn(e.x,t.x,t.scaleX,t.scale,t.originX),Hn(e.y,t.y,t.scaleY,t.scale,t.originY)}function zn(e,t){return Cn(function(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}(e.getBoundingClientRect(),t))}const Wn=({current:e})=>e?e.ownerDocument.defaultView:null,qn=new WeakMap;class Jn{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;const{dragSnapToOrigin:n}=this.getProps();this.panSession=new an(e,{onSessionStart:e=>{const{dragSnapToOrigin:r}=this.getProps();r?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(en(e,"page").point)},onStart:(e,t)=>{var r;const{drag:n,dragPropagation:i,onDragStart:a}=this.getProps();if(n&&!i&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=fn(n),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),In((e=>{let t=this.getAxisMotionValue(e).get()||0;if(Ee.test(t)){const{projection:r}=this.visualElement;if(r&&r.layout){const n=r.layout.layoutBox[e];n&&(t=vn(n)*(parseFloat(t)/100))}}this.originPoint[e]=t})),a&&Q.postRender((()=>a(e,t))),null===(r=this.removeWillChange)||void 0===r||r.call(this),this.removeWillChange=Dr(this.visualElement,"transform");const{animationState:s}=this.visualElement;s&&s.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:r,dragDirectionLock:n,onDirectionLock:i,onDrag:a}=this.getProps();if(!r&&!this.openGlobalLock)return;const{offset:s}=t;if(n&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}(s),void(null!==this.currentDirection&&i&&i(this.currentDirection));this.updateAxis("x",t.point,s),this.updateAxis("y",t.point,s),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>In((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:n,contextWindow:Wn(this.visualElement)})}stop(e,t){var r;null===(r=this.removeWillChange)||void 0===r||r.call(this);const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:a}=this.getProps();a&&Q.postRender((()=>a(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:n}=this.getProps();if(!r||!Kn(e,n,this.currentDirection))return;const i=this.getAxisMotionValue(e);let a=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:t,max:r},n){return void 0!==t&&e<t?e=n?qt(t,e,n.min):Math.max(e,t):void 0!==r&&e>r&&(e=n?qt(r,e,n.max):Math.min(e,r)),e}(a,this.constraints[e],this.elastic[e])),i.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,i=this.constraints;t&&yn(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!n)&&function(e,{top:t,left:r,bottom:n,right:i}){return{x:Tn(e.x,r,i),y:Tn(e.y,t,n)}}(n.layoutBox,t),this.elastic=function(e=Pn){return!1===e?e=0:!0===e&&(e=Pn),{x:On(e,"left","right"),y:On(e,"top","bottom")}}(r),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&In((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const r={};return void 0!==t.min&&(r.min=t.min-e.min),void 0!==t.max&&(r.max=t.max-e.min),r}(n.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!yn(e))return!1;const r=e.current;T(null!==r,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const i=function(e,t,r){const n=zn(e,r),{scroll:i}=t;return i&&(Zn(n.x,i.offset.x),Zn(n.y,i.offset.y)),n}(r,n.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:Sn(e.x,t.x),y:Sn(e.y,t.y)}}(n.layout.layoutBox,i);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=Cn(e))}return a}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:n,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:s}=this.getProps(),o=this.constraints||{},l=In((s=>{if(!Kn(s,t,this.currentDirection))return;let l=o&&o[s]||{};a&&(l={min:0,max:0});const c=n?200:1e6,u=n?40:1e7,d={type:"inertia",velocity:r?e[s]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...i,...l};return this.startAxisValueAnimation(s,d)}));return Promise.all(l).then(s)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return r.start(Tr(e,r,0,t,this.visualElement,!1,Dr(this.visualElement,e)))}stopAnimation(){In((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){In((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps();return r[t]||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){In((t=>{const{drag:r}=this.getProps();if(!Kn(t,r,this.currentDirection))return;const{projection:n}=this.visualElement,i=this.getAxisMotionValue(t);if(n&&n.layout){const{min:r,max:a}=n.layout.layoutBox[t];i.set(e[t]-qt(r,a,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!yn(t)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};In((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const r=t.get();n[e]=function(e,t){let r=.5;const n=vn(e),i=vn(t);return i>n?r=Wt(t.min,t.max-n,e.min):n>i&&(r=Wt(e.min,e.max-i,t.min)),he(0,1,r)}({min:r,max:r},this.constraints[e])}}));const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),In((t=>{if(!Kn(t,e,null))return;const r=this.getAxisMotionValue(t),{min:i,max:a}=this.constraints[t];r.set(qt(i,a,n[t]))}))}addListeners(){if(!this.visualElement.current)return;qn.set(this.visualElement,this);const e=rn(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:r=!0}=this.getProps();t&&r&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();yn(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,n=r.addEventListener("measure",t);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Q.read(t);const i=tn(window,"resize",(()=>this.scalePositionWithinConstraints())),a=r.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(In((t=>{const r=this.getAxisMotionValue(t);r&&(this.originPoint[t]+=e[t].translate,r.set(r.get()+e[t].translate))})),this.visualElement.render())}));return()=>{i(),e(),n(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:a=Pn,dragMomentum:s=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:n,dragConstraints:i,dragElastic:a,dragMomentum:s}}}function Kn(e,t,r){return!(!0!==t&&t!==e||null!==r&&r!==e)}const Xn=e=>(t,r)=>{e&&Q.postRender((()=>e(t,r)))},Yn=(0,t.createContext)({}),Qn={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ei(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ti={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!Te.test(e))return e;e=parseFloat(e)}return`${ei(e,t.target.x)}% ${ei(e,t.target.y)}%`}},ri={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,i=it.parse(e);if(i.length>5)return n;const a=it.createTransformer(e),s="number"!=typeof i[0]?1:0,o=r.x.scale*t.x,l=r.y.scale*t.y;i[0+s]/=o,i[1+s]/=l;const c=qt(o,l,.5);return"number"==typeof i[2+s]&&(i[2+s]/=c),"number"==typeof i[3+s]&&(i[3+s]/=c),a(i)}},ni={},{schedule:ii,cancel:ai}=Y(queueMicrotask,!1);class si extends t.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:n}=this.props,{projection:i}=e;var a;a=li,Object.assign(ni,a),i&&(t.group&&t.group.add(i),r&&r.register&&n&&r.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",(()=>{this.safeToRemove()})),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Qn.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:n,isPresent:i}=this.props,a=r.projection;return a?(a.isPresent=i,n||e.layoutDependency!==t||void 0===t?a.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?a.promote():a.relegate()||Q.postRender((()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),ii.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:n}=e;n&&(n.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function oi(e){const[r,n]=function(){const e=(0,t.useContext)(m);if(null===e)return[!0,null];const{isPresent:r,onExitComplete:n,register:i}=e,a=(0,t.useId)();(0,t.useEffect)((()=>i(a)),[]);const s=(0,t.useCallback)((()=>n&&n(a)),[a,n]);return!r&&n?[!1,s]:[!0]}(),i=(0,t.useContext)(_);return(0,p.jsx)(si,{...e,layoutGroup:i,switchLayoutGroup:(0,t.useContext)(Yn),isPresent:r,safeToRemove:n})}const li={borderRadius:{...ti,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ti,borderTopRightRadius:ti,borderBottomLeftRadius:ti,borderBottomRightRadius:ti,boxShadow:ri},ci=["TopLeft","TopRight","BottomLeft","BottomRight"],ui=ci.length,di=e=>"string"==typeof e?parseFloat(e):e,hi=e=>"number"==typeof e||Te.test(e);function pi(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const mi=gi(0,.5,Ut),fi=gi(.5,.95,x);function gi(e,t,r){return n=>n<e?0:n>t?1:r(Wt(e,t,n))}function yi(e,t){e.min=t.min,e.max=t.max}function vi(e,t){yi(e.x,t.x),yi(e.y,t.y)}function bi(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function wi(e,t,r,n,i){return e=Mn(e-=t,1/r,n),void 0!==i&&(e=Mn(e,1/i,n)),e}function _i(e,t,[r,n,i],a,s){!function(e,t=0,r=1,n=.5,i,a=e,s=e){if(Ee.test(t)&&(t=parseFloat(t),t=qt(s.min,s.max,t/100)-s.min),"number"!=typeof t)return;let o=qt(a.min,a.max,n);e===a&&(o-=t),e.min=wi(e.min,t,r,o,i),e.max=wi(e.max,t,r,o,i)}(e,t[r],t[n],t[i],t.scale,a,s)}const xi=["x","scaleX","originX"],Ei=["y","scaleY","originY"];function Ti(e,t,r,n){_i(e.x,t,xi,r?r.x:void 0,n?n.x:void 0),_i(e.y,t,Ei,r?r.y:void 0,n?n.y:void 0)}function Si(e){return 0===e.translate&&1===e.scale}function Pi(e){return Si(e.x)&&Si(e.y)}function Oi(e,t){return e.min===t.min&&e.max===t.max}function ki(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Ai(e,t){return ki(e.x,t.x)&&ki(e.y,t.y)}function Ii(e){return vn(e.x)/vn(e.y)}function Ci(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Ri{constructor(){this.members=[]}add(e){Sr(this.members,e),e.scheduleRender()}remove(e){if(Pr(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let r;for(let e=t;e>=0;e--){const t=this.members[e];if(!1!==t.isPresent){r=t;break}}return!!r&&(this.promote(r),!0)}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;!1===n&&r.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const ji=(e,t)=>e.depth-t.depth;class Ni{constructor(){this.children=[],this.isDirty=!1}add(e){Sr(this.children,e),this.isDirty=!0}remove(e){Pr(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ji),this.isDirty=!1,this.children.forEach(e)}}function $i(e){const t=Mr(e)?e.get():e;return r=t,Boolean(r&&"object"==typeof r&&r.mix&&r.toValue)?t.toValue():t;var r}const Li={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Mi="undefined"!=typeof window&&void 0!==window.MotionDebug,Di=["","X","Y","Z"],Ui={visibility:"hidden"};let Fi=0;function Vi(e,t,r,n){const{latestValues:i}=t;i[e]&&(r[e]=i[e],t.setStaticValue(e,0),n&&(n[e]=0))}function Bi(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=Nr(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:t,layoutId:n}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Q,!(t||n))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&Bi(n)}function Zi({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:i}){return class{constructor(e={},r=(null==t?void 0:t())){this.id=Fi++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Mi&&(Li.totalNodes=Li.resolvedTargetDeltas=Li.recalculatedProjection=0),this.nodes.forEach(zi),this.nodes.forEach(Qi),this.nodes.forEach(ea),this.nodes.forEach(Wi),Mi&&window.MotionDebug.record(Li)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new Ni)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Or),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const r=this.eventHandlers.get(e);r&&r.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t,r=this.root.hasTreeAnimated){if(this.instance)return;var n;this.isSVG=(n=t)instanceof SVGElement&&"svg"!==n.tagName,this.instance=t;const{layoutId:i,layout:a,visualElement:s}=this.options;if(s&&!s.current&&s.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),r&&(a||i)&&(this.isLayoutDirty=!0),e){let r;const n=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,r&&r(),r=function(e){const t=bt.now(),r=({timestamp:n})=>{const i=n-t;i>=250&&(ee(r),e(i-250))};return Q.read(r,!0),()=>ee(r)}(n),Qn.hasAnimatedSinceResize&&(Qn.hasAnimatedSinceResize=!1,this.nodes.forEach(Yi))}))}i&&this.root.registerSharedNode(i,this),!1!==this.options.animate&&s&&(i||a)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeTargetChanged:r,layout:n})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const i=this.options.transition||s.getDefaultTransition()||sa,{onLayoutAnimationStart:a,onLayoutAnimationComplete:o}=s.getProps(),l=!this.targetLayout||!Ai(this.targetLayout,n)||r,c=!t&&r;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const t={...q(i,"layout"),onPlay:a,onComplete:o};(s.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else t||Yi(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=n}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ee(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ta),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Bi(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){const t=this.path[e];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}const{layoutId:t,layout:r}=this.options;if(void 0===t&&!r)return;const n=this.getTransformTemplate();this.prevTransformTemplateValue=n?n(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(Ji);this.isUpdating||this.nodes.forEach(Ki),this.isUpdating=!1,this.nodes.forEach(Xi),this.nodes.forEach(Hi),this.nodes.forEach(Gi),this.clearAllSnapshots();const e=bt.now();te.delta=he(0,1e3/60,e-te.timestamp),te.timestamp=e,te.isProcessing=!0,re.update.process(te),re.preRender.process(te),re.render.process(te),te.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ii.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qi),this.sharedNodes.forEach(ra)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Q.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Q.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++)this.path[e].updateScroll();const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=n(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Pi(this.projectionDelta),r=this.getTransformTemplate(),n=r?r(this.latestValues,""):void 0,a=n!==this.prevTransformTemplateValue;e&&(t||Nn(this.latestValues)||a)&&(i(this.instance,n),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let r=this.removeElementScroll(t);var n;return e&&(r=this.removeTransform(r)),ca((n=r).x),ca(n.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:r,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const r=t.measureViewportBox();if(!(null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)&&!this.path.some(da)){const{scroll:e}=this.root;e&&(Zn(r.x,e.offset.x),Zn(r.y,e.offset.y))}return r}removeElementScroll(e){var t;const r={x:{min:0,max:0},y:{min:0,max:0}};if(vi(r,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return r;for(let t=0;t<this.path.length;t++){const n=this.path[t],{scroll:i,options:a}=n;n!==this.root&&i&&a.layoutScroll&&(i.wasRoot&&vi(r,e),Zn(r.x,i.offset.x),Zn(r.y,i.offset.y))}return r}applyTransform(e,t=!1){const r={x:{min:0,max:0},y:{min:0,max:0}};vi(r,e);for(let e=0;e<this.path.length;e++){const n=this.path[e];!t&&n.options.layoutScroll&&n.scroll&&n!==n.root&&Gn(r,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),Nn(n.latestValues)&&Gn(r,n.latestValues)}return Nn(this.latestValues)&&Gn(r,this.latestValues),r}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};vi(t,e);for(let e=0;e<this.path.length;e++){const r=this.path[e];if(!r.instance)continue;if(!Nn(r.latestValues))continue;jn(r.latestValues)&&r.updateSnapshot();const n={x:{min:0,max:0},y:{min:0,max:0}};vi(n,r.measurePageBox()),Ti(t,r.latestValues,r.snapshot?r.snapshot.layoutBox:void 0,n)}return Nn(this.latestValues)&&Ti(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==te.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const r=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=r.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=r.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=r.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==r;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:i,layoutId:a}=this.options;if(this.layout&&(i||a)){if(this.resolvedRelativeTargetAt=te.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},En(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),vi(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var s,o,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),s=this.target,o=this.relativeTarget,l=this.relativeParent.target,_n(s.x,o.x,l.x),_n(s.y,o.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):vi(this.target,this.layout.layoutBox),Fn(this.target,this.targetDelta)):vi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},En(this.relativeTargetOrigin,this.target,e.target),vi(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Mi&&Li.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!jn(this.parent.latestValues)&&!$n(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),r=Boolean(this.resumingFrom)||this!==t;let n=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(n=!1),r&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===te.timestamp&&(n=!1),n)return;const{layout:i,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!i&&!a)return;vi(this.layoutCorrected,this.layout.layoutBox);const s=this.treeScale.x,o=this.treeScale.y;!function(e,t,r,n=!1){const i=r.length;if(!i)return;let a,s;t.x=t.y=1;for(let o=0;o<i;o++){a=r[o],s=a.projectionDelta;const{visualElement:i}=a.options;i&&i.props.style&&"contents"===i.props.style.display||(n&&a.options.layoutScroll&&a.scroll&&a!==a.root&&Gn(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,Fn(e,s)),n&&Nn(a.latestValues)&&Gn(e,a.latestValues))}t.x<Bn&&t.x>Vn&&(t.x=1),t.y<Bn&&t.y>Vn&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,r),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(bi(this.prevProjectionDelta.x,this.projectionDelta.x),bi(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),wn(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===s&&this.treeScale.y===o&&Ci(this.projectionDelta.x,this.prevProjectionDelta.x)&&Ci(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Mi&&Li.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const r=this.snapshot,n=r?r.latestValues:{},i={...this.latestValues},a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const s={x:{min:0,max:0},y:{min:0,max:0}},o=(r?r.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(aa));let d;this.animationProgress=0,this.mixTargetDelta=t=>{const r=t/1e3;var l,h,p,m,f,g;na(a.x,e.x,r),na(a.y,e.y,r),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(En(s,this.layout.layoutBox,this.relativeParent.layout.layoutBox),p=this.relativeTarget,m=this.relativeTargetOrigin,f=s,g=r,ia(p.x,m.x,f.x,g),ia(p.y,m.y,f.y,g),d&&(l=this.relativeTarget,h=d,Oi(l.x,h.x)&&Oi(l.y,h.y))&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),vi(d,this.relativeTarget)),o&&(this.animationValues=i,function(e,t,r,n,i,a){i?(e.opacity=qt(0,void 0!==r.opacity?r.opacity:1,mi(n)),e.opacityExit=qt(void 0!==t.opacity?t.opacity:1,0,fi(n))):a&&(e.opacity=qt(void 0!==t.opacity?t.opacity:1,void 0!==r.opacity?r.opacity:1,n));for(let i=0;i<ui;i++){const a=`border${ci[i]}Radius`;let s=pi(t,a),o=pi(r,a);void 0===s&&void 0===o||(s||(s=0),o||(o=0),0===s||0===o||hi(s)===hi(o)?(e[a]=Math.max(qt(di(s),di(o),n),0),(Ee.test(o)||Ee.test(s))&&(e[a]+="%")):e[a]=o)}(t.rotate||r.rotate)&&(e.rotate=qt(t.rotate||0,r.rotate||0,n))}(i,n,this.latestValues,r,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=r},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ee(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Q.update((()=>{Qn.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,r){const n=Mr(0)?0:Ir(0);return n.start(Tr("",n,1e3,r)),n.animation}(0,0,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:r,layout:n,latestValues:i}=e;if(t&&r&&n){if(this!==e&&this.layout&&n&&ua(this.options.animationType,this.layout.layoutBox,n.layoutBox)){r=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=vn(this.layout.layoutBox.x);r.x.min=e.target.x.min,r.x.max=r.x.min+t;const n=vn(this.layout.layoutBox.y);r.y.min=e.target.y.min,r.y.max=r.y.min+n}vi(t,r),Gn(t,i),wn(this.projectionDeltaWithTransform,this.layoutCorrected,t,i)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Ri),this.sharedNodes.get(e).add(t);const r=t.options.initialPromotionConfig;t.promote({transition:r?r.transition:void 0,preserveFollowOpacity:r&&r.shouldPreserveFollowOpacity?r.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:r}={}){const n=this.getStack();n&&n.promote(this,r),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:r}=e;if((r.z||r.rotate||r.rotateX||r.rotateY||r.rotateZ||r.skewX||r.skewY)&&(t=!0),!t)return;const n={};r.z&&Vi("z",e,n,this.animationValues);for(let t=0;t<Di.length;t++)Vi(`rotate${Di[t]}`,e,n,this.animationValues),Vi(`skew${Di[t]}`,e,n,this.animationValues);e.render();for(const t in n)e.setStaticValue(t,n[t]),this.animationValues&&(this.animationValues[t]=n[t]);e.scheduleRender()}getProjectionStyles(e){var t,r;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Ui;const n={visibility:""},i=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,n.opacity="",n.pointerEvents=$i(null==e?void 0:e.pointerEvents)||"",n.transform=i?i(this.latestValues,""):"none",n;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=$i(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!Nn(this.latestValues)&&(t.transform=i?i({},""):"none",this.hasProjected=!1),t}const s=a.animationValues||a.latestValues;this.applyTransformsToTarget(),n.transform=function(e,t,r){let n="";const i=e.x.translate/t.x,a=e.y.translate/t.y,s=(null==r?void 0:r.z)||0;if((i||a||s)&&(n=`translate3d(${i}px, ${a}px, ${s}px) `),1===t.x&&1===t.y||(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:e,rotate:t,rotateX:i,rotateY:a,skewX:s,skewY:o}=r;e&&(n=`perspective(${e}px) ${n}`),t&&(n+=`rotate(${t}deg) `),i&&(n+=`rotateX(${i}deg) `),a&&(n+=`rotateY(${a}deg) `),s&&(n+=`skewX(${s}deg) `),o&&(n+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(n+=`scale(${o}, ${l})`),n||"none"}(this.projectionDeltaWithTransform,this.treeScale,s),i&&(n.transform=i(s,n.transform));const{x:o,y:l}=this.projectionDelta;n.transformOrigin=`${100*o.origin}% ${100*l.origin}% 0`,a.animationValues?n.opacity=a===this?null!==(r=null!==(t=s.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==r?r:1:this.preserveOpacity?this.latestValues.opacity:s.opacityExit:n.opacity=a===this?void 0!==s.opacity?s.opacity:"":void 0!==s.opacityExit?s.opacityExit:0;for(const e in ni){if(void 0===s[e])continue;const{correct:t,applyTo:r}=ni[e],i="none"===n.transform?s[e]:t(s[e],a);if(r){const e=r.length;for(let t=0;t<e;t++)n[r[t]]=i}else n[e]=i}return this.options.layoutId&&(n.pointerEvents=a===this?$i(null==e?void 0:e.pointerEvents)||"":"none"),n}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(Ji),this.root.sharedNodes.clear()}}}function Hi(e){e.updateLayout()}function Gi(e){var t;const r=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:n}=e.layout,{animationType:i}=e.options,a=r.source!==e.layout.source;"size"===i?In((e=>{const n=a?r.measuredBox[e]:r.layoutBox[e],i=vn(n);n.min=t[e].min,n.max=n.min+i})):ua(i,r.layoutBox,t)&&In((n=>{const i=a?r.measuredBox[n]:r.layoutBox[n],s=vn(t[n]);i.max=i.min+s,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[n].max=e.relativeTarget[n].min+s)}));const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};wn(s,t,r.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?wn(o,e.applyTransform(n,!0),r.measuredBox):wn(o,t,r.layoutBox);const l=!Pi(s);let c=!1;if(!e.resumeFrom){const n=e.getClosestProjectingParent();if(n&&!n.resumeFrom){const{snapshot:i,layout:a}=n;if(i&&a){const s={x:{min:0,max:0},y:{min:0,max:0}};En(s,r.layoutBox,i.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};En(o,t,a.layoutBox),Ai(s,o)||(c=!0),n.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=s,e.relativeParent=n)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:r,delta:o,layoutDelta:s,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function zi(e){Mi&&Li.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Wi(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function qi(e){e.clearSnapshot()}function Ji(e){e.clearMeasurements()}function Ki(e){e.isLayoutDirty=!1}function Xi(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Yi(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Qi(e){e.resolveTargetDelta()}function ea(e){e.calcProjection()}function ta(e){e.resetSkewAndRotation()}function ra(e){e.removeLeadSnapshot()}function na(e,t,r){e.translate=qt(t.translate,0,r),e.scale=qt(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function ia(e,t,r,n){e.min=qt(t.min,r.min,n),e.max=qt(t.max,r.max,n)}function aa(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const sa={duration:.45,ease:[.4,0,.1,1]},oa=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),la=oa("applewebkit/")&&!oa("chrome/")?Math.round:x;function ca(e){e.min=la(e.min),e.max=la(e.max)}function ua(e,t,r){return"position"===e||"preserve-aspect"===e&&(n=Ii(t),i=Ii(r),!(Math.abs(n-i)<=.2));var n,i}function da(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const ha=Zi({attachResizeListener:(e,t)=>tn(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),pa={current:void 0},ma=Zi({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!pa.current){const e=new ha({});e.mount(window),e.setOptions({layoutScroll:!0}),pa.current=e}return pa.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),fa={pan:{Feature:class extends Kr{constructor(){super(...arguments),this.removePointerDownListener=x}onPointerDown(e){this.session=new an(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Wn(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:Xn(e),onStart:Xn(t),onMove:r,onEnd:(e,t)=>{delete this.session,n&&Q.postRender((()=>n(e,t)))}}}mount(){this.removePointerDownListener=rn(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Kr{constructor(e){super(e),this.removeGroupControls=x,this.removeListeners=x,this.controls=new Jn(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||x}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:ma,MeasureLayout:oi}};function ga(e,t){const r=t?"pointerenter":"pointerleave",n=t?"onHoverStart":"onHoverEnd";return rn(e.current,r,((r,i)=>{if("touch"===r.pointerType||gn())return;const a=e.getProps();e.animationState&&a.whileHover&&e.animationState.setActive("whileHover",t);const s=a[n];s&&Q.postRender((()=>s(r,i)))}),{passive:!e.getProps()[n]})}const ya=(e,t)=>!!t&&(e===t||ya(e,t.parentElement));function va(e,t){if(!t)return;const r=new PointerEvent("pointer"+e);t(r,en(r))}const ba=new WeakMap,wa=new WeakMap,_a=e=>{const t=ba.get(e.target);t&&t(e)},xa=e=>{e.forEach(_a)};const Ea={some:0,all:1},Ta={inView:{Feature:class extends Kr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:n="some",once:i}=e,a={root:t?t.current:void 0,rootMargin:r,threshold:"number"==typeof n?n:Ea[n]};return function(e,t,r){const n=function({root:e,...t}){const r=e||document;wa.has(r)||wa.set(r,{});const n=wa.get(r),i=JSON.stringify(t);return n[i]||(n[i]=new IntersectionObserver(xa,{root:e,...t})),n[i]}(t);return ba.set(e,r),n.observe(e),()=>{ba.delete(e),n.unobserve(e)}}(this.node.current,a,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,i&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:r,onViewportLeave:n}=this.node.getProps(),a=t?r:n;a&&a(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Kr{constructor(){super(...arguments),this.removeStartListeners=x,this.removeEndListeners=x,this.removeAccessibleListeners=x,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const r=this.node.getProps(),n=rn(window,"pointerup",((e,t)=>{if(!this.checkPressEnd())return;const{onTap:r,onTapCancel:n,globalTapTarget:i}=this.node.getProps(),a=i||ya(this.node.current,e.target)?r:n;a&&Q.update((()=>a(e,t)))}),{passive:!(r.onTap||r.onPointerUp)}),i=rn(window,"pointercancel",((e,t)=>this.cancelPress(e,t)),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=zt(n,i),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=tn(this.node.current,"keydown",(e=>{"Enter"!==e.key||this.isPressing||(this.removeEndListeners(),this.removeEndListeners=tn(this.node.current,"keyup",(e=>{"Enter"===e.key&&this.checkPressEnd()&&va("up",((e,t)=>{const{onTap:r}=this.node.getProps();r&&Q.postRender((()=>r(e,t)))}))})),va("down",((e,t)=>{this.startPress(e,t)})))})),t=tn(this.node.current,"blur",(()=>{this.isPressing&&va("cancel",((e,t)=>this.cancelPress(e,t)))}));this.removeAccessibleListeners=zt(e,t)}}startPress(e,t){this.isPressing=!0;const{onTapStart:r,whileTap:n}=this.node.getProps();n&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&Q.postRender((()=>r(e,t)))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!gn()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&Q.postRender((()=>r(e,t)))}mount(){const e=this.node.getProps(),t=rn(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),r=tn(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=zt(t,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends Kr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=zt(tn(this.node.current,"focus",(()=>this.onFocus())),tn(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends Kr{mount(){this.unmount=zt(ga(this.node,!0),ga(this.node,!1))}unmount(){}}}},Sa={layout:{ProjectionNode:ma,MeasureLayout:oi}},Pa=(0,t.createContext)({}),Oa=(0,t.createContext)({strict:!1});let ka=!1;function Aa(e,r,n,i,a){var s;const{visualElement:o}=(0,t.useContext)(Pa),l=(0,t.useContext)(Oa),c=(0,t.useContext)(m),u=(0,t.useContext)(g).reducedMotion,d=(0,t.useRef)();i=i||l.renderer,!d.current&&i&&(d.current=i(e,{visualState:r,parent:o,props:n,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const h=d.current,p=(0,t.useContext)(Yn);!h||h.projection||!a||"html"!==h.type&&"svg"!==h.type||function(e,t,r,n){const{layoutId:i,layout:a,drag:s,dragConstraints:o,layoutScroll:l,layoutRoot:c}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:Ca(e.parent)),e.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:Boolean(s)||o&&yn(o),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:n,layoutScroll:l,layoutRoot:c})}(d.current,n,a,p),(0,t.useInsertionEffect)((()=>{h&&h.update(n,c)}));const f=n[jr],y=(0,t.useRef)(Boolean(f)&&!window.MotionHandoffIsComplete&&(null===(s=window.MotionHasOptimisedAnimation)||void 0===s?void 0:s.call(window,f)));return k((()=>{h&&(h.updateFeatures(),ii.render(h.render),y.current&&h.animationState&&h.animationState.animateChanges())})),(0,t.useEffect)((()=>{h&&(!y.current&&h.animationState&&h.animationState.animateChanges(),y.current=!1,ka||(ka=!0,queueMicrotask(Ia)))})),h}function Ia(){window.MotionHandoffIsComplete=!0}function Ca(e){if(e)return!1!==e.options.allowProjection?e.projection:Ca(e.parent)}function Ra(e,r,n){return(0,t.useCallback)((t=>{t&&e.mount&&e.mount(t),r&&(t?r.mount(t):r.unmount()),n&&("function"==typeof n?n(t):yn(n)&&(n.current=t))}),[r])}function ja(e){return C(e.animate)||U.some((t=>N(e[t])))}function Na(e){return Boolean(ja(e)||e.variants)}function $a(e){return Array.isArray(e)?e.join(" "):e}const La={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ma={};for(const e in La)Ma[e]={isEnabled:t=>La[e].some((e=>!!t[e]))};const Da=Symbol.for("motionComponentSymbol");function Ua({preloadedFeatures:e,createVisualElement:r,useRender:n,useVisualState:i,Component:a}){e&&function(e){for(const t in e)Ma[t]={...Ma[t],...e[t]}}(e);const s=(0,t.forwardRef)((function(e,s){let o;const l={...(0,t.useContext)(g),...e,layoutId:Fa(e)},{isStatic:c}=l,u=function(e){const{initial:r,animate:n}=function(e,t){if(ja(e)){const{initial:t,animate:r}=e;return{initial:!1===t||N(t)?t:void 0,animate:N(r)?r:void 0}}return!1!==e.inherit?t:{}}(e,(0,t.useContext)(Pa));return(0,t.useMemo)((()=>({initial:r,animate:n})),[$a(r),$a(n)])}(e),d=i(e,c);if(!c&&O){(0,t.useContext)(Oa).strict;const e=function(e){const{drag:t,layout:r}=Ma;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:(null==t?void 0:t.isEnabled(e))||(null==r?void 0:r.isEnabled(e))?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}(l);o=e.MeasureLayout,u.visualElement=Aa(a,d,l,r,e.ProjectionNode)}return(0,p.jsxs)(Pa.Provider,{value:u,children:[o&&u.visualElement?(0,p.jsx)(o,{visualElement:u.visualElement,...l}):null,n(a,e,Ra(d,u.visualElement,s),d,c,u.visualElement)]})}));return s[Da]=a,s}function Fa({layoutId:e}){const r=(0,t.useContext)(_).id;return r&&void 0!==e?r+"-"+e:e}const Va=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Ba(e){return"string"==typeof e&&!e.includes("-")&&!!(Va.indexOf(e)>-1||/[A-Z]/u.test(e))}function Za(e,{style:t,vars:r},n,i){Object.assign(e.style,t,i&&i.getProjectionStyles(n));for(const t in r)e.style.setProperty(t,r[t])}const Ha=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Ga(e,t,r,n){Za(e,t,void 0,n);for(const r in t.attrs)e.setAttribute(Ha.has(r)?r:Rr(r),t.attrs[r])}function za(e,{layout:t,layoutId:r}){return V.has(e)||e.startsWith("origin")||(t||void 0!==r)&&(!!ni[e]||"opacity"===e)}function Wa(e,t,r){var n;const{style:i}=e,a={};for(const s in i)(Mr(i[s])||t.style&&Mr(t.style[s])||za(s,e)||void 0!==(null===(n=null==r?void 0:r.getValue(s))||void 0===n?void 0:n.liveStyle))&&(a[s]=i[s]);return r&&i&&"string"==typeof i.willChange&&(r.applyWillChange=!1),a}function qa(e,t,r){const n=Wa(e,t,r);for(const r in e)(Mr(e[r])||Mr(t[r]))&&(n[-1!==F.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]);return n}const Ja=e=>(r,n)=>{const i=(0,t.useContext)(Pa),a=(0,t.useContext)(m),s=()=>function({applyWillChange:e=!1,scrapeMotionValuesFromProps:t,createRenderState:r,onMount:n},i,a,s,o){const l={latestValues:Ya(i,a,s,!o&&e,t),renderState:r()};return n&&(l.mount=e=>n(i,e,l)),l}(e,r,i,a,n);return n?s():f(s)};function Ka(e,t){const r=$r(t);r&&Sr(e,r)}function Xa(e,t,r){const n=Array.isArray(t)?t:[t];for(let t=0;t<n.length;t++){const i=L(e,n[t]);if(i){const{transitionEnd:e,transition:t,...n}=i;r(n,e)}}}function Ya(e,t,r,n,i){var a;const s={},o=[],l=n&&void 0===(null===(a=e.style)||void 0===a?void 0:a.willChange),c=i(e,{});for(const e in c)s[e]=$i(c[e]);let{initial:u,animate:d}=e;const h=ja(e),p=Na(e);t&&p&&!h&&!1!==e.inherit&&(void 0===u&&(u=t.initial),void 0===d&&(d=t.animate));let m=!!r&&!1===r.initial;m=m||!1===u;const f=m?d:u;return f&&"boolean"!=typeof f&&!C(f)&&Xa(e,f,((e,t)=>{for(const t in e){let r=e[t];Array.isArray(r)&&(r=r[m?r.length-1:0]),null!==r&&(s[t]=r)}for(const e in t)s[e]=t[e]})),l&&(d&&!1!==u&&!C(d)&&Xa(e,d,(e=>{for(const t in e)Ka(o,t)})),o.length&&(s.willChange=o.join(","))),s}const Qa=(e,t)=>t&&"number"==typeof e?t.transform(e):e,es={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},ts=F.length;function rs(e,t,r){const{style:n,vars:i,transformOrigin:a}=e;let s=!1,o=!1;for(const e in t){const r=t[e];if(V.has(e))s=!0;else if(se(e))i[e]=r;else{const t=Qa(r,ut[e]);e.startsWith("origin")?(o=!0,a[e]=t):n[e]=t}}if(t.transform||(s||r?n.transform=function(e,t,r){let n="",i=!0;for(let a=0;a<ts;a++){const s=F[a],o=e[s];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(s.startsWith("scale")?1:0):0===parseFloat(o),!l||r){const e=Qa(o,ut[s]);l||(i=!1,n+=`${es[s]||s}(${e}) `),r&&(t[s]=e)}}return n=n.trim(),r?n=r(t,i?"":n):i&&(n="none"),n}(t,e.transform,r):n.transform&&(n.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:r=0}=a;n.transformOrigin=`${e} ${t} ${r}`}}function ns(e,t,r){return"string"==typeof e?e:Te.transform(t+r*e)}const is={offset:"stroke-dashoffset",array:"stroke-dasharray"},as={offset:"strokeDashoffset",array:"strokeDasharray"};function ss(e,{attrX:t,attrY:r,attrScale:n,originX:i,originY:a,pathLength:s,pathSpacing:o=1,pathOffset:l=0,...c},u,d){if(rs(e,c,d),u)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:h,style:p,dimensions:m}=e;h.transform&&(m&&(p.transform=h.transform),delete h.transform),m&&(void 0!==i||void 0!==a||p.transform)&&(p.transformOrigin=function(e,t,r){return`${ns(t,e.x,e.width)} ${ns(r,e.y,e.height)}`}(m,void 0!==i?i:.5,void 0!==a?a:.5)),void 0!==t&&(h.x=t),void 0!==r&&(h.y=r),void 0!==n&&(h.scale=n),void 0!==s&&function(e,t,r=1,n=0,i=!0){e.pathLength=1;const a=i?is:as;e[a.offset]=Te.transform(-n);const s=Te.transform(t),o=Te.transform(r);e[a.array]=`${s} ${o}`}(h,s,o,l,!1)}const os=e=>"string"==typeof e&&"svg"===e.toLowerCase(),ls={useVisualState:Ja({scrapeMotionValuesFromProps:qa,createRenderState:()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),onMount:(e,t,{renderState:r,latestValues:n})=>{Q.read((()=>{try{r.dimensions="function"==typeof t.getBBox?t.getBBox():t.getBoundingClientRect()}catch(e){r.dimensions={x:0,y:0,width:0,height:0}}})),Q.render((()=>{ss(r,n,os(t.tagName),e.transformTemplate),Ga(t,r)}))}})},cs={useVisualState:Ja({applyWillChange:!0,scrapeMotionValuesFromProps:Wa,createRenderState:()=>({style:{},transform:{},transformOrigin:{},vars:{}})})};function us(e,t,r){for(const n in t)Mr(t[n])||za(n,r)||(e[n]=t[n])}function ds(e,r){const n={},i=function(e,r){const n={};return us(n,e.style||{},e),Object.assign(n,function({transformTemplate:e},r){return(0,t.useMemo)((()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return rs(t,r,e),Object.assign({},t.vars,t.style)}),[r])}(e,r)),n}(e,r);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const hs=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ps(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||hs.has(e)}let ms=e=>!ps(e);try{(fs=require("@emotion/is-prop-valid").default)&&(ms=e=>e.startsWith("on")?!ps(e):fs(e))}catch(e){}var fs;function gs(e,r,n,i){const a=(0,t.useMemo)((()=>{const t={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return ss(t,r,os(i),e.transformTemplate),{...t.attrs,style:{...t.style}}}),[r]);if(e.style){const t={};us(t,e.style,e),a.style={...t,...a.style}}return a}function ys(e=!1){return(r,n,i,{latestValues:a},s)=>{const o=(Ba(r)?gs:ds)(n,a,s,r),l=function(e,t,r){const n={};for(const i in e)"values"===i&&"object"==typeof e.values||(ms(i)||!0===r&&ps(i)||!t&&!ps(i)||e.draggable&&i.startsWith("onDrag"))&&(n[i]=e[i]);return n}(n,"string"==typeof r,e),c=r!==t.Fragment?{...l,...o,ref:i}:{},{children:u}=n,d=(0,t.useMemo)((()=>Mr(u)?u.get():u),[u]);return(0,t.createElement)(r,{...c,children:d})}}function vs(e,t){return function(r,{forwardMotionProps:n}={forwardMotionProps:!1}){return Ua({...Ba(r)?ls:cs,preloadedFeatures:e,useRender:ys(n),createVisualElement:t,Component:r})}}const bs={current:null},ws={current:!1},_s=new WeakMap,xs=[...Le,Ke,it],Es=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Ts{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:i,visualState:a},s={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Ze,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=bt.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Q.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=a;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=s,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=ja(t),this.isVariantNode=Na(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(t,{},this);for(const e in u){const t=u[e];void 0!==o[e]&&Mr(t)&&t.set(o[e],!1)}}mount(e){this.current=e,_s.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),ws.current||function(){if(ws.current=!0,O)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>bs.current=e.matches;e.addListener(t),t()}else bs.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||bs.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){_s.delete(this.current),this.projection&&this.projection.unmount(),ee(this.notifyUpdate),ee(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=V.has(e),n=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Q.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)})),i=t.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{n(),i(),a&&a(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Ma){const t=Ma[e];if(!t)continue;const{isEnabled:r,Feature:n}=t;if(!this.features[e]&&n&&r(this.props)&&(this.features[e]=new n(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let t=0;t<Es.length;t++){const r=Es[t];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const n=e["on"+r];n&&(this.propEventSubscriptions[r]=this.on(r,n))}this.prevMotionValues=function(e,t,r){for(const n in t){const i=t[n],a=r[n];if(Mr(i))e.addValue(n,i);else if(Mr(a))e.addValue(n,Ir(i,{owner:e}));else if(a!==i)if(e.hasValue(n)){const t=e.getValue(n);!0===t.liveStyle?t.jump(i):t.hasAnimated||t.set(i)}else{const t=e.getStaticValue(n);e.addValue(n,Ir(void 0!==t?t:i,{owner:e}))}}for(const n in r)void 0===t[n]&&e.removeValue(n);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return void 0===r&&void 0!==t&&(r=Ir(null===t?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){var r;let n=void 0===this.latestValues[e]&&this.current?null!==(r=this.getBaseTargetFromProps(this.props,e))&&void 0!==r?r:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var i;return null!=n&&("string"==typeof n&&(ie(n)||ne(n))?n=parseFloat(n):(i=n,!xs.find($e(i))&&it.test(t)&&(n=pt(e,t))),this.setBaseTarget(e,Mr(n)?n.get():n)),Mr(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:r}=this.props;let n;if("string"==typeof r||"object"==typeof r){const i=L(this.props,r,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);i&&(n=i[e])}if(r&&void 0!==n)return n;const i=this.getBaseTargetFromProps(this.props,e);return void 0===i||Mr(i)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:i}on(e,t){return this.events[e]||(this.events[e]=new Or),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class Ss extends Ts{constructor(){super(...arguments),this.KeyframeResolver=ft}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}}class Ps extends Ss{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=Za}readValueFromInstance(e,t){if(V.has(t)){const e=ht(t);return e&&e.default||0}{const n=(r=e,window.getComputedStyle(r)),i=(se(t)?n.getPropertyValue(t):n[t])||0;return"string"==typeof i?i.trim():i}var r}measureInstanceViewportBox(e,{transformPagePoint:t}){return zn(e,t)}build(e,t,r){rs(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return Wa(e,t,r)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Mr(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}class Os extends Ss{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=An}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(V.has(t)){const e=ht(t);return e&&e.default||0}return t=Ha.has(t)?t:Rr(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return qa(e,t,r)}build(e,t,r){ss(e,t,this.isSVGTag,r.transformTemplate)}renderInstance(e,t,r,n){Ga(e,t,0,n)}mount(e){this.isSVGTag=os(e.tagName),super.mount(e)}}const ks=I(vs({...Yr,...Ta,...fa,...Sa},((e,r)=>Ba(e)?new Os(r):new Ps(r,{allowProjection:e!==t.Fragment}))));var As,Is;!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(As||(As={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(Is||(Is={}));const Cs=As.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rs=e=>{switch(typeof e){case"undefined":return Cs.undefined;case"string":return Cs.string;case"number":return isNaN(e)?Cs.nan:Cs.number;case"boolean":return Cs.boolean;case"function":return Cs.function;case"bigint":return Cs.bigint;case"symbol":return Cs.symbol;case"object":return Array.isArray(e)?Cs.array:null===e?Cs.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Cs.promise:"undefined"!=typeof Map&&e instanceof Map?Cs.map:"undefined"!=typeof Set&&e instanceof Set?Cs.set:"undefined"!=typeof Date&&e instanceof Date?Cs.date:Cs.object;default:return Cs.unknown}},js=As.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ns extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(n);else if("invalid_return_type"===i.code)n(i.returnTypeError);else if("invalid_arguments"===i.code)n(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){const r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof Ns))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,As.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Ns.create=e=>new Ns(e);const $s=(e,t)=>{let r;switch(e.code){case js.invalid_type:r=e.received===Cs.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case js.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,As.jsonStringifyReplacer)}`;break;case js.unrecognized_keys:r=`Unrecognized key(s) in object: ${As.joinValues(e.keys,", ")}`;break;case js.invalid_union:r="Invalid input";break;case js.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${As.joinValues(e.options)}`;break;case js.invalid_enum_value:r=`Invalid enum value. Expected ${As.joinValues(e.options)}, received '${e.received}'`;break;case js.invalid_arguments:r="Invalid function arguments";break;case js.invalid_return_type:r="Invalid function return type";break;case js.invalid_date:r="Invalid date";break;case js.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:As.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case js.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case js.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case js.custom:r="Invalid input";break;case js.invalid_intersection_types:r="Intersection results could not be merged";break;case js.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case js.not_finite:r="Number must be finite";break;default:r=t.defaultError,As.assertNever(e)}return{message:r}};let Ls=$s;function Ms(){return Ls}const Ds=e=>{const{data:t,path:r,errorMaps:n,issueData:i}=e,a=[...r,...i.path||[]],s={...i,path:a};if(void 0!==i.message)return{...i,path:a,message:i.message};let o="";const l=n.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(s,{data:t,defaultError:o}).message;return{...i,path:a,message:o}};function Us(e,t){const r=Ms(),n=Ds({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===$s?void 0:$s].filter((e=>!!e))});e.common.issues.push(n)}class Fs{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if("aborted"===n.status)return Vs;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,n=await e.value;r.push({key:t,value:n})}return Fs.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:t,value:i}=n;if("aborted"===t.status)return Vs;if("aborted"===i.status)return Vs;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===t.value||void 0===i.value&&!n.alwaysSet||(r[t.value]=i.value)}return{status:e.value,value:r}}}const Vs=Object.freeze({status:"aborted"}),Bs=e=>({status:"dirty",value:e}),Zs=e=>({status:"valid",value:e}),Hs=e=>"aborted"===e.status,Gs=e=>"dirty"===e.status,zs=e=>"valid"===e.status,Ws=e=>"undefined"!=typeof Promise&&e instanceof Promise;function qs(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function Js(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r}var Ks,Xs,Ys;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Ks||(Ks={}));class Qs{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const eo=(e,t)=>{if(zs(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ns(e.common.issues);return this._error=t,this._error}}};function to(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{var a,s;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:i.defaultError}:void 0===i.data?{message:null!==(a=null!=o?o:n)&&void 0!==a?a:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!==(s=null!=o?o:r)&&void 0!==s?s:i.defaultError}},description:i}}class ro{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Rs(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Rs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Fs,ctx:{common:e.parent.common,data:e.data,parsedType:Rs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ws(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rs(e)},i=this._parseSync({data:e,path:n.path,parent:n});return eo(n,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rs(e)},n=this._parse({data:e,path:r.path,parent:r}),i=await(Ws(n)?n:Promise.resolve(n));return eo(r,i)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const i=e(t),a=()=>n.addIssue({code:js.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then((e=>!!e||(a(),!1))):!!i||(a(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new Xo({schema:this,typeName:cl.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Yo.create(this,this._def)}nullable(){return Qo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ro.create(this,this._def)}promise(){return Ko.create(this,this._def)}or(e){return $o.create([this,e],this._def)}and(e){return Uo.create(this,e,this._def)}transform(e){return new Xo({...to(this._def),schema:this,typeName:cl.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new el({...to(this._def),innerType:this,defaultValue:t,typeName:cl.ZodDefault})}brand(){return new il({typeName:cl.ZodBranded,type:this,...to(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new tl({...to(this._def),innerType:this,catchValue:t,typeName:cl.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return al.create(this,e)}readonly(){return sl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const no=/^c[^\s-]{8,}$/i,io=/^[0-9a-z]+$/,ao=/^[0-9A-HJKMNP-TV-Z]{26}$/,so=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,oo=/^[a-z0-9_-]{21}$/i,lo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,co=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let uo;const ho=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,po=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,mo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,fo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",go=new RegExp(`^${fo}$`);function yo(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function vo(e){let t=`${fo}T${yo(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}class bo extends ro{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Cs.string){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.string,received:t.parsedType}),Vs}const t=new Fs;let r;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(r=this._getOrReturnCtx(e,r),Us(r,{code:js.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(r=this._getOrReturnCtx(e,r),Us(r,{code:js.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const n=e.data.length>a.value,i=e.data.length<a.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?Us(r,{code:js.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):i&&Us(r,{code:js.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)co.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"email",code:js.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)uo||(uo=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),uo.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"emoji",code:js.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)so.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"uuid",code:js.invalid_string,message:a.message}),t.dirty());else if("nanoid"===a.kind)oo.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"nanoid",code:js.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)no.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"cuid",code:js.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)io.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"cuid2",code:js.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)ao.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"ulid",code:js.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),Us(r,{validation:"url",code:js.invalid_string,message:a.message}),t.dirty()}else"regex"===a.kind?(a.regex.lastIndex=0,a.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"regex",code:js.invalid_string,message:a.message}),t.dirty())):"trim"===a.kind?e.data=e.data.trim():"includes"===a.kind?e.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(e,r),Us(r,{code:js.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty()):"toLowerCase"===a.kind?e.data=e.data.toLowerCase():"toUpperCase"===a.kind?e.data=e.data.toUpperCase():"startsWith"===a.kind?e.data.startsWith(a.value)||(r=this._getOrReturnCtx(e,r),Us(r,{code:js.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty()):"endsWith"===a.kind?e.data.endsWith(a.value)||(r=this._getOrReturnCtx(e,r),Us(r,{code:js.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty()):"datetime"===a.kind?vo(a).test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{code:js.invalid_string,validation:"datetime",message:a.message}),t.dirty()):"date"===a.kind?go.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{code:js.invalid_string,validation:"date",message:a.message}),t.dirty()):"time"===a.kind?new RegExp(`^${yo(a)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{code:js.invalid_string,validation:"time",message:a.message}),t.dirty()):"duration"===a.kind?lo.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"duration",code:js.invalid_string,message:a.message}),t.dirty()):"ip"===a.kind?(n=e.data,("v4"!==(i=a.version)&&i||!ho.test(n))&&("v6"!==i&&i||!po.test(n))&&(r=this._getOrReturnCtx(e,r),Us(r,{validation:"ip",code:js.invalid_string,message:a.message}),t.dirty())):"base64"===a.kind?mo.test(e.data)||(r=this._getOrReturnCtx(e,r),Us(r,{validation:"base64",code:js.invalid_string,message:a.message}),t.dirty()):As.assertNever(a);var n,i;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:js.invalid_string,...Ks.errToObj(r)})}_addCheck(e){return new bo({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ks.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ks.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ks.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ks.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ks.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ks.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ks.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ks.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ks.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ks.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...Ks.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Ks.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ks.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Ks.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Ks.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Ks.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Ks.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Ks.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Ks.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Ks.errToObj(t)})}nonempty(e){return this.min(1,Ks.errToObj(e))}trim(){return new bo({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bo({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bo({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function wo(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}bo.create=e=>{var t;return new bo({checks:[],typeName:cl.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...to(e)})};class _o extends ro{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Cs.number){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.number,received:t.parsedType}),Vs}let t;const r=new Fs;for(const n of this._def.checks)"int"===n.kind?As.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Us(t,{code:js.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),Us(t,{code:js.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),Us(t,{code:js.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==wo(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),Us(t,{code:js.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Us(t,{code:js.not_finite,message:n.message}),r.dirty()):As.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ks.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ks.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ks.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ks.toString(t))}setLimit(e,t,r,n){return new _o({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ks.toString(n)}]})}_addCheck(e){return new _o({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ks.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ks.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ks.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ks.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ks.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ks.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Ks.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ks.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ks.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&As.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}_o.create=e=>new _o({checks:[],typeName:cl.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...to(e)});class xo extends ro{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==Cs.bigint){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.bigint,received:t.parsedType}),Vs}let t;const r=new Fs;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),Us(t,{code:js.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),Us(t,{code:js.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Us(t,{code:js.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):As.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ks.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ks.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ks.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ks.toString(t))}setLimit(e,t,r,n){return new xo({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ks.toString(n)}]})}_addCheck(e){return new xo({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ks.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ks.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ks.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ks.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ks.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}xo.create=e=>{var t;return new xo({checks:[],typeName:cl.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...to(e)})};class Eo extends ro{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==Cs.boolean){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.boolean,received:t.parsedType}),Vs}return Zs(e.data)}}Eo.create=e=>new Eo({typeName:cl.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...to(e)});class To extends ro{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Cs.date){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.date,received:t.parsedType}),Vs}if(isNaN(e.data.getTime()))return Us(this._getOrReturnCtx(e),{code:js.invalid_date}),Vs;const t=new Fs;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),Us(r,{code:js.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),Us(r,{code:js.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):As.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new To({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Ks.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Ks.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}To.create=e=>new To({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:cl.ZodDate,...to(e)});class So extends ro{_parse(e){if(this._getType(e)!==Cs.symbol){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.symbol,received:t.parsedType}),Vs}return Zs(e.data)}}So.create=e=>new So({typeName:cl.ZodSymbol,...to(e)});class Po extends ro{_parse(e){if(this._getType(e)!==Cs.undefined){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.undefined,received:t.parsedType}),Vs}return Zs(e.data)}}Po.create=e=>new Po({typeName:cl.ZodUndefined,...to(e)});class Oo extends ro{_parse(e){if(this._getType(e)!==Cs.null){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.null,received:t.parsedType}),Vs}return Zs(e.data)}}Oo.create=e=>new Oo({typeName:cl.ZodNull,...to(e)});class ko extends ro{constructor(){super(...arguments),this._any=!0}_parse(e){return Zs(e.data)}}ko.create=e=>new ko({typeName:cl.ZodAny,...to(e)});class Ao extends ro{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Zs(e.data)}}Ao.create=e=>new Ao({typeName:cl.ZodUnknown,...to(e)});class Io extends ro{_parse(e){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.never,received:t.parsedType}),Vs}}Io.create=e=>new Io({typeName:cl.ZodNever,...to(e)});class Co extends ro{_parse(e){if(this._getType(e)!==Cs.undefined){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.void,received:t.parsedType}),Vs}return Zs(e.data)}}Co.create=e=>new Co({typeName:cl.ZodVoid,...to(e)});class Ro extends ro{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==Cs.array)return Us(t,{code:js.invalid_type,expected:Cs.array,received:t.parsedType}),Vs;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,i=t.data.length<n.exactLength.value;(e||i)&&(Us(t,{code:e?js.too_big:js.too_small,minimum:i?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(Us(t,{code:js.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(Us(t,{code:js.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>n.type._parseAsync(new Qs(t,e,t.path,r))))).then((e=>Fs.mergeArray(r,e)));const i=[...t.data].map(((e,r)=>n.type._parseSync(new Qs(t,e,t.path,r))));return Fs.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Ro({...this._def,minLength:{value:e,message:Ks.toString(t)}})}max(e,t){return new Ro({...this._def,maxLength:{value:e,message:Ks.toString(t)}})}length(e,t){return new Ro({...this._def,exactLength:{value:e,message:Ks.toString(t)}})}nonempty(e){return this.min(1,e)}}function jo(e){if(e instanceof No){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Yo.create(jo(n))}return new No({...e._def,shape:()=>t})}return e instanceof Ro?new Ro({...e._def,type:jo(e.element)}):e instanceof Yo?Yo.create(jo(e.unwrap())):e instanceof Qo?Qo.create(jo(e.unwrap())):e instanceof Fo?Fo.create(e.items.map((e=>jo(e)))):e}Ro.create=(e,t)=>new Ro({type:e,minLength:null,maxLength:null,exactLength:null,typeName:cl.ZodArray,...to(t)});class No extends ro{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=As.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Cs.object){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.object,received:t.parsedType}),Vs}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof Io&&"strip"===this._def.unknownKeys))for(const e in r.data)i.includes(e)||a.push(e);const s=[];for(const e of i){const t=n[e],i=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new Qs(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof Io){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of a)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&(Us(r,{code:js.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const n=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new Qs(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of s){const r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e})).then((e=>Fs.mergeObjectSync(t,e))):Fs.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return Ks.errToObj,new No({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,i,a,s;const o=null!==(a=null===(i=(n=this._def).errorMap)||void 0===i?void 0:i.call(n,t,r).message)&&void 0!==a?a:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=Ks.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new No({...this._def,unknownKeys:"strip"})}passthrough(){return new No({...this._def,unknownKeys:"passthrough"})}extend(e){return new No({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new No({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:cl.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new No({...this._def,catchall:e})}pick(e){const t={};return As.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new No({...this._def,shape:()=>t})}omit(e){const t={};return As.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new No({...this._def,shape:()=>t})}deepPartial(){return jo(this)}partial(e){const t={};return As.objectKeys(this.shape).forEach((r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()})),new No({...this._def,shape:()=>t})}required(e){const t={};return As.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Yo;)e=e._def.innerType;t[r]=e}})),new No({...this._def,shape:()=>t})}keyof(){return Wo(As.objectKeys(this.shape))}}No.create=(e,t)=>new No({shape:()=>e,unknownKeys:"strip",catchall:Io.create(),typeName:cl.ZodObject,...to(t)}),No.strictCreate=(e,t)=>new No({shape:()=>e,unknownKeys:"strict",catchall:Io.create(),typeName:cl.ZodObject,...to(t)}),No.lazycreate=(e,t)=>new No({shape:e,unknownKeys:"strip",catchall:Io.create(),typeName:cl.ZodObject,...to(t)});class $o extends ro{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new Ns(e.ctx.common.issues)));return Us(t,{code:js.invalid_union,unionErrors:r}),Vs}));{let e;const n=[];for(const i of r){const r={...t,common:{...t.common,issues:[]},parent:null},a=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const i=n.map((e=>new Ns(e)));return Us(t,{code:js.invalid_union,unionErrors:i}),Vs}}get options(){return this._def.options}}$o.create=(e,t)=>new $o({options:e,typeName:cl.ZodUnion,...to(t)});const Lo=e=>e instanceof Go?Lo(e.schema):e instanceof Xo?Lo(e.innerType()):e instanceof zo?[e.value]:e instanceof qo?e.options:e instanceof Jo?As.objectValues(e.enum):e instanceof el?Lo(e._def.innerType):e instanceof Po?[void 0]:e instanceof Oo?[null]:e instanceof Yo?[void 0,...Lo(e.unwrap())]:e instanceof Qo?[null,...Lo(e.unwrap())]:e instanceof il||e instanceof sl?Lo(e.unwrap()):e instanceof tl?Lo(e._def.innerType):[];class Mo extends ro{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Cs.object)return Us(t,{code:js.invalid_type,expected:Cs.object,received:t.parsedType}),Vs;const r=this.discriminator,n=t.data[r],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(Us(t,{code:js.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Vs)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=Lo(r.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const i of t){if(n.has(i))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);n.set(i,r)}}return new Mo({typeName:cl.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...to(r)})}}function Do(e,t){const r=Rs(e),n=Rs(t);if(e===t)return{valid:!0,data:e};if(r===Cs.object&&n===Cs.object){const r=As.objectKeys(t),n=As.objectKeys(e).filter((e=>-1!==r.indexOf(e))),i={...e,...t};for(const r of n){const n=Do(e[r],t[r]);if(!n.valid)return{valid:!1};i[r]=n.data}return{valid:!0,data:i}}if(r===Cs.array&&n===Cs.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const i=Do(e[n],t[n]);if(!i.valid)return{valid:!1};r.push(i.data)}return{valid:!0,data:r}}return r===Cs.date&&n===Cs.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Uo extends ro{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(Hs(e)||Hs(n))return Vs;const i=Do(e.value,n.value);return i.valid?((Gs(e)||Gs(n))&&t.dirty(),{status:t.value,value:i.data}):(Us(r,{code:js.invalid_intersection_types}),Vs)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Uo.create=(e,t,r)=>new Uo({left:e,right:t,typeName:cl.ZodIntersection,...to(r)});class Fo extends ro{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Cs.array)return Us(r,{code:js.invalid_type,expected:Cs.array,received:r.parsedType}),Vs;if(r.data.length<this._def.items.length)return Us(r,{code:js.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Vs;!this._def.rest&&r.data.length>this._def.items.length&&(Us(r,{code:js.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new Qs(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>Fs.mergeArray(t,e))):Fs.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new Fo({...this._def,rest:e})}}Fo.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Fo({items:e,typeName:cl.ZodTuple,rest:null,...to(t)})};class Vo extends ro{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Cs.object)return Us(r,{code:js.invalid_type,expected:Cs.object,received:r.parsedType}),Vs;const n=[],i=this._def.keyType,a=this._def.valueType;for(const e in r.data)n.push({key:i._parse(new Qs(r,e,r.path,e)),value:a._parse(new Qs(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?Fs.mergeObjectAsync(t,n):Fs.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new Vo(t instanceof ro?{keyType:e,valueType:t,typeName:cl.ZodRecord,...to(r)}:{keyType:bo.create(),valueType:e,typeName:cl.ZodRecord,...to(t)})}}class Bo extends ro{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Cs.map)return Us(r,{code:js.invalid_type,expected:Cs.map,received:r.parsedType}),Vs;const n=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map((([e,t],a)=>({key:n._parse(new Qs(r,e,r.path,[a,"key"])),value:i._parse(new Qs(r,t,r.path,[a,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of a){const n=await r.key,i=await r.value;if("aborted"===n.status||"aborted"===i.status)return Vs;"dirty"!==n.status&&"dirty"!==i.status||t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of a){const n=r.key,i=r.value;if("aborted"===n.status||"aborted"===i.status)return Vs;"dirty"!==n.status&&"dirty"!==i.status||t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}}}}Bo.create=(e,t,r)=>new Bo({valueType:t,keyType:e,typeName:cl.ZodMap,...to(r)});class Zo extends ro{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Cs.set)return Us(r,{code:js.invalid_type,expected:Cs.set,received:r.parsedType}),Vs;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(Us(r,{code:js.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(Us(r,{code:js.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const i=this._def.valueType;function a(e){const r=new Set;for(const n of e){if("aborted"===n.status)return Vs;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const s=[...r.data.values()].map(((e,t)=>i._parse(new Qs(r,e,r.path,t))));return r.common.async?Promise.all(s).then((e=>a(e))):a(s)}min(e,t){return new Zo({...this._def,minSize:{value:e,message:Ks.toString(t)}})}max(e,t){return new Zo({...this._def,maxSize:{value:e,message:Ks.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Zo.create=(e,t)=>new Zo({valueType:e,minSize:null,maxSize:null,typeName:cl.ZodSet,...to(t)});class Ho extends ro{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Cs.function)return Us(t,{code:js.invalid_type,expected:Cs.function,received:t.parsedType}),Vs;function r(e,r){return Ds({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ms(),$s].filter((e=>!!e)),issueData:{code:js.invalid_arguments,argumentsError:r}})}function n(e,r){return Ds({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ms(),$s].filter((e=>!!e)),issueData:{code:js.invalid_return_type,returnTypeError:r}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Ko){const e=this;return Zs((async function(...t){const s=new Ns([]),o=await e._def.args.parseAsync(t,i).catch((e=>{throw s.addIssue(r(t,e)),s})),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,i).catch((e=>{throw s.addIssue(n(l,e)),s}))}))}{const e=this;return Zs((function(...t){const s=e._def.args.safeParse(t,i);if(!s.success)throw new Ns([r(t,s.error)]);const o=Reflect.apply(a,this,s.data),l=e._def.returns.safeParse(o,i);if(!l.success)throw new Ns([n(o,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ho({...this._def,args:Fo.create(e).rest(Ao.create())})}returns(e){return new Ho({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Ho({args:e||Fo.create([]).rest(Ao.create()),returns:t||Ao.create(),typeName:cl.ZodFunction,...to(r)})}}class Go extends ro{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Go.create=(e,t)=>new Go({getter:e,typeName:cl.ZodLazy,...to(t)});class zo extends ro{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Us(t,{received:t.data,code:js.invalid_literal,expected:this._def.value}),Vs}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Wo(e,t){return new qo({values:e,typeName:cl.ZodEnum,...to(t)})}zo.create=(e,t)=>new zo({value:e,typeName:cl.ZodLiteral,...to(t)});class qo extends ro{constructor(){super(...arguments),Xs.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return Us(t,{expected:As.joinValues(r),received:t.parsedType,code:js.invalid_type}),Vs}if(qs(this,Xs,"f")||Js(this,Xs,new Set(this._def.values),"f"),!qs(this,Xs,"f").has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return Us(t,{received:t.data,code:js.invalid_enum_value,options:r}),Vs}return Zs(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return qo.create(e,{...this._def,...t})}exclude(e,t=this._def){return qo.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}Xs=new WeakMap,qo.create=Wo;class Jo extends ro{constructor(){super(...arguments),Ys.set(this,void 0)}_parse(e){const t=As.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Cs.string&&r.parsedType!==Cs.number){const e=As.objectValues(t);return Us(r,{expected:As.joinValues(e),received:r.parsedType,code:js.invalid_type}),Vs}if(qs(this,Ys,"f")||Js(this,Ys,new Set(As.getValidEnumValues(this._def.values)),"f"),!qs(this,Ys,"f").has(e.data)){const e=As.objectValues(t);return Us(r,{received:r.data,code:js.invalid_enum_value,options:e}),Vs}return Zs(e.data)}get enum(){return this._def.values}}Ys=new WeakMap,Jo.create=(e,t)=>new Jo({values:e,typeName:cl.ZodNativeEnum,...to(t)});class Ko extends ro{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Cs.promise&&!1===t.common.async)return Us(t,{code:js.invalid_type,expected:Cs.promise,received:t.parsedType}),Vs;const r=t.parsedType===Cs.promise?t.data:Promise.resolve(t.data);return Zs(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Ko.create=(e,t)=>new Ko({type:e,typeName:cl.ZodPromise,...to(t)});class Xo extends ro{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===cl.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{Us(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){const e=n.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Vs;const n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?Vs:"dirty"===n.status||"dirty"===t.value?Bs(n.value):n}));{if("aborted"===t.value)return Vs;const n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?Vs:"dirty"===n.status||"dirty"===t.value?Bs(n.value):n}}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?Vs:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?Vs:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!zs(e))return e;const a=n.transform(e.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>zs(e)?Promise.resolve(n.transform(e.value,i)).then((e=>({status:t.value,value:e}))):e))}As.assertNever(n)}}Xo.create=(e,t,r)=>new Xo({schema:e,typeName:cl.ZodEffects,effect:t,...to(r)}),Xo.createWithPreprocess=(e,t,r)=>new Xo({schema:t,effect:{type:"preprocess",transform:e},typeName:cl.ZodEffects,...to(r)});class Yo extends ro{_parse(e){return this._getType(e)===Cs.undefined?Zs(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Yo.create=(e,t)=>new Yo({innerType:e,typeName:cl.ZodOptional,...to(t)});class Qo extends ro{_parse(e){return this._getType(e)===Cs.null?Zs(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Qo.create=(e,t)=>new Qo({innerType:e,typeName:cl.ZodNullable,...to(t)});class el extends ro{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Cs.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}el.create=(e,t)=>new el({innerType:e,typeName:cl.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...to(t)});class tl extends ro{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ws(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Ns(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new Ns(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}tl.create=(e,t)=>new tl({innerType:e,typeName:cl.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...to(t)});class rl extends ro{_parse(e){if(this._getType(e)!==Cs.nan){const t=this._getOrReturnCtx(e);return Us(t,{code:js.invalid_type,expected:Cs.nan,received:t.parsedType}),Vs}return{status:"valid",value:e.data}}}rl.create=e=>new rl({typeName:cl.ZodNaN,...to(e)});const nl=Symbol("zod_brand");class il extends ro{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class al extends ro{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Vs:"dirty"===e.status?(t.dirty(),Bs(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Vs:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new al({in:e,out:t,typeName:cl.ZodPipeline})}}class sl extends ro{_parse(e){const t=this._def.innerType._parse(e),r=e=>(zs(e)&&(e.value=Object.freeze(e.value)),e);return Ws(t)?t.then((e=>r(e))):r(t)}unwrap(){return this._def.innerType}}function ol(e,t={},r){return e?ko.create().superRefine(((n,i)=>{var a,s;if(!e(n)){const e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,o=null===(s=null!==(a=e.fatal)&&void 0!==a?a:r)||void 0===s||s,l="string"==typeof e?{message:e}:e;i.addIssue({code:"custom",...l,fatal:o})}})):ko.create()}sl.create=(e,t)=>new sl({innerType:e,typeName:cl.ZodReadonly,...to(t)});const ll={object:No.lazycreate};var cl;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(cl||(cl={}));const ul=bo.create,dl=_o.create,hl=rl.create,pl=xo.create,ml=Eo.create,fl=To.create,gl=So.create,yl=Po.create,vl=Oo.create,bl=ko.create,wl=Ao.create,_l=Io.create,xl=Co.create,El=Ro.create,Tl=No.create,Sl=No.strictCreate,Pl=$o.create,Ol=Mo.create,kl=Uo.create,Al=Fo.create,Il=Vo.create,Cl=Bo.create,Rl=Zo.create,jl=Ho.create,Nl=Go.create,$l=zo.create,Ll=qo.create,Ml=Jo.create,Dl=Ko.create,Ul=Xo.create,Fl=Yo.create,Vl=Qo.create,Bl=Xo.createWithPreprocess,Zl=al.create,Hl={string:e=>bo.create({...e,coerce:!0}),number:e=>_o.create({...e,coerce:!0}),boolean:e=>Eo.create({...e,coerce:!0}),bigint:e=>xo.create({...e,coerce:!0}),date:e=>To.create({...e,coerce:!0})},Gl=Vs;var zl=Object.freeze({__proto__:null,defaultErrorMap:$s,setErrorMap:function(e){Ls=e},getErrorMap:Ms,makeIssue:Ds,EMPTY_PATH:[],addIssueToContext:Us,ParseStatus:Fs,INVALID:Vs,DIRTY:Bs,OK:Zs,isAborted:Hs,isDirty:Gs,isValid:zs,isAsync:Ws,get util(){return As},get objectUtil(){return Is},ZodParsedType:Cs,getParsedType:Rs,ZodType:ro,datetimeRegex:vo,ZodString:bo,ZodNumber:_o,ZodBigInt:xo,ZodBoolean:Eo,ZodDate:To,ZodSymbol:So,ZodUndefined:Po,ZodNull:Oo,ZodAny:ko,ZodUnknown:Ao,ZodNever:Io,ZodVoid:Co,ZodArray:Ro,ZodObject:No,ZodUnion:$o,ZodDiscriminatedUnion:Mo,ZodIntersection:Uo,ZodTuple:Fo,ZodRecord:Vo,ZodMap:Bo,ZodSet:Zo,ZodFunction:Ho,ZodLazy:Go,ZodLiteral:zo,ZodEnum:qo,ZodNativeEnum:Jo,ZodPromise:Ko,ZodEffects:Xo,ZodTransformer:Xo,ZodOptional:Yo,ZodNullable:Qo,ZodDefault:el,ZodCatch:tl,ZodNaN:rl,BRAND:nl,ZodBranded:il,ZodPipeline:al,ZodReadonly:sl,custom:ol,Schema:ro,ZodSchema:ro,late:ll,get ZodFirstPartyTypeKind(){return cl},coerce:Hl,any:bl,array:El,bigint:pl,boolean:ml,date:fl,discriminatedUnion:Ol,effect:Ul,enum:Ll,function:jl,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>ol((t=>t instanceof e),t),intersection:kl,lazy:Nl,literal:$l,map:Cl,nan:hl,nativeEnum:Ml,never:_l,null:vl,nullable:Vl,number:dl,object:Tl,oboolean:()=>ml().optional(),onumber:()=>dl().optional(),optional:Fl,ostring:()=>ul().optional(),pipeline:Zl,preprocess:Bl,promise:Dl,record:Il,set:Rl,strictObject:Sl,string:ul,symbol:gl,transformer:Ul,tuple:Al,undefined:yl,union:Pl,unknown:wl,void:xl,NEVER:Gl,ZodIssueCode:js,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Ns}),Wl=r(4116);const ql={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var Jl,Kl=new Uint8Array(16);function Xl(){if(!Jl&&!(Jl="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Jl(Kl)}for(var Yl=[],Ql=0;Ql<256;++Ql)Yl.push((Ql+256).toString(16).slice(1));const ec=function(e,t,r){if(ql.randomUUID&&!t&&!e)return ql.randomUUID();var n=(e=e||{}).random||(e.rng||Xl)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e,t=0){return(Yl[e[t+0]]+Yl[e[t+1]]+Yl[e[t+2]]+Yl[e[t+3]]+"-"+Yl[e[t+4]]+Yl[e[t+5]]+"-"+Yl[e[t+6]]+Yl[e[t+7]]+"-"+Yl[e[t+8]]+Yl[e[t+9]]+"-"+Yl[e[t+10]]+Yl[e[t+11]]+Yl[e[t+12]]+Yl[e[t+13]]+Yl[e[t+14]]+Yl[e[t+15]]).toLowerCase()}(n)},tc=Symbol.for("ls:tracing_async_local_storage"),rc=new class{getStore(){}run(e,t){return t()}},nc=new class{getInstance(){return globalThis[tc]??rc}initializeGlobalInstance(e){void 0===globalThis[tc]&&(globalThis[tc]=e)}};function ic(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root");const ac=Object.prototype.hasOwnProperty;function sc(e,t){return ac.call(e,t)}function oc(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function lc(e){let t=0;const r=e.length;let n;for(;t<r;){if(n=e.charCodeAt(t),!(n>=48&&n<=57))return!1;t++}return!0}function cc(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(cc(e[t]))return!0}else if("object"==typeof e){const r=function(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)sc(e,r)&&t.push(r);return t}(e),n=r.length;for(var t=0;t<n;t++)if(cc(e[r[t]]))return!0}return!1}function uc(e,t){const r=[e];for(const e in t){const n="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==n&&r.push(`${e}: ${n}`)}return r.join("\n")}class dc extends Error{constructor(e,t,r,n,i){super(uc(e,{name:t,index:r,operation:n,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=uc(e,{name:t,index:r,operation:n,tree:i})}}const hc=dc,pc=oc,mc={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){let n=gc(r,this.path);n&&(n=oc(n));const i=yc(r,{op:"remove",path:this.from}).removed;return yc(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){const n=gc(r,this.from);return yc(r,{op:"add",path:this.path,value:oc(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:xc(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var fc={add:function(e,t,r){return lc(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:mc.move,copy:mc.copy,test:mc.test,_get:mc._get};function gc(e,t){if(""==t)return e;var r={op:"_get",path:t};return yc(e,r),r.value}function yc(e,t,r=!1,n=!0,i=!0,a=0){if(r&&("function"==typeof r?r(t,0,e,t.path):wc(t,0)),""===t.path){let n={newDocument:e};if("add"===t.op)return n.newDocument=t.value,n;if("replace"===t.op)return n.newDocument=t.value,n.removed=e,n;if("move"===t.op||"copy"===t.op)return n.newDocument=gc(e,t.from),"move"===t.op&&(n.removed=e),n;if("test"===t.op){if(n.test=xc(e,t.value),!1===n.test)throw new hc("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return n.newDocument=e,n}if("remove"===t.op)return n.removed=e,n.newDocument=null,n;if("_get"===t.op)return t.value=e,n;if(r)throw new hc("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return n}{n||(e=oc(e));const s=(t.path||"").split("/");let o,l,c,u=e,d=1,h=s.length;for(c="function"==typeof r?r:wc;;){if(l=s[d],l&&-1!=l.indexOf("~")&&(l=l.replace(/~1/g,"/").replace(/~0/g,"~")),i&&("__proto__"==l||"prototype"==l&&d>0&&"constructor"==s[d-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===o&&(void 0===u[l]?o=s.slice(0,d).join("/"):d==h-1&&(o=t.path),void 0!==o&&c(t,0,e,o)),d++,Array.isArray(u)){if("-"===l)l=u.length;else{if(r&&!lc(l))throw new hc("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);lc(l)&&(l=~~l)}if(d>=h){if(r&&"add"===t.op&&l>u.length)throw new hc("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);const n=fc[t.op].call(t,u,l,e);if(!1===n.test)throw new hc("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return n}}else if(d>=h){const r=mc[t.op].call(t,u,l,e);if(!1===r.test)throw new hc("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}if(u=u[l],r&&d<h&&(!u||"object"!=typeof u))throw new hc("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function vc(e,t,r,n=!0,i=!0){if(r&&!Array.isArray(t))throw new hc("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=oc(e));const a=new Array(t.length);for(let n=0,s=t.length;n<s;n++)a[n]=yc(e,t[n],r,!0,i,n),e=a[n].newDocument;return a.newDocument=e,a}function bc(e,t,r){const n=yc(e,t);if(!1===n.test)throw new hc("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function wc(e,t,r,n){if("object"!=typeof e||null===e||Array.isArray(e))throw new hc("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(!mc[e.op])throw new hc("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r);if("string"!=typeof e.path)throw new hc("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new hc('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new hc("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new hc("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&cc(e.value))throw new hc("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r)if("add"==e.op){var i=e.path.split("/").length,a=n.split("/").length;if(i!==a+1&&i!==a)throw new hc("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==n)throw new hc("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var s=_c([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new hc("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}function _c(e,t,r){try{if(!Array.isArray(e))throw new hc("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)vc(oc(t),oc(e),r||!0);else{r=r||wc;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(e){if(e instanceof hc)return e;throw e}}function xc(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,n,i,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!xc(e[r],t[r]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=n;0!=r--;)if(!xc(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}new WeakMap;var Ec=r(9478);function Tc(e,t){return t?.[e]||Ec(e)}function Sc(e,t,r){const n={};for(const i in e)Object.hasOwn(e,i)&&(n[t(i,r)]=e[i]);return n}function Pc(e){return Array.isArray(e)?[...e]:{...e}}function Oc(e,t){const r=Pc(e);for(const[e,n]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let a=r;for(const e of i.reverse()){if(void 0===a[e])break;a[e]=Pc(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[n]})}return r}function kc(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}r(2729);class Ac{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,kc(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Ac||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n,"lc_aliases",this)),Object.assign(t,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,n=r;const[i,...a]=e.split(".").reverse();for(const e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in n&&void 0!==n[e]||("object"==typeof t[e]&&null!=t[e]?n[e]={}:Array.isArray(t[e])&&(n[e]=[])),t=t[e],n=n[e]}i in t&&void 0!==t[i]&&(n[i]=n[i]||t[i])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:Sc(Object.keys(t).length?Oc(r,t):r,Tc,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const Ic=()=>"undefined"!=typeof Deno;let Cc;async function Rc(){if(void 0===Cc){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||Ic()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":Ic()?"deno":"other":"node",e})();Cc={library:"langchain-js",runtime:e}}return Cc}function jc(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}class Nc{}class $c extends Nc{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,kc(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===jc("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Ac.prototype.toJSON.call(this)}toJSONNotImplemented(){return Ac.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends $c{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ec()}),Object.assign(this,e)}}}}function Lc(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function Mc(e){return"function"==typeof e._addRunToRunMap}class Dc extends $c{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=function(e,t,r){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${n}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),r={...e};if(void 0!==r.parent_run_id){const e=this.runMap.get(r.parent_run_id);e&&(this._addChildRun(e,r),e.child_execution_order=Math.max(e.child_execution_order,r.child_execution_order),r.trace_id=e.trace_id,void 0!==e.dotted_order&&(r.dotted_order=[e.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,n,i,a,s,o){const l=this._getExecutionOrder(n),c=Date.now(),u=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:a||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,n,i,a,s,o){const l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,n,i,a,s,o);return await(this.onRunCreate?.(l)),await(this.onLLMStart?.(l)),l}_createRunForChatModelStart(e,t,r,n,i,a,s,o){const l=this._getExecutionOrder(n),c=Date.now(),u=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:a||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,n,i,a,s,o){const l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,n,i,a,s,o);return await(this.onRunCreate?.(l)),await(this.onLLMStart?.(l)),l}async handleLLMEnd(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onLLMEnd?.(r)),await this._endTrace(r),r}async handleLLMError(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onLLMError?.(r)),await this._endTrace(r),r}_createRunForChainStart(e,t,r,n,i,a,s,o){const l=this._getExecutionOrder(n),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleChainStart(e,t,r,n,i,a,s,o){const l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,n,i,a,s,o);return await(this.onRunCreate?.(l)),await(this.onChainStart?.(l)),l}async handleChainEnd(e,t,r,n,i){const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Lc(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),void 0!==i?.inputs&&(a.inputs=Lc(i.inputs,"input")),await(this.onChainEnd?.(a)),await this._endTrace(a),a}async handleChainError(e,t,r,n,i){const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),void 0!==i?.inputs&&(a.inputs=Lc(i.inputs,"input")),await(this.onChainError?.(a)),await this._endTrace(a),a}_createRunForToolStart(e,t,r,n,i,a,s){const o=this._getExecutionOrder(n),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,r,n,i,a,s){const o=this.runMap.get(r)??this._createRunForToolStart(e,t,r,n,i,a,s);return await(this.onRunCreate?.(o)),await(this.onToolStart?.(o)),o}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onToolEnd?.(r)),await this._endTrace(r),r}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onToolError?.(r)),await this._endTrace(r),r}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const n=r;n.actions=n.actions||[],n.actions.push(e),n.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}_createRunForRetrieverStart(e,t,r,n,i,a,s){const o=this._getExecutionOrder(n),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,r,n,i,a,s){const o=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,n,i,a,s);return await(this.onRunCreate?.(o)),await(this.onRetrieverStart?.(o)),o}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r),r}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverError?.(r)),await this._endTrace(r),r}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r,n,i,a){const s=this.runMap.get(r);if(!s||"llm"!==s?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await(this.onLLMNewToken?.(s,e,{chunk:a?.chunk})),s}}var Uc=r(3290);const Fc=(...e)=>fetch(...e),Vc=Symbol.for("ls:fetch_implementation"),Bc=()=>globalThis[Vc]??Fc,Zc=[400,401,403,404,405,406,407,408],Hc=[409];class Gc{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new Uc.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add((()=>Wl((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,n=t?.status;if(n){if(Zc.includes(+n))throw e;if(Hc.includes(+n))return;r&&await r(t)}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>Bc()(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function zc(e){return"function"==typeof e?._getType}function Wc(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let qc;const Jc=()=>"undefined"!=typeof Deno;let Kc,Xc;async function Yc(){if(void 0===Kc){const e=qc||(qc="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||Jc()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":Jc()?"deno":"other":"node",qc),t=function(){if(void 0!==Xc)return Xc;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const r of e){const e=Qc(r);void 0!==e&&(t[r]=e)}return Xc=t,t}();Kc={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:Pu,...t}}return Kc}function Qc(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function eu(e){return Qc(`LANGSMITH_${e}`)||Qc(`LANGCHAIN_${e}`)}const tu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,ru=function(e){return"string"==typeof e&&tu.test(e)};function nu(e,t){if(!ru(e))throw new Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}const iu={};function au(e){iu[e]||(console.warn(e),iu[e]=!0)}var su=r(9589);function ou(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw new Error(`Invalid identifier format: ${e}`);const[t,r]=e.split(":"),n=r||"latest";if(t.includes("/")){const[r,i]=t.split("/",2);if(!r||!i)throw new Error(`Invalid identifier format: ${e}`);return[r,i,n]}if(!t)throw new Error(`Invalid identifier format: ${e}`);return["-",t,n]}class lu extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function cu(e,t,r){let n;if(e.ok)return void(r&&(n=await e.text()));n=await e.text();const i=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${n}`;if(409===e.status)throw new lu(i);throw new Error(i)}var uu="[...]",du={result:"[Circular]"},hu=[],pu=[];function mu(e,t,r,n){var i;void 0===n&&(n={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),gu(e,"",0,[],void 0,0,n);try{i=0===pu.length?JSON.stringify(e,t,r):JSON.stringify(e,function(e){return e=void 0!==e?e:function(e,t){return t},function(t,r){if(pu.length>0)for(var n=0;n<pu.length;n++){var i=pu[n];if(i[1]===t&&i[0]===r){r=i[2],pu.splice(n,1);break}}return e.call(this,t,r)}}(t),r)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==hu.length;){var a=hu.pop();4===a.length?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return i}function fu(e,t,r,n){var i=Object.getOwnPropertyDescriptor(n,r);void 0!==i.get?i.configurable?(Object.defineProperty(n,r,{value:e}),hu.push([n,r,t,i])):pu.push([t,r,e]):(n[r]=e,hu.push([n,r,t]))}function gu(e,t,r,n,i,a,s){var o;if(a+=1,"object"==typeof e&&null!==e){for(o=0;o<n.length;o++)if(n[o]===e)return void fu(du,e,t,i);if(void 0!==s.depthLimit&&a>s.depthLimit)return void fu(uu,e,t,i);if(void 0!==s.edgesLimit&&r+1>s.edgesLimit)return void fu(uu,e,t,i);if(n.push(e),Array.isArray(e))for(o=0;o<e.length;o++)gu(e[o],o,o,n,e,a,s);else{var l=Object.keys(e);for(o=0;o<l.length;o++){var c=l[o];gu(e[c],c,o,n,e,a,s)}}n.pop()}}async function yu(e){const t=await Yc(),r=function(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,r])=>(e[t]=String(r),e)),{}):void 0}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[n,i]of Object.entries(e))!n.startsWith("LANGCHAIN_")||"string"!=typeof i||r.includes(n)||n.toLowerCase().includes("key")||n.toLowerCase().includes("secret")||n.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===n?t.revision_id=i:t[n]=i);return t}();return e.map((e=>{const n=e.extra??{},i=n.metadata;return e.extra={...n,runtime:{...t,...n?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...i}},e}))}function vu(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const bu=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise((e=>setTimeout(e,t))),!0}return!1};class wu{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise((t=>{this.items.push([e,t])}))}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const e=this.items.shift();if(!e)break;t.push(e)}return[t.map((e=>e[0])),()=>t.forEach((e=>e[1]()))]}}class _u{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new wu}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=_u.getDefaultClientConfig();this.tracingSampleRate=(()=>{const e=eu("TRACING_SAMPLING_RATE");if(void 0===e)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t})(),this.apiUrl=vu(e.apiUrl??t.apiUrl)??"",this.apiKey=vu(e.apiKey??t.apiKey),this.webUrl=vu(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Gc(e.callerOptions??{}),this.batchIngestCaller=new Gc({...e.callerOptions??{},onFailedResponseHook:bu}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=eu("API_KEY");return{apiUrl:eu("ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===eu("HIDE_INPUTS"),hideOutputs:"true"===eu("HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(()=>{const e=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===e||"127.0.0.1"===e||"::1"===e})()?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Pu}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=t?.toString()??"",n=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(Bc(),n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let n=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(Bc(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(s,`Failed to fetch ${e}`);const o=r?r(await s.json()):await s.json();if(0===o.length)break;if(yield o,o.length<i)break;n+=o.length}}async*_getCursorPaginatedList(e,t=null,r="POST",n="runs"){const i=t?{...t}:{};for(;;){const t=await this.caller.call(Bc(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)}),a=await t.json();if(!a)break;if(!a[n])break;yield a[n];const s=a.cursors;if(!s)break;if(!s.next)break;i.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const r of e)this.filteredPostUuids.has(r.id)?this.filteredPostUuids.delete(r.id):t.push(r);return t}{const t=[];for(const r of e)r.id!==r.trace_id&&!this.filteredPostUuids.has(r.trace_id)||Math.random()<this.tracingSampleRate?t.push(r):this.filteredPostUuids.add(r.id);return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length)return void t();try{await this.batchIngestRuns({runCreates:e.filter((e=>"create"===e.action)).map((e=>e.item)),runUpdates:e.filter((e=>"update"===e.action)).map((e=>e.item))})}finally{t()}}}async processRunOperation(e,t){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const n=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout((()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)}),r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),n}async _getServerInfo(){const e=await Bc()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(e,"get server info"),e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const n=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order)return void this.processRunOperation({action:"create",item:n}).catch(console.error);const i=await yu([n]),a=await this.caller.call(Bc(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:mu(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[],n=t?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[];if(r.length>0&&n.length>0){const e=r.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),n=t}const i={post:this._filterForSampling(r),patch:this._filterForSampling(n,!0)};if(!i.post.length&&!i.patch.length)return;if(r=await yu(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const e of i.post)await this.createRun(e);for(const e of i.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}const a=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,s={post:[],patch:[]};let o=0;for(const e of["post","patch"]){const t=e,r=i[t].reverse();let n=r.pop();for(;void 0!==n;){const e=mu(n);o>0&&o+e.length>a&&(await this._postBatchIngestRuns(mu(s)),o=0,s.post=[],s.patch=[]),o+=e.length,s[t].push(n),n=r.pop()}}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(mu(s))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(Bc(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(r,"batch create run",!0)}async updateRun(e,t){nu(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void 0!==t.end_time&&void 0===r.parent_run_id?void await this.processRunOperation({action:"update",item:r},!0):void this.processRunOperation({action:"update",item:r}).catch(console.error);const n={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(Bc(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,body:mu(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){nu(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:eu("PROJECT")||"default"})).id;const n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},n={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),n[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(n[t].child_runs=r[t]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:n,traceId:i,referenceExampleId:a,startTime:s,executionOrder:o,isRoot:l,runType:c,error:u,id:d,query:h,filter:p,traceFilter:m,treeFilter:f,limit:g,select:y}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),r){const e=Array.isArray(r)?r:[r],t=await Promise.all(e.map((e=>this.readProject({projectName:e}).then((e=>e.id)))));v.push(...t)}const b={session:v.length?v:null,run_type:c,reference_example:a,query:h,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:n,start_time:s?s.toISOString():null,error:u,id:d,limit:g,trace:i,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l};let w=0;for await(const e of this._getCursorPaginatedList("/runs/query",b))if(g){if(w>=g)break;if(e.length+w>g){const t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async getRunStats({id:e,trace:t,parentRun:r,runType:n,projectNames:i,projectIds:a,referenceExampleIds:s,startTime:o,endTime:l,error:c,query:u,filter:d,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:f}){let g=a||[];i&&(g=[...a||[],...await Promise.all(i.map((e=>this.readProject({projectName:e}).then((e=>e.id)))))]);const y={id:e,trace:t,parent_run:r,run_type:n,session:g,reference_example:s,start_time:o,end_time:l,error:c,query:u,filter:d,trace_filter:h,tree_filter:p,is_root:m,data_source_type:f},v=Object.fromEntries(Object.entries(y).filter((([e,t])=>void 0!==t))),b=await this.caller.call(Bc(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await b.json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||ec()};nu(e);const n=await this.caller.call(Bc(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await n.json();if(null===i||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){nu(e);const t=await this.caller.call(Bc(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(t,"unshare run",!0)}async readRunSharedLink(e){nu(e);const t=await this.caller.call(Bc(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)r.append("id",e);nu(e);const n=await this.caller.call(Bc(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await n.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),nu(e);const r=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};nu(e);const n=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await n.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){nu(e);const t=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(t,"unshare dataset",!0)}async readSharedDataset(e){nu(e);const t=await this.caller.call(Bc(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){const r={};t?.exampleIds&&(r.id=t.exampleIds);const n=new URLSearchParams;Object.entries(r).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>n.append(e,t))):n.append(e,t)}));const i=await this.caller.call(Bc(),`${this.apiUrl}/public/${e}/examples?${n.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(!i.ok){if("detail"in a)throw new Error(`Failed to list shared examples.\nStatus: ${i.status}\nMessage: ${a.detail.join("\n")}`);throw new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`)}return a.map((e=>({...e,_hostUrl:this.getHostUrl()})))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:n=!1,projectExtra:i=null,referenceDatasetId:a=null}){const s=n?"?upsert=true":"",o=`${this.apiUrl}/sessions${s}`,l=i||{};r&&(l.metadata=r);const c={name:e,extra:l,description:t};null!==a&&(c.reference_dataset_id=a);const u=await this.caller.call(Bc(),o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(u,"create project"),await u.json()}async updateProject(e,{name:t=null,description:r=null,metadata:n=null,projectExtra:i=null,endTime:a=null}){const s=`${this.apiUrl}/sessions/${e}`;let o=i;n&&(o={...o||{},metadata:n});const l={name:t,extra:o,description:r,end_time:a?new Date(a).toISOString():null},c=await this.caller.call(Bc(),s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)nu(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");n.append("name",t)}const i=await this.caller.call(Bc(),`${this.apiUrl}${r}?${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await i.json();return!!i.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let n="/sessions";const i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)nu(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");i.append("name",t)}void 0!==r&&i.append("include_stats",r.toString());const a=await this._get(n,i);let s;if(Array.isArray(a)){if(0===a.length)throw new Error(`Project[id=${e}, name=${t}] not found`);s=a[0]}else s=a;return s}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:n,referenceDatasetName:i,referenceFree:a,metadata:s}={}){const o=new URLSearchParams;if(void 0!==e)for(const t of e)o.append("id",t);if(void 0!==t&&o.append("name",t),void 0!==r&&o.append("name_contains",r),void 0!==n)o.append("reference_dataset",n);else if(void 0!==i){const e=await this.readDataset({datasetName:i});o.append("reference_dataset",e.id)}void 0!==a&&o.append("reference_free",a.toString()),void 0!==s&&o.append("metadata",JSON.stringify(s));for await(const e of this._getPaginated("/sessions",o))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e,nu(r);const n=await this.caller.call(Bc(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(n,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:n,description:i,dataType:a,name:s}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach((e=>{l.append("input_keys",e)})),n.forEach((e=>{l.append("output_keys",e)})),i&&l.append("description",i),a&&l.append("data_type",a),s&&l.append("name",s);const c=await this.caller.call(Bc(),o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:n,outputsSchema:i,metadata:a}={}){const s={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(s.data_type=r),n&&(s.inputs_schema_definition=n),i&&(s.outputs_schema_definition=i);const o=await this.caller.call(Bc(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(o,"create dataset"),await o.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)nu(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");n.append("name",t)}const i=await this._get(r,n);let a;if(Array.isArray(i)){if(0===i.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:n}){let i=e;if(void 0===i&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof n?n:n.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:n,datasetNameContains:i,metadata:a}={}){const s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)s.append("id",e);void 0!==n&&s.append("name",n),void 0!==i&&s.append("name_contains",i),void 0!==a&&s.append("metadata",JSON.stringify(a));for await(const e of this._getPaginated("/datasets",s))yield*e}async updateDataset(e){const{datasetId:t,datasetName:r,...n}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;nu(i);const a=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(a,"update dataset"),await a.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",n=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(n=(await this.readDataset({datasetName:t})).id),void 0===n)throw new Error("Must provide datasetName or datasetId");nu(n),r+=`/${n}`;const i=await this.caller.call(Bc(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(i,`delete ${r}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let n=e;if(!n&&!t)throw new Error("Must provide either datasetName or datasetId");if(n&&t)throw new Error("Must provide either datasetName or datasetId, not both");n||(n=(await this.readDataset({datasetName:t})).id),nu(n);const i={tag:r},a=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${n}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(a,"index dataset"),await a.json()}async similarExamples(e,t,r,{filter:n}={}){const i={limit:r,inputs:e};void 0!==n&&(i.filter=n),nu(t);const a=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,{datasetId:r,datasetName:n,createdAt:i,exampleId:a,metadata:s,split:o,sourceRunId:l}){let c=r;if(void 0===c&&void 0===n)throw new Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");void 0===c&&(c=(await this.readDataset({datasetName:n})).id);const u=i||new Date,d={dataset_id:c,inputs:e,outputs:t,created_at:u?.toISOString(),id:a,metadata:s,split:o,source_run_id:l},h=await this.caller.call(Bc(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(h,"create example"),await h.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:n,sourceRunIds:i,exampleIds:a,datasetId:s,datasetName:o}=e;let l=s;if(void 0===l&&void 0===o)throw new Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==o)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===l){const e=await this.readDataset({datasetName:o});l=e.id}const c=t.map(((t,s)=>({dataset_id:l,inputs:t,outputs:r?r[s]:void 0,metadata:n?n[s]:void 0,split:e.splits?e.splits[s]:void 0,id:a?a[s]:void 0,source_run_id:i?i[s]:void 0}))),u=await this.caller.call(Bc(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(u,"create examples"),await u.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const n=e.map((e=>zc(e)?Wc(e):e)),i=zc(t)?Wc(t):t;return this.createExample({input:n},{output:i},r)}async readExample(e){nu(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:n,splits:i,inlineS3Urls:a,metadata:s,limit:o,offset:l,filter:c}={}){let u;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)u=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");u=(await this.readDataset({datasetName:t})).id}const d=new URLSearchParams({dataset:u}),h=n?"string"==typeof n?n:n?.toISOString():void 0;h&&d.append("as_of",h);const p=a??!0;if(d.append("inline_s3_urls",p.toString()),void 0!==r)for(const e of r)d.append("id",e);if(void 0!==i)for(const e of i)d.append("splits",e);if(void 0!==s){const e=JSON.stringify(s);d.append("metadata",e)}void 0!==o&&d.append("limit",o.toString()),void 0!==l&&d.append("offset",l.toString()),void 0!==c&&d.append("filter",c);let m=0;for await(const e of this._getPaginated("/examples",d)){for(const t of e)yield t,m++;if(void 0!==o&&m>=o)break}}async deleteExample(e){nu(e);const t=`/examples/${e}`,r=await this.caller.call(Bc(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(r,`delete ${t}`),await r.json()}async updateExample(e,t){nu(e);const r=await this.caller.call(Bc(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call(Bc(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let n;if(void 0===e&&void 0===t)throw new Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");n=void 0===e?(await this.readDataset({datasetName:t})).id:e,nu(n);const i=new URLSearchParams,a=r?"string"==typeof r?r:r?.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${n}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:n,remove:i=!1}){let a;if(void 0===e&&void 0===t)throw new Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");a=void 0===e?(await this.readDataset({datasetName:t})).id:e,nu(a);const s={split_name:r,examples:n.map((e=>(nu(e),e))),remove:i},o=await this.caller.call(Bc(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(o,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:n,referenceExample:i}={loadChildRuns:!1}){let a;if(au("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)a=await this.readRun(e,{loadChildRuns:n});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);a=e}null!==a.reference_example_id&&void 0!==a.reference_example_id&&(i=await this.readExample(a.reference_example_id));const s=await t.evaluateRun(a,i),[o,l]=await this._logEvaluationFeedback(s,a,r);return l[0]}async createFeedback(e,t,{score:r,value:n,correction:i,comment:a,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:l,feedbackId:c,feedbackConfig:u,projectId:d,comparativeExperimentId:h}){if(!e&&!d)throw new Error("One of runId or projectId must be provided");if(e&&d)throw new Error("Only one of runId or projectId can be provided");const p={type:o??"api",metadata:s??{}};void 0===l||void 0===p?.metadata||p.metadata.__run||(p.metadata.__run={run_id:l}),void 0!==p?.metadata&&void 0!==p.metadata.__run?.run_id&&nu(p.metadata.__run.run_id);const m={id:c??ec(),run_id:e,key:t,score:r,value:n,correction:i,comment:a,feedback_source:p,comparative_experiment_id:h,feedbackConfig:u,session_id:d},f=`${this.apiUrl}/feedback`,g=await this.caller.call(Bc(),f,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(g,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:n,comment:i}){const a={};null!=t&&(a.score=t),null!=r&&(a.value=r),null!=n&&(a.correction=n),null!=i&&(a.comment=i),nu(e);const s=await this.caller.call(Bc(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(s,"update feedback",!0)}async readFeedback(e){nu(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){nu(e);const t=`/feedback/${e}`,r=await this.caller.call(Bc(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const n=new URLSearchParams;if(e&&n.append("run",e.join(",")),t)for(const e of t)n.append("key",e);if(r)for(const e of r)n.append("source",e);for await(const e of this._getPaginated("/feedback",n))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:n}={}){const i={run_id:e,feedback_key:t,feedback_config:n};r?"string"==typeof r?i.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(i.expires_in=r):i.expires_in={hours:3};const a=await this.caller.call(Bc(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:n,description:i,metadata:a,id:s}){if(0===t.length)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw new Error("A reference dataset is required");const o={id:s,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(n??new Date)?.toISOString(),extra:{}};a&&(o.extra.metadata=a);const l=await this.caller.call(Bc(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await l.json()}async*listPresignedFeedbackTokens(e){nu(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:[e],t}async _logEvaluationFeedback(e,t,r){const n=this._selectEvalResults(e),i=[];for(const e of n){let n=r||{};e.evaluatorInfo&&(n={...e.evaluatorInfo,...n});let a=null;e.targetRunId?a=e.targetRunId:t&&(a=t.id),i.push(await this.createFeedback(a,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:n,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[n,i]}async logEvaluationFeedback(e,t,r){const[n]=await this._logEvaluationFeedback(e,t,r);return n}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:n,limit:i}=e,a=new URLSearchParams;t&&t.forEach(((e,t)=>{nu(e,`queueIds[${t}]`),a.append("ids",e)})),r&&a.append("name",r),n&&a.append("name_contains",n),a.append("limit",(void 0!==i?Math.min(i,100):100).toString());let s=0;for await(const e of this._getPaginated("/annotation-queues",a))if(yield*e,s++,void 0!==i&&s>=i)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:n}=e,i={name:t,description:r,id:n||ec()},a=await this.caller.call(Bc(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter((([e,t])=>void 0!==t)))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:n}=t,i=await this.caller.call(Bc(),`${this.apiUrl}/annotation-queues/${nu(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:n}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(Bc(),`${this.apiUrl}/annotation-queues/${nu(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(Bc(),`${this.apiUrl}/annotation-queues/${nu(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map(((e,t)=>nu(e,`runIds[${t}]`).toString()))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${nu(e,"queueId")}/run`,n=await this.caller.call(Bc(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(n,"get run from annotation queue"),await n.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.\n\n      Current tenant: ${r.tenant_handle}\n\n      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(Bc(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const e="string"==typeof r.detail?r.detail:JSON.stringify(r.detail),n=new Error(`Error ${t.status}: ${t.statusText}\n${e}`);throw n.statusCode=t.status,n}if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,n,i]=ou(e),a=await this.caller.call(Bc(),`${this.apiUrl}/likes/${r}/${n}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(a,(t?"like":"unlike")+" prompt"),await a.json()}async _getPromptUrl(e){const[t,r,n]=ou(e);if(await this._currentTenantIsOwner(t)){const e=await this._getSettings();return"latest"!==n?`${this.getHostUrl()}/prompts/${r}/${n.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==n?`${this.getHostUrl()}/hub/${t}/${r}/${n.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,(e=>e.commits)))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),void 0!==e?.isPublic&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(const e of this._getPaginated("/repos",t,(e=>e.repos)))yield*e}async getPrompt(e){const[t,r,n]=ou(e),i=await this.caller.call(Bc(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===i.status)return null;await cu(i,"get prompt");const a=await i.json();return a.repo?a.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error("Cannot create a public prompt without first\n\n        creating a LangChain Hub handle. \n        You can add a handle by creating a public prompt at:\n\n        https://smith.langchain.com/prompts");const[n,i,a]=ou(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("create a prompt",n);const s={repo_handle:i,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},o=await this.caller.call(Bc(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(o,"create prompt");const{repo:l}=await o.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,i,a]=ou(e),s="latest"!==r?.parentCommitHash&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${n}/${i}`),o={manifest:JSON.parse(JSON.stringify(t)),parent_commit:s},l=await this.caller.call(Bc(),`${this.apiUrl}/commits/${n}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(l,"create commit");const c=await l.json();return this._getPromptUrl(`${n}/${i}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,n]=ou(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const i={};if(void 0!==t?.description&&(i.description=t.description),void 0!==t?.readme&&(i.readme=t.readme),void 0!==t?.tags&&(i.tags=t.tags),void 0!==t?.isPublic&&(i.is_public=t.isPublic),void 0!==t?.isArchived&&(i.is_archived=t.isArchived),0===Object.keys(i).length)throw new Error("No valid update options provided");const a=await this.caller.call(Bc(),`${this.apiUrl}/repos/${r}/${n}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await cu(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,n]=ou(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);const i=await this.caller.call(Bc(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async pullPromptCommit(e,t){const[r,n,i]=ou(e);let a=i;if(!function(e){const t=(0,su.parse)(e),r=(0,su.parse)("0.5.23");if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}((await this._getServerInfo()).version)&&"latest"===i){const e=await this._getLatestCommitHash(`${r}/${n}`);if(!e)throw new Error("No commits found");a=e}const s=await this.caller.call(Bc(),`${this.apiUrl}/commits/${r}/${n}/${a}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await cu(s,"pull prompt commit");const o=await s.json();return{owner:r,repo:n,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some((e=>"object"!==e))&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:n}=t,[i,a]=this.parseTokenOrUrl(e,r),s=new _u({apiUrl:i,apiKey:"placeholder"}),o=await s.readSharedDataset(a),l=n||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}const c=await s.listSharedExamples(a),u=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map((e=>e.inputs)),outputs:c.flatMap((e=>e.outputs?[e.outputs]:[])),datasetId:u.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,n="dataset"){try{return nu(e),[t,e]}catch(e){}try{const i=new URL(e).pathname.split("/").filter((e=>""!==e));if(i.length>=r)return[t,i[i.length-r]];throw new Error(`Invalid public ${n} URL: ${e}`)}catch(t){throw new Error(`Invalid public ${n} URL or token: ${e}`)}}}class xu{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},n=[];for(const e of t){const[t,i]=e.split("="),a=decodeURIComponent(i);"langsmith-metadata"===t?r=JSON.parse(a):"langsmith-tags"===t&&(n=a.split(","))}return new xu(r,n)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class Eu{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=Eu.getDefaultConfig(),{metadata:r,...n}=e,i=n.client??Eu.getSharedClient(),a={...r,...n?.extra?.metadata};if(n.extra={...n.extra,metadata:a},Object.assign(this,{...t,...n,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const e=function(e,t,r=1){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${n}Z`.replace(/[-:.]/g,"")+t}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static getDefaultConfig(){return{id:ec(),run_type:"chain",project_name:Qc("LANGCHAIN_PROJECT")??Qc("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Qc("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Qc("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Eu.sharedClient||(Eu.sharedClient=new _u),Eu.sharedClient}createChild(e){const t=this.child_execution_order+1,r=new Eu({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t}),n=Symbol.for("lc:child_config"),i=e.extra?.[n]??this.extra[n];if(void 0!==(a=i)&&"object"==typeof a.callbacks&&(Su(a.callbacks?.handlers)||Su(a.callbacks))){const e={...i},t=function(e){return"object"==typeof e&&null!=e&&Array.isArray(e.handlers)}(e.callbacks)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:r.id}),t.handlers?.find(Tu)?.updateFromRunTree?.(r),e.callbacks=t),r.extra[n]=e}var a;const s=new Set;let o=this;for(;null!=o&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now()){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r}_convertToCreate(e,t,r=!0){const n=e.extra??{};if(n.runtime||(n.runtime={}),t)for(const[e,r]of Object.entries(t))n.runtime[e]||(n.runtime[e]=r);let i,a;return r?(a=e.parent_run?.id,i=[]):(i=e.child_runs.map((e=>this._convertToCreate(e,t,r))),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){const t=await Yc(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){au("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const e of this.child_runs)await e.postRun(!1)}}async patchRun(){const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){const r=e?.callbacks;let n,i,a,s=!!["TRACING_V2","TRACING"].find((e=>"true"===eu(e)));if(r){const e=r?.getParentRunId?.()??"",t=r?.handlers?.find((e=>"langchain_tracer"==e?.name));n=t?.getRun?.(e),i=t?.projectName,a=t?.client,s=s||!!t}return n?new Eu({name:n.name,id:n.id,trace_id:n.trace_id,dotted_order:n.dotted_order,client:a,tracingEnabled:s,project_name:i,tags:[...new Set((n?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...n?.extra?.metadata,...e?.metadata}}}).createChild(t):new Eu({...t,client:a,tracingEnabled:s,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){const r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,n=r["langsmith-trace"];if(!n||"string"!=typeof n)return;const i=n.trim(),a=i.split(".").map((e=>{const[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}})),s=a[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:s,dotted_order:i};if(r.baggage&&"string"==typeof r.baggage){const e=xu.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags}return new Eu(o)}toHeaders(e){const t={"langsmith-trace":this.dotted_order,baggage:new xu(this.extra?.metadata,this.tags).toHeader()};if(e)for(const[r,n]of Object.entries(t))e.set(r,n);return t}}function Tu(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function Su(e){return Array.isArray(e)&&e.some((e=>Tu(e)))}Object.defineProperty(Eu,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});const Pu="0.1.59";var Ou=r(9418);function ku(e,t){return`${e.open}${t}${e.close}`}function Au(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function Iu(e){return"string"==typeof e?e.trim():null==e?e:Au(e,e.toString())}function Cu(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:Ru}=Ou;class ju extends Dc{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const n=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?ku(Ou.bold,n):n})).join(" > ");return ku(Ru.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Au(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.cyan,"[chain/end]")} [${t}] [${Cu(e)}] Exiting Chain run with output: ${Au(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.red,"[chain/error]")} [${t}] [${Cu(e)}] Chain run errored with error: ${Au(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${ku(Ru.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Au(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.cyan,"[llm/end]")} [${t}] [${Cu(e)}] Exiting LLM run with output: ${Au(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.red,"[llm/error]")} [${t}] [${Cu(e)}] LLM run errored with error: ${Au(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Iu(e.inputs.input)}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.cyan,"[tool/end]")} [${t}] [${Cu(e)}] Exiting Tool run with output: "${Iu(e.outputs?.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.red,"[tool/error]")} [${t}] [${Cu(e)}] Tool run errored with error: ${Au(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Au(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.cyan,"[retriever/end]")} [${t}] [${Cu(e)}] Exiting Retriever run with output: ${Au(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${ku(Ru.red,"[retriever/error]")} [${t}] [${Cu(e)}] Retriever run errored with error: ${Au(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${ku(Ru.blue,"[agent/action]")} [${r}] Agent selected action: ${Au(t.actions[t.actions.length-1],"[action]")}`)}}class Nu extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function $u(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const r=[];let n=!1,i=!1;for(let a of e){if(n)'"'!==a||i?"\n"!==a||i?i="\\"===a&&!i:a="\\n":n=!1;else if('"'===a)n=!0,i=!1;else if("{"===a)r.push("}");else if("["===a)r.push("]");else if("}"===a||"]"===a){if(!r||r[r.length-1]!==a)return null;r.pop()}t+=a}n&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}function Lu(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?Uu(e,t)??[...e,...t]:[...e,{type:"text",text:t}]}class Mu extends Ac{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(null===e)return this;const t=(r=this._printableFields,n=Math.max(4,e),JSON.stringify(function e(t,r){if("object"!=typeof t||null==t)return t;if(r>=n)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map((t=>e(t,r+1)));const i={};for(const n of Object.keys(t))i[n]=e(t[n],r+1);return i}(r,0),null,2));var r,n;return`${this.constructor.lc_name()} ${t}`}}function Du(e,t){const r={...e};for(const[e,n]of Object.entries(t))if(null==r[e])r[e]=n;else{if(null==n)continue;if(typeof r[e]!=typeof n||Array.isArray(r[e])!==Array.isArray(n))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e]){if("type"===e)continue;r[e]+=n}else if("object"!=typeof r[e]||Array.isArray(r[e]))if(Array.isArray(r[e]))r[e]=Uu(r[e],n);else{if(r[e]===n)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else r[e]=Du(r[e],n)}return r}function Uu(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const r=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=r.findIndex((t=>t.index===e.index));-1!==t?r[t]=Du(r[t],e):r.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}}function Fu(e,t){if(!e&&!t)throw new Error("Cannot merge two undefined objects.");if(e&&t){if(typeof e!=typeof t)throw new Error(`Cannot merge objects of different types.\nLeft ${typeof e}\nRight ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return Uu(e,t);if("object"==typeof e&&"object"==typeof t)return Du(e,t);if(e===t)return e;throw new Error(`Can not merge objects of different types.\nLeft ${e}\nRight ${t}`)}return e||t}class Vu extends Mu{}class Bu extends Mu{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Zu extends Vu{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Zu({content:Lu(this.content,e.content),additional_kwargs:Du(this.additional_kwargs,e.additional_kwargs),response_metadata:Du(this.response_metadata,e.response_metadata),artifact:Fu(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:(t=this.status,r=e.status,"error"===t||"error"===r?"error":"success")});var t,r}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Hu extends Mu{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if("string"==typeof e)r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const t=r.additional_kwargs?.tool_calls,n=r.tool_calls;null!=t&&t.length>0&&(void 0===n||0===n.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===n){const[e,n]=function(e){const t=[],r=[];for(const n of e)if(n.function){const e=n.function.name;try{const r={name:e||"",args:JSON.parse(n.function.arguments)||{},id:n.id};t.push(r)}catch(t){r.push({name:e,args:n.function.arguments,id:n.id,error:"Malformed args."})}}return[t,r]}(t);r.tool_calls=e??[],r.invalid_tool_calls=n??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch(e){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof r&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}class Gu extends Vu{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],n=[];for(const t of e.tool_call_chunks){let e={};try{if(e=$u(t.args||"{}"),null===e||"object"!=typeof e||Array.isArray(e))throw new Error("Malformed tool call chunk args.");r.push({name:t.name??"",args:e,id:t.id,type:"tool_call"})}catch(e){n.push({name:t.name,args:t.args,id:t.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:n}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:Lu(this.content,e.content),additional_kwargs:Du(this.additional_kwargs,e.additional_kwargs),response_metadata:Du(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const r=Uu(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){const r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},n=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i={input_tokens:r.input_tokens+n.input_tokens,output_tokens:r.output_tokens+n.output_tokens,total_tokens:r.total_tokens+n.total_tokens};t.usage_metadata=i}return new Gu(t)}}class zu extends Mu{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return zu}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}get _printableFields(){return{...super._printableFields,role:this.role}}}class Wu extends Vu{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Wu({content:Lu(this.content,e.content),additional_kwargs:Du(this.additional_kwargs,e.additional_kwargs),response_metadata:Du(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class qu extends Mu{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class Ju extends Vu{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Ju({content:Lu(this.content,e.content),additional_kwargs:Du(this.additional_kwargs,e.additional_kwargs),response_metadata:Du(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Ku extends Mu{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Xu extends Vu{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Xu({content:Lu(this.content,e.content),additional_kwargs:Du(this.additional_kwargs,e.additional_kwargs),response_metadata:Du(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Yu extends Mu{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Qu extends Vu{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Qu({content:Lu(this.content,e.content),additional_kwargs:Du(this.additional_kwargs,e.additional_kwargs),response_metadata:Du(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function ed(e,t="Human",r="AI"){const n=[];for(const i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=r;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else{if("generic"!==i._getType())throw new Error(`Got unsupported message type: ${i._getType()}`);e=i.role}const a=i.name?`${i.name}, `:"",s="string"==typeof i.content?i.content:JSON.stringify(i.content,null,2);n.push(`${e}: ${a}${s}`)}return n.join("\n")}class td extends Dc{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:n}=e;this.projectName=r??jc("LANGCHAIN_PROJECT")??jc("LANGCHAIN_SESSION"),this.exampleId=t,this.client=n??new _u({});const i=td.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Rc()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);)t=t.parent_run;r.clear();const n=[t];for(;n.length>0;){const e=n.shift();e&&!r.has(e.id)&&(r.add(e.id),this.runMap.set(e.id,e),e.child_runs&&n.push(...e.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[e,n]of this.runMap){const i=new Eu({...n,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[e]=i,r.push([e,n.dotted_order])}r.sort(((e,t)=>e[1]&&t[1]?e[1].localeCompare(t[1]):0));for(const[e]of r){const r=this.runMap.get(e),n=t[e];if(r&&n&&r.parent_run_id){const e=t[r.parent_run_id];e&&(e.child_runs.push(n),n.parent_run=e)}}return t[e]}static getTraceableRunTree(){try{return(()=>{const e=nc.getInstance().getStore();if(void 0===e)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join("\n"));return e})()}catch{return}}}let rd;async function nd(e,t){!0===t?await e():(void 0===rd&&(rd=new(0,Uc.default)({autoStart:!0,concurrency:1})),rd.add(e))}class id{setHandler(e){return this.setHandlers([e])}}class ad{constructor(e,t,r,n,i,a,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map((t=>nd((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleCustomEvent(e,t,r,n,i){await Promise.all(this.handlers.map((r=>nd((async()=>{try{await(r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}}),r.awaitHandlers))))}}class sd extends ad{getChild(e){const t=new ud(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class od extends ad{async handleLLMNewToken(e,t,r,n,i,a){await Promise.all(this.handlers.map((r=>nd((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}}),r.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class ld extends ad{getChild(e){const t=new ud(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,n,i){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleChainEnd(e,t,r,n,i){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class cd extends ad{getChild(e){const t=new ud(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>nd((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}}),t.awaitHandlers))))}}class ud extends id{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,n=void 0,i=void 0,a=void 0,s=void 0,o=void 0){return Promise.all(t.map((async(t,n)=>{const a=0===n&&r?r:ec();return await Promise.all(this.handlers.map((r=>{if(!r.ignoreLLM)return Mc(r)&&r._createRunForLLMStart(e,[t],a,this._parentRunId,i,this.tags,this.metadata,o),nd((async()=>{try{await(r.handleLLMStart?.(e,[t],a,this._parentRunId,i,this.tags,this.metadata,o))}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}}),r.awaitHandlers)}))),new od(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r=void 0,n=void 0,i=void 0,a=void 0,s=void 0,o=void 0){return Promise.all(t.map((async(t,n)=>{const a=0===n&&r?r:ec();return await Promise.all(this.handlers.map((r=>{if(!r.ignoreLLM)return Mc(r)&&r._createRunForChatModelStart(e,[t],a,this._parentRunId,i,this.tags,this.metadata,o),nd((async()=>{try{if(r.handleChatModelStart)await(r.handleChatModelStart?.(e,[t],a,this._parentRunId,i,this.tags,this.metadata,o));else if(r.handleLLMStart){const n=ed(t);await(r.handleLLMStart?.(e,[n],a,this._parentRunId,i,this.tags,this.metadata,o))}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}}),r.awaitHandlers)}))),new od(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=ec(),n=void 0,i=void 0,a=void 0,s=void 0){return await Promise.all(this.handlers.map((i=>{if(!i.ignoreChain)return Mc(i)&&i._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,n,s),nd((async()=>{try{await(i.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,n,s))}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`),i.raiseError)throw e}}),i.awaitHandlers)}))),new ld(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=ec(),n=void 0,i=void 0,a=void 0,s=void 0){return await Promise.all(this.handlers.map((n=>{if(!n.ignoreAgent)return Mc(n)&&n._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),nd((async()=>{try{await(n.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s))}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolStart: ${e}`),n.raiseError)throw e}}),n.awaitHandlers)}))),new cd(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=ec(),n=void 0,i=void 0,a=void 0,s=void 0){return await Promise.all(this.handlers.map((n=>{if(!n.ignoreRetriever)return Mc(n)&&n._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),nd((async()=>{try{await(n.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s))}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetrieverStart: ${e}`),n.raiseError)throw e}}),n.awaitHandlers)}))),new sd(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,n,i){await Promise.all(this.handlers.map((n=>nd((async()=>{if(!n.ignoreCustomEvent)try{await(n.handleCustomEvent?.(e,t,r,this.tags,this.metadata))}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleCustomEvent: ${e}`),n.raiseError)throw e}}),n.awaitHandlers))))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new ud(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const n of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===n.name))||r.addHandler(n,t);return r}static fromHandlers(e){const t=new this;return t.addHandler(new class extends $c{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ec()}),Object.assign(this,e)}}),t}static configure(e,t,r,n,i,a,s){return this._configureSync(e,t,r,n,i,a,s)}static _configureSync(e,t,r,n,i,a,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new ud,o.setHandlers(e?.map(dd)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(dd):t?.handlers,!1));const l="true"===jc("LANGCHAIN_VERBOSE")||s?.verbose,c=td.getTraceableRunTree()?.tracingEnabled||!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find((e=>"true"===jc(e))),u=c||(jc("LANGCHAIN_TRACING")??!1);if(l||u){if(o||(o=new ud),l&&!o.handlers.some((e=>e.name===ju.prototype.name))){const e=new ju;o.addHandler(e,!0)}if(u&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&c){const e=new td;o.addHandler(e,!0),o._parentRunId=td.getTraceableRunTree()?.id??o._parentRunId}}return(r||n)&&o&&(o.addTags(r??[]),o.addTags(n??[],!1)),(i||a)&&o&&(o.addMetadata(i??{}),o.addMetadata(a??{},!1)),o}}function dd(e){return"name"in e?e:$c.fromMethods(e)}const hd=new class{getStore(){}run(e,t){return t()}},pd=Symbol.for("ls:tracing_async_local_storage"),md=Symbol.for("lc:child_config"),fd=new class{getInstance(){return globalThis[pd]??hd}getRunnableConfig(){const e=this.getInstance();return e.getStore()?.extra?.[md]}runWithConfig(e,t,r){const n=ud._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),i=this.getInstance(),a=n?.getParentRunId(),s=n?.handlers?.find((e=>"langchain_tracer"===e?.name));let o;return s&&a?o=s.convertToRunTree(a):r||(o=new Eu({name:"<runnable_lambda>",tracingEnabled:!1})),o&&(o.extra={...o.extra,[md]:e}),i.run(o,t)}initializeGlobalInstance(e){void 0===globalThis[pd]&&(globalThis[pd]=e)}};async function gd(e,t){if(void 0===t)return e;let r;return Promise.race([e.catch((e=>{if(!t?.aborted)throw e})),new Promise(((e,n)=>{r=()=>{n(new Error("Aborted"))},t.addEventListener("abort",r),t.aborted&&n(new Error("Aborted"))}))]).finally((()=>t.removeEventListener("abort",r)))}class yd extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new yd({start:e=>function r(){return t.read().then((({done:t,value:n})=>{if(!t)return e.enqueue(n),r();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new yd({async pull(t){const{value:r,done:n}=await e.next();n&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function vd(e,t=2){const r=Array.from({length:t},(()=>[]));return r.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function bd(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const r={...e};for(const[e,n]of Object.entries(t))e in r&&!Array.isArray(r[e])?r[e]=bd(r[e],n):r[e]=n;return r}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class wd{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise(((t,r)=>{fd.runWithConfig(e.config,(async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then((e=>t(void 0)),r)}),!0)}))}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?fd.runWithConfig(this.config,this.signal?async()=>gd(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}class _d{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=vc({},t);return new xd({ops:t,state:r[r.length-1].newDocument})}}class xd extends _d{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=vc(this.state,e.ops);return new xd({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=vc({},e.ops);return new xd({ops:e.ops,state:t[t.length-1].newDocument})}}const Ed=e=>"log_stream_tracer"===e.name;async function Td(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||""!==r?.input?r.input:void 0}async function Sd(e,t){const{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&void 0!==r?.output?r.output:r}class Pd extends Dc{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=yd.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new _d({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new _d({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await Td(e,this._schemaFormat)),await this.writer.write(new _d({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await Td(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Sd(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const n=new _d({ops:r});await this.writer.write(n)}finally{if(e.id===this.rootId){const t=new _d({ops:[{op:"replace",path:"/final_output",value:await Sd(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const n=this.keyMapByRunId[e.id];if(void 0===n)return;let i;var a;void 0!==e.inputs.messages?(a=r?.chunk,i=void 0!==a&&void 0!==a.message?r?.chunk:new Gu({id:`run-${e.id}`,content:t})):i=t;const s=new _d({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${n}/streamed_output/-`,value:i}]});await this.writer.write(s)}}const Od="__run";class kd{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new kd({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Ad extends kd{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Ad({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function Id({name:e,serialized:t}){return void 0!==e?e:void 0!==t?.name?t.name:void 0!==t?.id&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}const Cd=e=>"event_stream_tracer"===e.name;class Rd extends Dc{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=yd.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const n=this.runInfoMap.get(e);if(void 0===n)return void(yield r.value);function i(e,t){return"llm"===e&&"string"==typeof t?new kd({text:t}):t}let a=this.tappedPromises.get(e);if(void 0===a){let s;a=new Promise((e=>{s=e})),this.tappedPromises.set(e,a);try{const a={event:`on_${n.runType}_stream`,run_id:e,name:n.name,tags:n.tags,metadata:n.metadata,data:{}};await this.send({...a,data:{chunk:i(n.runType,r.value)}},n),yield r.value;for await(const e of t)"tool"!==n.runType&&"retriever"!==n.runType&&await this.send({...a,data:{chunk:i(n.runType,e)}},n),yield e}finally{s()}}else{yield r.value;for await(const e of t)yield e}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);void 0!==r?r.then((()=>{this.send(e,t)})):await this.send(e,t)}async onLLMStart(e){const t=Id(e),r=void 0!==e.inputs.messages?"chat_model":"llm",n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,n);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onLLMNewToken(e,t,r){const n=this.runInfoMap.get(e.id);let i,a;if(void 0===n)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===n.runType)a="on_chat_model_stream",i=void 0===r?.chunk?new Gu({content:t,id:`run-${e.id}`}):r.chunk.message;else{if("llm"!==n.runType)throw new Error(`Unexpected run type ${n.runType}`);a="on_llm_stream",i=void 0===r?.chunk?new kd({text:t}):r.chunk}await this.send({event:a,data:{chunk:i},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}}async onLLMEnd(e){const t=this.runInfoMap.get(e.id);let r;if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const n=e.outputs?.generations;let i;if("chat_model"===t.runType){for(const e of n??[]){if(void 0!==i)break;i=e[0]?.message}r="on_chat_model_end"}else{if("llm"!==t.runType)throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);i={generations:n?.map((e=>e.map((e=>({text:e.text,generationInfo:e.generationInfo}))))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end"}await this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){const t=Id(e),r=e.run_type??"chain",n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type};let i={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(i={},n.inputs={}):void 0!==e.inputs.input?(i.input=e.inputs.input,n.inputs=e.inputs.input):(i.input=e.inputs,n.inputs=e.inputs),this.runInfoMap.set(e.id,n),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onChainEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,n=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:n};n.input&&1===Object.keys(n).length&&(i.input=n.input,t.inputs=n.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){const t=Id(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=void 0===e.outputs?.output?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){const t=Id(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const n=this.runInfoMap.get(r);if(void 0===n)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:n.tags,metadata:n.metadata,data:t},n)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally((()=>{this.writer.close()}))}}async function jd(e){return ud._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function Nd(...e){const t={};for(const r of e.filter((e=>!!e)))for(const e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){const n=t[e]??[];t[e]=[...new Set(n.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){const e=t.callbacks,n=r.callbacks;if(Array.isArray(n))if(e)if(Array.isArray(e))t.callbacks=e.concat(n);else{const r=e.copy();for(const e of n)r.addHandler(dd(e),!0);t.callbacks=r}else t.callbacks=n;else if(n)if(e)if(Array.isArray(e)){const r=n.copy();for(const t of e)r.addHandler(dd(t),!0);t.callbacks=r}else t.callbacks=new ud(n._parentRunId,{handlers:e.handlers.concat(n.handlers),inheritableHandlers:e.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(n.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(n.inheritableTags))),metadata:{...e.metadata,...n.metadata}});else t.callbacks=n}else{const n=e;t[n]=r[n]??t[n]}return t}const $d=new Set(["string","number","boolean"]);function Ld(e){const t=fd.getRunnableConfig();let r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){const{runId:e,runName:n,...i}=t;r=Object.entries(i).reduce(((e,[t,r])=>(void 0!==r&&(e[t]=r),e)),r)}if(e&&(r=Object.entries(e).reduce(((e,[t,r])=>(void 0!==r&&(e[t]=r),e)),r)),r?.configurable)for(const e of Object.keys(r.configurable))$d.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw new Error("Timeout must be a positive number");const e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function Md(e={},{callbacks:t,maxConcurrency:r,recursionLimit:n,runName:i,configurable:a,runId:s}={}){const o=Ld(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==n&&(o.recursionLimit=n),void 0!==r&&(o.maxConcurrency=r),void 0!==i&&(o.runName=i),void 0!==a&&(o.configurable={...o.configurable,...a}),void 0!==s&&delete o.runId,o}const Dd=[400,401,402,403,404,405,406,407,409],Ud=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&Dd.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class Fd{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Ud;const t=Uc.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>Wl((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}class Vd extends Dc{constructor({config:e,onStart:t,onEnd:r,onError:n}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=n}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function Bd(e){return!!e&&e.lc_runnable}class Zd{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const n=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||n.some((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&n.every((e=>!this.excludeTags?.includes(e)))),r}}const Hd=Symbol("Let zodToJsonSchema decide on which parser to use"),Gd={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function zd(e,t,r,n){n?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function Wd(e,t,r,n,i){e[t]=r,zd(e,t,n,i)}function qd(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(((r,n)=>qd(e,t,r)))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Jd(e,t)}}const Jd=(e,t)=>{const r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(const n of e.checks)switch(n.kind){case"min":Wd(r,"minimum",n.value,n.message,t);break;case"max":Wd(r,"maximum",n.value,n.message,t)}return r};let Kd;const Xd=/^[cC][^\s-]{8,}$/,Yd=/^[0-9a-z]+$/,Qd=/^[0-9A-HJKMNP-TV-Z]{26}$/,eh=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,th=()=>(void 0===Kd&&(Kd=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Kd),rh=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nh=/^[a-zA-Z0-9_-]{21}$/;function ih(e,t){const r={type:"string"};function n(e){return"escape"===t.patternStrategy?ah(e):e}if(e.checks)for(const i of e.checks)switch(i.kind){case"min":Wd(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":Wd(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":sh(r,"email",i.message,t);break;case"format:idn-email":sh(r,"idn-email",i.message,t);break;case"pattern:zod":oh(r,eh,i.message,t)}break;case"url":sh(r,"uri",i.message,t);break;case"uuid":sh(r,"uuid",i.message,t);break;case"regex":oh(r,i.regex,i.message,t);break;case"cuid":oh(r,Xd,i.message,t);break;case"cuid2":oh(r,Yd,i.message,t);break;case"startsWith":oh(r,RegExp(`^${n(i.value)}`),i.message,t);break;case"endsWith":oh(r,RegExp(`${n(i.value)}$`),i.message,t);break;case"datetime":sh(r,"date-time",i.message,t);break;case"date":sh(r,"date",i.message,t);break;case"time":sh(r,"time",i.message,t);break;case"duration":sh(r,"duration",i.message,t);break;case"length":Wd(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),Wd(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":oh(r,RegExp(n(i.value)),i.message,t);break;case"ip":"v6"!==i.version&&sh(r,"ipv4",i.message,t),"v4"!==i.version&&sh(r,"ipv6",i.message,t);break;case"emoji":oh(r,th,i.message,t);break;case"ulid":oh(r,Qd,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":sh(r,"binary",i.message,t);break;case"contentEncoding:base64":Wd(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":oh(r,rh,i.message,t)}break;case"nanoid":oh(r,nh,i.message,t)}return r}const ah=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),sh=(e,t,r,n)=>{e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Wd(e,"format",t,r,n)},oh=(e,t,r,n)=>{e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:lh(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Wd(e,"pattern",lh(t,n),r,n)},lh=(e,t)=>{const r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;const n=r.flags.includes("i"),i=r.flags.includes("m"),a=r.flags.includes("s"),s=n?r.source.toLowerCase():r.source;let o="",l=!1,c=!1,u=!1;for(let e=0;e<s.length;e++)if(l)o+=s[e],l=!1;else{if(n)if(c){if(s[e].match(/[a-z]/)){u?(o+=s[e],o+=`${s[e-2]}-${s[e]}`.toUpperCase(),u=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(o+=s[e],u=!0):o+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){o+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(i){if("^"===s[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){o+="($|(?=[\r\n]))";continue}}a&&"."===s[e]?o+=c?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(o+=s[e],"\\"===s[e]?l=!0:c&&"]"===s[e]?c=!1:c||"["!==s[e]||(c=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function ch(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===cl.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((r,n)=>({...r,[n]:ph(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",n]})??{}})),{}),additionalProperties:!1};const r={type:"object",additionalProperties:ph(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===cl.ZodString&&e.keyType._def.checks?.length){const n=Object.entries(ih(e.keyType._def,t)).reduce(((e,[t,r])=>"type"===t?e:{...e,[t]:r}),{});return{...r,propertyNames:n}}return e.keyType?._def.typeName===cl.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}const uh={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},dh=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,r)=>ph(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return r.length?{anyOf:r}:void 0};function hh(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:ph(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:ph(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function ph(e,t,r=!1){const n=t.seen.get(e);if(t.override){const i=t.override?.(e,t,n,r);if(i!==Hd)return i}if(n&&!r){const e=mh(n,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const a=gh(e,e.typeName,t);return a&&yh(e,t,a),i.jsonSchema=a,a}const mh=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:fh(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},fh=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},gh=(e,t,r)=>{switch(t){case cl.ZodString:return ih(e,r);case cl.ZodNumber:return function(e,t){const r={type:"number"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"int":r.type="integer",zd(r,"type",n.message,t);break;case"min":"jsonSchema7"===t.target?n.inclusive?Wd(r,"minimum",n.value,n.message,t):Wd(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),Wd(r,"minimum",n.value,n.message,t));break;case"max":"jsonSchema7"===t.target?n.inclusive?Wd(r,"maximum",n.value,n.message,t):Wd(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),Wd(r,"maximum",n.value,n.message,t));break;case"multipleOf":Wd(r,"multipleOf",n.value,n.message,t)}return r}(e,r);case cl.ZodObject:return function(e,t){const r={type:"object",...Object.entries(e.shape()).reduce(((e,[r,n])=>{if(void 0===n||void 0===n._def)return e;const i=ph(n._def,{...t,currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]});return void 0===i?e:{properties:{...e.properties,[r]:i},required:n.isOptional()?e.required:[...e.required,r]}}),{properties:{},required:[]}),additionalProperties:hh(e,t)};return r.required.length||delete r.required,r}(e,r);case cl.ZodBigInt:return function(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"min":"jsonSchema7"===t.target?n.inclusive?Wd(r,"minimum",n.value,n.message,t):Wd(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),Wd(r,"minimum",n.value,n.message,t));break;case"max":"jsonSchema7"===t.target?n.inclusive?Wd(r,"maximum",n.value,n.message,t):Wd(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),Wd(r,"maximum",n.value,n.message,t));break;case"multipleOf":Wd(r,"multipleOf",n.value,n.message,t)}return r}(e,r);case cl.ZodBoolean:return{type:"boolean"};case cl.ZodDate:return qd(e,r);case cl.ZodUndefined:return{not:{}};case cl.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(r);case cl.ZodArray:return function(e,t){const r={type:"array"};return e.type?._def?.typeName!==cl.ZodAny&&(r.items=ph(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Wd(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Wd(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Wd(r,"minItems",e.exactLength.value,e.exactLength.message,t),Wd(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case cl.ZodUnion:case cl.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return dh(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every((e=>e._def.typeName in uh&&(!e._def.checks||!e._def.checks.length)))){const e=r.reduce(((e,t)=>{const r=uh[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e}),[]);return{type:e.length>1?e:e[0]}}if(r.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=r.reduce(((e,t)=>{const r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===r.length){const t=e.filter(((e,t,r)=>r.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:r.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(r.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:r.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return dh(e,t)}(e,r);case cl.ZodIntersection:return function(e,t){const r=[ph(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),ph(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let n="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return r.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:r,...n}=e;t=n}else n=void 0;i.push(t)}else i.push(...e.allOf),void 0===e.unevaluatedProperties&&(n=void 0);var t})),i.length?{allOf:i,...n}:void 0}(e,r);case cl.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,r)=>ph(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:ph(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,r)=>ph(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,r);case cl.ZodRecord:return ch(e,r);case cl.ZodLiteral:return function(e,t){const r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case cl.ZodEnum:return function(e){return{type:"string",enum:e.values}}(e);case cl.ZodNativeEnum:return function(e){const t=e.values,r=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),n=Array.from(new Set(r.map((e=>typeof e))));return{type:1===n.length?"string"===n[0]?"string":"number":["string","number"],enum:r}}(e);case cl.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:uh[e.innerType._def.typeName],nullable:!0}:{type:[uh[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const r=ph(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const r=ph(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case cl.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return ph(e.innerType._def,t);const r=ph(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}})(e,r);case cl.ZodMap:return function(e,t){return"record"===t.mapStrategy?ch(e,t):{type:"array",maxItems:125,items:{type:"array",items:[ph(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},ph(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case cl.ZodSet:return function(e,t){const r={type:"array",uniqueItems:!0,items:ph(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Wd(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Wd(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case cl.ZodLazy:return ph(e.getter()._def,r);case cl.ZodPromise:return function(e,t){return ph(e.type._def,t)}(e,r);case cl.ZodNaN:case cl.ZodNever:return{not:{}};case cl.ZodEffects:return function(e,t){return"input"===t.effectStrategy?ph(e.schema._def,t):{}}(e,r);case cl.ZodAny:case cl.ZodUnknown:return{};case cl.ZodDefault:return function(e,t){return{...ph(e.innerType._def,t),default:e.defaultValue()}}(e,r);case cl.ZodBranded:return function(e,t){return ph(e.type._def,t)}(e,r);case cl.ZodReadonly:case cl.ZodCatch:return((e,t)=>ph(e.innerType._def,t))(e,r);case cl.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return ph(e.in._def,t);if("output"===t.pipeStrategy)return ph(e.out._def,t);const r=ph(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[r,ph(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]})].filter((e=>void 0!==e))}})(e,r);case cl.ZodFunction:case cl.ZodVoid:case cl.ZodSymbol:default:return}},yh=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),vh=(e,t)=>{const r=(e=>{const t=(e=>"string"==typeof e?{...Gd,name:e}:{...Gd,...e})(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),n="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,n])=>({...e,[t]:ph(n._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}})),{}):void 0,i="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,a=ph(e._def,void 0===i?r:{...r,currentPath:[...r.basePath,r.definitionPath,i]},!1)??{},s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(a.title=s);const o=void 0===i?n?{...a,[r.definitionPath]:n}:a:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...n,[i]:a}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===r.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function bh(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}function wh(e,t){return[t[e.source]??e.source,t[e.target]??e.target]}function _h(e){if(!ru(e.id))return e.id;if(!Bd(e.data))return e.data.name??"UnknownSchema";try{let t=e.data.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t.length>42&&(t=`${t.substring(0,42)}...`),t}catch(t){return e.data.getName()}}function xh(e){return Bd(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...vh(e.data.schema),title:e.data.name}}}class Eh{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach(((t,r)=>{e[t.id]=ru(t.id)?r:t.id})),{nodes:Object.values(this.nodes).map((t=>({id:e[t.id],...xh(t)}))),edges:this.edges.map((t=>{const r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r}))}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const r=t||ec(),n={id:r,data:e};return this.nodes[r]=n,n}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter((t=>t.source!==e.id&&t.target!==e.id))}addEdge(e,t,r,n){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r,conditional:n};return this.edges.push(i),i}firstNode(){const e=new Set(this.edges.map((e=>e.target))),t=[];return Object.values(this.nodes).forEach((r=>{e.has(r.id)||t.push(r)})),t[0]}lastNode(){const e=new Set(this.edges.map((e=>e.source))),t=[];return Object.values(this.nodes).forEach((r=>{e.has(r.id)||t.push(r)})),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map((e=>e.id)).every(ru)&&(r="");const n=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach((([e,t])=>{this.nodes[n(e)]={...t,id:n(e)}}));const i=e.edges.map((e=>({...e,source:n(e.source),target:n(e.target)})));this.edges=[...this.edges,...i];const a=e.firstNode(),s=e.lastNode();return[a?{id:n(a.id),data:a.data}:void 0,s?{id:n(s.id),data:s.data}:void 0]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter((t=>t.source===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter((t=>t.target===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:n={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:i}=e??{},a={};for(const e of Object.values(this.nodes))a[e.id]=_h(e);const s=this.firstNode(),o=s?_h(s):void 0,l=this.lastNode(),c=l?_h(l):void 0;return function(e,t,r){const{firstNodeLabel:n,lastNodeLabel:i,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{};let c=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%\ngraph TD;\n`:"graph TD;\n";if(s){const t="default",r={[t]:"{0}([{1}]):::otherclass"};void 0!==n&&(r[n]="{0}[{0}]:::startclass"),void 0!==i&&(r[i]="{0}[{0}]:::endclass");for(const n of Object.values(e)){const e=r[n]??r[t],i=bh(n),a=n.split(":"),s=a[a.length-1];c+=`\t${e.replace(/\{0\}/g,i).replace(/\{1\}/g,s)};\n`}}let u="";for(const r of t){const t=r.source.includes(":")?r.source.split(":")[0]:void 0,n=r.target.includes(":")?r.target.split(":")[0]:void 0;""===u||u===t&&u===n||(c+="\tend\n",u=""),""===u&&void 0!==t&&t===n&&(c=`\tsubgraph ${t}\n`,u=t);const[i,a]=wh(r,e);let s="";if(void 0!==r.data){let e=r.data;const t=e.split(" ");t.length>l&&(e=t.reduce(((e,t,r)=>(r%l==0&&e.push(""),e[e.length-1]+=` ${t}`,e)),[]).join("<br>")),s=r.conditional?` -. ${e} .-> `:` -- ${e} --\x3e `}else s=r.conditional?" -.-> ":" --\x3e ";c+=`\t${bh(i)}${s}${bh(a)};\n`}return""!==u&&(c+="end\n"),s&&void 0!==a&&(c+=function(e){let t="";for(const[r,n]of Object.entries(e))t+=`\tclassDef ${r}class fill:${n};\n`;return t}(a)),c}(a,this.edges,{firstNodeLabel:o,lastNodeLabel:c,withStyles:t,curveStyle:r,nodeColors:n,wrapLabelNWords:i})}async drawMermaidPng(e){return async function(e,t){let{backgroundColor:r="white"}=t??{};const n=btoa(e);void 0!==r&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));const i=`https://mermaid.ink/img/${n}?bgColor=${r}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join("\n"));return await a.blob()}(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function Th(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function Sh(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*Ph(e,t){for(;;){const{value:r,done:n}=fd.runWithConfig(e,t.next.bind(t),!0);if(n)break;yield r}}async function*Oh(e,t){const r=t[Symbol.asyncIterator]();for(;;){const{value:n,done:i}=await fd.runWithConfig(e,r.next.bind(t),!0);if(i)break;yield n}}function kh(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class Ah extends Ac{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Ih({bound:this,kwargs:e,config:{}})}map(){return new Ch({bound:this})}withRetry(e){return new Rh({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new Ih({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new Mh({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Ld);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter((([e])=>"runId"!==e)));return Array.from({length:t},((t,n)=>Ld(0===n?e:r)))}return Array.from({length:t},(()=>Ld(e)))}async batch(e,t,r){const n=this._getOptionsList(t??{},e.length),i=n[0]?.maxConcurrency??r?.maxConcurrency,a=new Fd({maxConcurrency:i,onFailedAttempt:e=>{throw e}}),s=e.map(((e,t)=>a.call((async()=>{try{return await this.invoke(e,n[t])}catch(e){if(r?.returnExceptions)return e;throw e}}))));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=Ld(t),n=new wd({generator:this._streamIterator(e,r),config:r});return await n.setup,yd.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e){let t;t=Ld(void 0===e?e:{callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const n=Ld(r),i=await jd(n),a=await(i?.handleChainStart(this.toJSON(),kh(t,"input"),n.runId,n?.runType,void 0,void 0,n?.runName??this.getName()));let s;delete n.runId;try{const i=e.call(this,t,n,a);s=await gd(i,r?.signal)}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(kh(s,"output"))),s}async _batchWithConfig(e,t,r,n){const i=this._getOptionsList(r??{},t.length),a=await Promise.all(i.map(jd)),s=await Promise.all(a.map((async(e,r)=>{const n=await(e?.handleChainStart(this.toJSON(),kh(t[r],"input"),i[r].runId,i[r].runType,void 0,void 0,i[r].runName??this.getName()));return delete i[r].runId,n})));let o;try{const r=e.call(this,t,i,s,n);o=await gd(r,i?.[0]?.signal)}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(kh(o,"output"))))),o}async*_transformStreamWithConfig(e,t,r){let n,i,a=!0,s=!0;const o=Ld(r),l=await jd(o);let c;try{const u=await async function(e,t,r,n,...i){const a=new wd({generator:t,startSetup:r,signal:n}),s=await a.setup;return{output:e(a,s,...i),setup:s}}(t.bind(this),async function*(){for await(const t of e){if(a)if(void 0===n)n=t;else try{n=bd(n,t)}catch{n=void 0,a=!1}yield t}}(),(async()=>l?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName())),r?.signal,o);delete o.runId,c=u.setup;const d=c?.handlers.find(Cd);let h=u.output;void 0!==d&&void 0!==c&&(h=d.tapOutputIterable(c.runId,h));const p=c?.handlers.find(Ed);void 0!==p&&void 0!==c&&(h=p.tapOutputIterable(c.runId,h));for await(const e of h)if(yield e,s)if(void 0===i)i=e;else try{i=bd(i,e)}catch{i=void 0,s=!1}}catch(e){throw await(c?.handleChainError(e,void 0,void 0,void 0,{inputs:kh(n,"input")})),e}await(c?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:kh(n,"input")}))}getGraph(e){const t=new Eh,r=t.addNode({name:`${this.getName()}Input`,schema:zl.any()}),n=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:zl.any()});return t.addEdge(r,n),t.addEdge(n,i),t}pipe(e){return new jh({first:this,last:Dh(e)})}pick(e){return this.pipe(new Fh(e))}assign(e){return this.pipe(new Uh(new Nh({steps:e})))}async*transform(e,t){let r;for await(const t of e)r=void 0===r?t:bd(r,t);yield*this._streamIterator(r,Ld(t))}async*streamLog(e,t,r){const n=new Pd({...r,autoClose:!1,_schemaFormat:"original"}),i=Ld(t);yield*this._streamLog(e,n,i)}async*_streamLog(e,t,r){const{callbacks:n}=r;if(void 0===n)r.callbacks=[t];else if(Array.isArray(n))r.callbacks=n.concat([t]);else{const e=n.copy();e.addHandler(t,!0),r.callbacks=e}const i=this.stream(e,r),a=async function(){try{const e=await i;for await(const r of e){const e=new _d({ops:[{op:"add",path:"/streamed_output/-",value:r}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await a}}streamEvents(e,t,r){let n;if("v1"===t.version)n=this._streamEventsV1(e,t,r);else{if("v2"!==t.version)throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');n=this._streamEventsV2(e,t,r)}return"text/event-stream"===t.encoding?function(e){const t=new TextEncoder,r=new ReadableStream({async start(r){for await(const n of e)r.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(n)}\n\n`));r.enqueue(t.encode("event: end\n\n")),r.close()}});return yd.fromReadableStream(r)}(n):yd.fromAsyncGenerator(n)}async*_streamEventsV2(e,t,r){const n=new Rd({...r,autoClose:!1}),i=Ld(t),a=i.runId??ec();i.runId=a;const s=i.callbacks;if(void 0===s)i.callbacks=[n];else if(Array.isArray(s))i.callbacks=s.concat(n);else{const e=s.copy();e.addHandler(n,!0),i.callbacks=e}const o=this,l=async function(){try{const t=await o.stream(e,i),r=n.tapOutputIterable(a,t);for await(const e of r);}finally{await n.finish()}}();let c,u=!1;try{for await(const t of n)u?(t.run_id===c&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t):(t.data.input=e,u=!0,c=t.run_id,yield t)}finally{await l}}async*_streamEventsV1(e,t,r){let n,i=!1;const a=Ld(t),s=a.tags??[],o=a.metadata??{},l=a.runName??this.getName(),c=new Pd({...r,autoClose:!1,_schemaFormat:"streaming_events"}),u=new Zd({...r}),d=this._streamLog(e,c,a);for await(const t of d){if(n=n?n.concat(t):xd.fromRunLogPatch(t),void 0===n.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const t={...n.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};u.includeEvent(r,t.type)&&(yield r)}const r=t.ops.filter((e=>e.path.startsWith("/logs/"))).map((e=>e.path.split("/")[2])),a=[...new Set(r)];for(const e of a){let t,r={};const i=n.state.logs[e];if(t=void 0===i.end_time?i.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==i.inputs&&(r.input=i.inputs);else if("end"===t)void 0!==i.inputs&&(r.input=i.inputs),r.output=i.final_output;else if("stream"===t){const e=i.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);r={chunk:i.streamed_output[0]},i.streamed_output=[]}yield{event:`on_${i.type}_${t}`,name:i.name,run_id:i.id,tags:i.tags,metadata:i.metadata,data:r}}const{state:c}=n;if(c.streamed_output.length>0){const e=c.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${c.name}"`);const t={chunk:c.streamed_output[0]};c.streamed_output=[];const r={event:`on_${c.type}_stream`,run_id:c.id,tags:s,metadata:o,name:l,data:t};u.includeEvent(r,c.type)&&(yield r)}}const h=n?.state;if(void 0!==h){const e={event:`on_${h.type}_end`,name:l,run_id:h.id,tags:s,metadata:o,data:{output:h.final_output}};u.includeEvent(e,h.type)&&(yield e)}}static isRunnable(e){return Bd(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new Ih({bound:this,config:{},configFactories:[n=>({callbacks:[new Vd({config:n,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return function(e,t){const r=t.name??e.getName(),n=t.description??t.schema?.description;return t.schema.constructor===zl.ZodString?new Vh({name:r,description:n,schema:zl.object({input:zl.string()}).transform((e=>e.input)),bound:e}):new Vh({name:r,description:n,schema:t.schema,bound:e})}(this,e)}}class Ih extends Ah{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Nd(this.config,...e);return Nd(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Ld(t),this.kwargs))}async batch(e,t,r){const n=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig(Ld(e),this.kwargs)))):await this._mergeConfig(Ld(t),this.kwargs);return this.bound.batch(e,n,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Ld(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Ld(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Ld(t),this.kwargs))}streamEvents(e,t,r){const n=this;return yd.fromAsyncGenerator(async function*(){yield*n.bound.streamEvents(e,{...await n._mergeConfig(Ld(t),n.kwargs),version:t.version},r)}())}static isRunnableBinding(e){return e.bound&&Ah.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new Ih({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[n=>({callbacks:[new Vd({config:n,onStart:e,onEnd:t,onError:r})]})]})}}class Ch extends Ah{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ch({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,Md(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new Ch({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class Rh extends Ih{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const n=e>1?`retry:attempt:${e}`:void 0;return Md(t,{callbacks:r?.getChild(n)})}async _invoke(e,t,r){return Wl((n=>super.invoke(e,this._patchConfigForRetry(n,t,r))),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,n){const i={};try{await Wl((async a=>{const s=e.map(((e,t)=>t)).filter((e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error)),o=s.map((t=>e[t])),l=s.map((e=>this._patchConfigForRetry(a,t?.[e],r?.[e]))),c=await super.batch(o,l,{...n,returnExceptions:!0});let u;for(let e=0;e<c.length;e+=1){const t=c[e],r=s[e];t instanceof Error&&void 0===u&&(u=t,u.input=o[e]),i[r.toString()]=t}if(u)throw u;return c}),{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==n?.returnExceptions)throw e}return Object.keys(i).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>i[parseInt(e,10)]))}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class jh extends Ah{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=Ld(t),n=await jd(r),i=await(n?.handleChainStart(this.toJSON(),kh(e,"input"),r.runId,void 0,void 0,void 0,r?.runName));delete r.runId;let a,s=e;try{const e=[this.first,...this.middle];for(let n=0;n<e.length;n+=1){const a=e[n].invoke(s,Md(r,{callbacks:i?.getChild(`seq:step:${n+1}`)}));s=await gd(a,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");a=await this.last.invoke(s,Md(r,{callbacks:i?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(kh(a,"output"))),a}async batch(e,t,r){const n=this._getOptionsList(t??{},e.length),i=await Promise.all(n.map(jd)),a=await Promise.all(i.map((async(t,r)=>{const i=await(t?.handleChainStart(this.toJSON(),kh(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName));return delete n[r].runId,i})));let s=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e].batch(s,a.map(((t,r)=>{const i=t?.getChild(`seq:step:${e+1}`);return Md(n[r],{callbacks:i})})),r);s=await gd(t,n[0]?.signal)}}catch(e){throw await Promise.all(a.map((t=>t?.handleChainError(e)))),e}return await Promise.all(a.map((e=>e?.handleChainEnd(kh(s,"output"))))),s}async*_streamIterator(e,t){const r=await jd(t),{runId:n,...i}=t??{},a=await(r?.handleChainStart(this.toJSON(),kh(e,"input"),n,void 0,void 0,void 0,i?.runName)),s=[this.first,...this.middle,this.last];let o,l=!0;try{let r=s[0].transform(async function*(){yield e}(),Md(i,{callbacks:a?.getChild("seq:step:1")}));for(let e=1;e<s.length;e+=1){const t=s[e];r=await t.transform(r,Md(i,{callbacks:a?.getChild(`seq:step:${e+1}`)}))}for await(const e of r)if(t?.signal?.throwIfAborted(),yield e,l)if(void 0===o)o=e;else try{o=bd(o,e)}catch(e){o=void 0,l=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(kh(o,"output")))}getGraph(e){const t=new Eh;let r=null;return this.steps.forEach(((n,i)=>{const a=n.getGraph(e);0!==i&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const s=a.firstNode();if(!s)throw new Error(`Runnable ${n} has no first node`);r&&t.addEdge(r,s),r=a.lastNode()})),t}pipe(e){return jh.isRunnableSequence(e)?new jh({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new jh({first:this.first,middle:[...this.middle,this.last],last:Dh(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Ah.isRunnable(e)}static from([e,...t],r){return new jh({first:Dh(e),middle:t.slice(0,-1).map(Dh),last:Dh(t[t.length-1]),name:r})}}class Nh extends Ah{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Dh(r)}static from(e){return new Nh({steps:e})}async invoke(e,t){const r=Ld(t),n=await jd(r),i=await(n?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName));delete r.runId;const a={};try{const n=Object.entries(this.steps).map((async([t,n])=>{a[t]=await n.invoke(e,Md(r,{callbacks:i?.getChild(`map:key:${t}`)}))}));await gd(Promise.all(n),t?.signal)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(a)),a}async*_transform(e,t,r){const n={...this.steps},i=vd(e,Object.keys(n).length),a=new Map(Object.entries(n).map((([e,n],a)=>{const s=n.transform(i[a],Md(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then((t=>({key:e,gen:s,result:t})))]})));for(;a.size;){const e=Promise.race(a.values()),{key:t,result:n,gen:i}=await gd(e,r?.signal);a.delete(t),n.done||(yield{[t]:n.value},a.set(t,i.next().then((e=>({key:t,gen:i,result:e})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=Ld(t),n=new wd({generator:this.transform(async function*(){yield e}(),r),config:r});return await n.setup,yd.fromAsyncGenerator(n)}}class $h extends Ah{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!ic(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),n=await jd(r);return gd(this.func(Md(r,{callbacks:n}),e),r?.signal)}async*_streamIterator(e,t){const[r]=this._getOptionsList(t??{},1),n=await this.invoke(e,t);var i;if(Sh(n))for await(const e of n)r?.signal?.throwIfAborted(),yield e;else if(null!=(i=n)&&"object"==typeof i&&"next"in i&&"function"==typeof i.next)for(;;){r?.signal?.throwIfAborted();const e=n.next();if(e.done)break;yield e.value}else yield n}static from(e){return new $h({func:e})}}class Lh extends Ah{static lc_name(){return"RunnableLambda"}constructor(e){if(ic(e.func))return $h.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if(ic(e))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new Lh({func:e})}async _invoke(e,t,r){return new Promise(((n,i)=>{const a=Md(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});fd.runWithConfig(a,(async()=>{try{let r=await this.func(e,{...a});if(r&&Ah.isRunnable(r)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");r=await r.invoke(e,{...a,recursionLimit:(a.recursionLimit??25)-1})}else if(Sh(r)){let e;for await(const n of Oh(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=n;else try{e=bd(e,n)}catch(t){e=n}r=e}else if(Th(r)){let e;for(const n of Ph(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=n;else try{e=bd(e,n)}catch(t){e=n}r=e}n(r)}catch(e){i(e)}}))}))}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){let n;for await(const t of e)if(void 0===n)n=t;else try{n=bd(n,t)}catch(e){n=t}const i=Md(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??25)-1}),a=await new Promise(((e,t)=>{fd.runWithConfig(i,(async()=>{try{const t=await this.func(n,{...i,config:i});e(t)}catch(e){t(e)}}))}));if(a&&Ah.isRunnable(a)){if(0===r?.recursionLimit)throw new Error("Recursion limit reached.");const e=await a.stream(n,i);for await(const t of e)yield t}else if(Sh(a))for await(const e of Oh(i,a))r?.signal?.throwIfAborted(),yield e;else if(Th(a))for(const e of Ph(i,a))r?.signal?.throwIfAborted(),yield e;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=Ld(t),n=new wd({generator:this.transform(async function*(){yield e}(),r),config:r});return await n.setup,yd.fromAsyncGenerator(n)}}class Mh extends Ah{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=Ld(t),n=await jd(t),{runId:i,...a}=r,s=await(n?.handleChainStart(this.toJSON(),kh(e,"input"),i,void 0,void 0,void 0,a?.runName));let o;for(const t of this.runnables()){r?.signal?.throwIfAborted();try{const r=await t.invoke(e,Md(a,{callbacks:s?.getChild()}));return await(s?.handleChainEnd(kh(r,"output"))),r}catch(e){void 0===o&&(o=e)}}if(void 0===o)throw new Error("No error stored at end of fallback.");throw await(s?.handleChainError(o)),o}async*_streamIterator(e,t){const r=Ld(t),n=await jd(t),{runId:i,...a}=r,s=await(n?.handleChainStart(this.toJSON(),kh(e,"input"),i,void 0,void 0,void 0,a?.runName));let o,l,c;for(const t of this.runnables()){r?.signal?.throwIfAborted();const n=Md(a,{callbacks:s?.getChild()});try{l=await t.stream(e,n);break}catch(e){void 0===o&&(o=e)}}if(void 0===l){const e=o??new Error("No error stored at end of fallback.");throw await(s?.handleChainError(e)),e}try{for await(const e of l){yield e;try{c=void 0===c?c:bd(c,e)}catch(e){c=void 0}}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(kh(c,"output")))}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");const n=this._getOptionsList(t??{},e.length),i=await Promise.all(n.map((e=>jd(e)))),a=await Promise.all(i.map((async(t,r)=>{const i=await(t?.handleChainStart(this.toJSON(),kh(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName));return delete n[r].runId,i})));let s;for(const t of this.runnables()){n[0].signal?.throwIfAborted();try{const i=await t.batch(e,a.map(((e,t)=>Md(n[t],{callbacks:e?.getChild()}))),r);return await Promise.all(a.map(((e,t)=>e?.handleChainEnd(kh(i[t],"output"))))),i}catch(e){void 0===s&&(s=e)}}if(!s)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(a.map((e=>e?.handleChainError(s)))),s}}function Dh(e){if("function"==typeof e)return new Lh({func:e});if(Ah.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,n]of Object.entries(e))t[r]=Dh(n);return new Nh({steps:t})}}class Uh extends Ah{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Nh&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const n=this.mapper.getStepsKeys(),[i,a]=vd(e),s=this.mapper.transform(a,Md(r,{callbacks:t?.getChild()})),o=s.next();for await(const e of i){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!n.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of s)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=Ld(t),n=new wd({generator:this.transform(async function*(){yield e}(),r),config:r});return await n.setup,yd.fromAsyncGenerator(n)}}class Fh extends Ah{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const r=Ld(t),n=new wd({generator:this.transform(async function*(){yield e}(),r),config:r});return await n.setup,yd.fromAsyncGenerator(n)}}class Vh extends Ih{constructor(e){super({bound:jh.from([Lh.from((async e=>{let t;if((r=e)&&"object"==typeof r&&"type"in r&&"tool_call"===r.type)try{t=await this.schema.parseAsync(e.args)}catch(t){throw new Nu("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;var r;return t})).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}class Bh{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=void 0!==e.pageContent?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}class Zh extends Ac{}class Hh extends Zh{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Ku(this.value)]}}class Gh extends Zh{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return ed(this.messages)}toChatMessages(){return this.messages}}function zh(e,t){const r=new ReadableStream({async start(r){const n=function(e,t,r){let n={data:"",event:"",id:"",retry:void 0};const i=new TextDecoder;return function(a,s,o){if(o)(function(e){return""===e.data&&""===e.event&&""===e.id&&void 0===e.retry})(n)||(e?.(n),n={data:"",event:"",id:"",retry:void 0});else if(0===a.length)e?.(n),n={data:"",event:"",id:"",retry:void 0};else if(s>0){const e=i.decode(a.subarray(0,s)),o=s+(32===a[s+1]?2:1),l=i.decode(a.subarray(o));switch(e){case"data":n.data=n.data?n.data+"\n"+l:l;break;case"event":n.event=l;break;case"id":t?.(n.id=l);break;case"retry":{const e=parseInt(l,10);Number.isNaN(e)||r?.(n.retry=e);break}}}}}((e=>{if("error"===e.event)throw new Error(e.data??"Unspecified event streaming error.");"metadata"===e.event?t?.(e):e.data&&r.enqueue(e.data)}));await async function(e,t){if(e instanceof ReadableStream){const r=e.getReader();for(;;){const e=await r.read();if(e.done){t(new Uint8Array,!0);break}t(e.value)}}else try{for await(const r of e)t(new Uint8Array(r));t(new Uint8Array,!0)}catch(e){throw new Error(["Parsing event source stream failed.","Ensure your implementation of fetch returns a web or Node readable stream.",`Error: ${e.message}`].join("\n"))}}(e,function(e){let t,r,n,i=!1;return function(a,s){if(s)return void e(a,0,!0);void 0===t?(t=a,r=0,n=-1):t=function(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(t,a);const o=t.length;let l=0;for(;r<o;){i&&(10===t[r]&&(l=++r),i=!1);let a=-1;for(;r<o&&-1===a;++r)switch(t[r]){case 58:-1===n&&(n=r-l);break;case 13:i=!0;case 10:a=r}if(-1===a)break;e(t.subarray(l,a),n),l=r,n=-1}l===o?t=void 0:0!==l&&(t=t.subarray(l),r-=l)}}(((e,t,i)=>{n(e,t,i),i&&r.close()})))}});return yd.fromReadableStream(r)}function Wh(e,t){for(const r of t)if(!e.has(r))return!1;return!0}function qh(e){if(Array.isArray(e))return e.map(qh);if("object"==typeof e){if(!e||e instanceof Date)return e;const t=Object.keys(e),r=new Set(t);if(Wh(r,new Set(["page_content","metadata"])))return new Bh({pageContent:e.page_content,metadata:e.metadata});if(Wh(r,new Set(["content","type","additional_kwargs"]))){if("HumanMessage"===e.type||"human"===e.type)return new Ku({content:e.content});if("SystemMessage"===e.type||"system"===e.type)return new Yu({content:e.content});if("ChatMessage"===e.type||"generic"===e.type)return new zu({content:e.content,role:e.role});if("FunctionMessage"===e.type||"function"===e.type)return new qu({content:e.content,name:e.name});if("ToolMessage"===e.type||"tool"===e.type)return new Bu({content:e.content,tool_call_id:e.tool_call_id,status:e.status});if("AIMessage"===e.type||"ai"===e.type)return new Hu({content:e.content});if("HumanMessageChunk"===e.type)return new Xu({content:e.content});if("SystemMessageChunk"===e.type)return new Qu({content:e.content});if("ChatMessageChunk"===e.type)return new Wu({content:e.content,role:e.role});if("FunctionMessageChunk"===e.type)return new Ju({content:e.content,name:e.name});if("ToolMessageChunk"===e.type)return new Zu({content:e.content,tool_call_id:e.tool_call_id,status:e.status});if("AIMessageChunk"===e.type)return new Gu({content:e.content})}if(Wh(r,new Set(["text","generation_info","type"]))){if("ChatGenerationChunk"===e.type)return new Ad({message:qh(e.message),text:e.text,generationInfo:e.generation_info});if("ChatGeneration"===e.type)return{message:qh(e.message),text:e.text,generationInfo:e.generation_info};if("GenerationChunk"===e.type)return new kd({text:e.text,generationInfo:e.generation_info});if("Generation"===e.type)return{text:e.text,generationInfo:e.generation_info}}if(Wh(r,new Set(["tool","tool_input","log","type"]))&&"AgentAction"===e.type)return{tool:e.tool,toolInput:e.tool_input,log:e.log};if(Wh(r,new Set(["return_values","log","type"]))&&"AgentFinish"===e.type)return{returnValues:e.return_values,log:e.log};if(Wh(r,new Set(["generations","run","type"]))&&"LLMResult"===e.type)return{generations:qh(e.generations),llmOutput:e.llm_output,[Od]:e.run};if(Wh(r,new Set(["messages"])))return new Gh({messages:e.messages.map((e=>qh(e)))});if(Wh(r,new Set(["text"])))return new Hh(e.text);const n=t=>[t,qh(e[t])];return Object.fromEntries(t.map(n))}return e}function Jh(e){const t={...e};return delete t.callbacks,delete t.signal,t}function Kh(e){if(Array.isArray(e))return e.map(Kh);if(t=e,"function"==typeof t?._getType){const t={content:e.content,type:e._getType(),additional_kwargs:e.additional_kwargs,name:e.name,example:!1};return Bu.isInstance(e)?t.tool_call_id=e.tool_call_id:zu.isInstance(e)&&(t.role=e.role),t}var t;if("object"==typeof e){if(!e||e instanceof Date)return e;const t=Object.keys(e),r=t=>[t,Kh(e[t])];return Object.fromEntries(t.map(r))}return e}class Xh extends Ah{constructor(e){super(e),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:(...e)=>fetch(...e)}),Object.defineProperty(this,"fetchRequestOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable","remote"]});const{url:t,options:r,fetch:n,fetchRequestOptions:i}=e;this.url=t.replace(/\/$/,""),this.options=r,this.fetchImplementation=n??this.fetchImplementation,this.fetchRequestOptions=i}async post(e,t,r){return this.fetchImplementation(`${this.url}${e}`,{method:"POST",body:JSON.stringify(Kh(t)),signal:r??AbortSignal.timeout(this.options?.timeout??6e4),...this.fetchRequestOptions,headers:{"Content-Type":"application/json",...this.fetchRequestOptions?.headers,...this.options?.headers}})}async _invoke(e,t,r){const[n,i]=this._separateRunnableConfigFromCallOptions(t),a=await this.post("/invoke",{input:e,config:Jh(n),kwargs:i??{}},n.signal);if(!a.ok)throw new Error(`${a.status} Error: ${await a.text()}`);return qh((await a.json()).output)}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,n){if(n?.returnExceptions)throw new Error("returnExceptions is not supported for remote clients");const i=t?.map((e=>this._separateRunnableConfigFromCallOptions(e))),[a,s]=i?.reduce((([e,t],[r,n])=>[[...e,r],[...t,n]]),[[],[]])??[void 0,void 0],o=await this.post("/batch",{inputs:e,config:(a??[]).map(Jh).map((e=>({...e,...n}))),kwargs:s},t?.[0]?.signal);if(!o.ok)throw new Error(`${o.status} Error: ${await o.text()}`);const l=await o.json();if(!l.output)throw new Error("Invalid response from remote runnable");return qh(l.output)}async batch(e,t,r){if(r?.returnExceptions)throw Error("returnExceptions is not supported for remote clients");return this._batchWithConfig(this._batch.bind(this),e,t,r)}async*_streamIterator(e,t){const[r,n]=this._separateRunnableConfigFromCallOptions(t),i=await jd(t),a=await(i?.handleChainStart(this.toJSON(),kh(e,"input"),r.runId,void 0,void 0,void 0,r.runName));let s;delete r.runId;let o=!0;try{const t=await this.post("/stream",{input:e,config:Jh(r),kwargs:n},r.signal);if(!t.ok){const e=await t.json(),r=new Error(`RemoteRunnable call failed with status code ${t.status}: ${e.message}`);throw r.response=t,r}const{body:i}=t;if(!i)throw new Error("Could not begin remote stream. Please check the given URL and try again.");const a=zh(i);for await(const e of a){const t=(l=e,qh(JSON.parse(l)));if(yield t,o)if(void 0===s)s=t;else try{s=bd(s,t)}catch{s=void 0,o=!1}}}catch(e){throw await(a?.handleChainError(e)),e}var l;await(a?.handleChainEnd(s??{}))}async*streamLog(e,t,r){const[n,i]=this._separateRunnableConfigFromCallOptions(t),a=await jd(t),s=await(a?.handleChainStart(this.toJSON(),kh(e,"input"),n.runId,void 0,void 0,void 0,n.runName));delete n.runId;const o={include_names:r?.includeNames,include_types:r?.includeTypes,include_tags:r?.includeTags,exclude_names:r?.excludeNames,exclude_types:r?.excludeTypes,exclude_tags:r?.excludeTags};let l;try{const t=await this.post("/stream_log",{input:e,config:Jh(n),kwargs:i,...o,diff:!1},n.signal),{body:r,ok:a}=t;if(!a)throw new Error(`${t.status} Error: ${await t.text()}`);if(!r)throw new Error("Could not begin remote stream log. Please check the given URL and try again.");const s=zh(r);for await(const e of s){const t=qh(JSON.parse(e)),r=new _d({ops:t.ops});yield r,l=void 0===l?xd.fromRunLogPatch(r):l.concat(r)}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(l?.state.final_output))}_streamEvents(e,t,r){const n=this;return async function*(){const[i,a]=n._separateRunnableConfigFromCallOptions(t),s=await jd(t),o=await(s?.handleChainStart(n.toJSON(),kh(e,"input"),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;const l={include_names:r?.includeNames,include_types:r?.includeTypes,include_tags:r?.includeTags,exclude_names:r?.excludeNames,exclude_types:r?.excludeTypes,exclude_tags:r?.excludeTags},c=[];try{const t=await n.post("/stream_events",{input:e,config:Jh(i),kwargs:a,...l,diff:!1},i.signal),{body:r,ok:s}=t;if(!s)throw new Error(`${t.status} Error: ${await t.text()}`);if(!r)throw new Error("Could not begin remote stream events. Please check the given URL and try again.");const o=zh(r);for await(const e of o){const t=qh(JSON.parse(e)),r={event:t.event,name:t.name,run_id:t.run_id,tags:t.tags,metadata:t.metadata,data:t.data};yield r,c.push(r)}}catch(e){throw await(o?.handleChainError(e)),e}await(o?.handleChainEnd(c))}()}streamEvents(e,t,r){if("v1"!==t.version&&"v2"!==t.version)throw new Error('Only versions "v1" and "v2" of the events schema is currently supported.');if(void 0!==t.encoding)throw new Error("Special encodings are not supported for this runnable.");const n=this._streamEvents(e,t,r);return yd.fromAsyncGenerator(n)}}function Yh(e){return Yh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yh(e)}function Qh(){Qh=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var a=t&&t.prototype instanceof y?t:y,s=Object.create(a.prototype),o=new I(n||[]);return i(s,"_invoke",{value:P(e,r,o)}),s}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",p="suspendedYield",m="executing",f="completed",g={};function y(){}function v(){}function b(){}var w={};c(w,s,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(C([])));x&&x!==r&&n.call(x,s)&&(w=x);var E=b.prototype=y.prototype=Object.create(w);function T(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function r(i,a,s,o){var l=d(e[i],e,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==Yh(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,o)}))}o(l.arg)}var a;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function P(t,r,n){var i=h;return function(a,s){if(i===m)throw Error("Generator is already running");if(i===f){if("throw"===a)throw s;return{value:e,done:!0}}for(n.method=a,n.arg=s;;){var o=n.delegate;if(o){var l=O(o,n);if(l){if(l===g)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var c=d(t,r,n);if("normal"===c.type){if(i=n.done?f:p,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=f,n.method="throw",n.arg=c.arg)}}}function O(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=d(i,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var s=a.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Yh(t)+" is not iterable")}return v.prototype=b,i(E,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:v,configurable:!0}),v.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(S.prototype),c(S.prototype,o,(function(){return this})),t.AsyncIterator=S,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var s=new S(u(e,r,n,i),a);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},T(E),c(E,l,"Generator"),c(E,s,(function(){return this})),c(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return o.type="throw",o.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var l=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function ep(e){return function(e){if(Array.isArray(e))return ip(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||np(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tp(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,i)}function rp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,s,o=[],l=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(o.push(n.value),o.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(e,t)||np(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function np(e,t){if(e){if("string"==typeof e)return ip(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ip(e,t):void 0}}function ip(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ap(e){var r=e.logoSrc,i=e.chatInterfaceColor,a=void 0===i?"#FFFFFF":i,s=e.chatbotId,o=rp((0,t.useState)(!1),2),l=o[0],c=o[1],p=rp((0,t.useState)(!1),2),m=p[0],f=p[1],g=rp((0,t.useState)([{role:"bot",content:"Bonjour! Comment puis-je vous aider aujourd'hui?",timestamp:new Date}]),2),y=g[0],v=g[1],b=rp((0,t.useState)(""),2),w=b[0],_=b[1],x=rp((0,t.useState)(null),2),E=x[0],T=x[1],S=rp((0,t.useState)(!1),2),P=S[0],O=S[1],k=rp((0,t.useState)("".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,11))),1)[0],I=(0,t.useMemo)((function(){var e="".concat("http://localhost:8000/chatbot/".replace(/\/+$/,""),"/").concat(s);return new Xh({url:e})}),[s]);(0,t.useEffect)((function(){var e=setInterval((function(){l||(f(!0),setTimeout((function(){return f(!1)}),3e3))}),5e3);return function(){return clearInterval(e)}}),[l]);var C=function(){var e,t=(e=Qh().mark((function e(){var t,r,n;return Qh().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w.trim()){e.next=20;break}return v((function(e){return[].concat(ep(e),[{role:"user",content:w,timestamp:new Date}])})),_(""),O(!0),e.prev=4,e.next=7,I.invoke({messages:[{type:"human",content:w.trim()}]},{configurable:{thread_id:k},version:"v1"});case 7:t=e.sent,n=(r=t).messages[r.messages.length-1].content,v((function(e){return[].concat(ep(e),[{role:"bot",content:n,timestamp:new Date}])})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Error:",e.t0),v((function(e){return[].concat(ep(e),[{role:"bot",content:"Je suis désolé, une erreur s'est produite. Veuillez réessayer.",timestamp:new Date}])}));case 17:return e.prev=17,O(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])})),function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){tp(a,n,i,s,o,"next",e)}function o(e){tp(a,n,i,s,o,"throw",e)}s(void 0)}))});return function(){return t.apply(this,arguments)}}();return n().createElement(n().Fragment,null,n().createElement("div",{className:"fixed bottom-4 right-4 flex items-end"},n().createElement(A,null,m&&!l&&n().createElement(ks.div,{initial:{opacity:0,scale:.5,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.5,y:20},transition:{type:"spring",stiffness:500,damping:30},className:"mb-2 mr-2 bg-blue-500 text-white p-3 rounded-lg shadow-lg",style:{width:"200px",minHeight:"60px",display:"flex",alignItems:"center",justifyContent:"center"}},n().createElement("span",{className:"text-center"},"Avez-vous besoin d'aide?"))),n().createElement("button",{onClick:function(){return c(!0)},className:"w-16 h-16 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-colors overflow-hidden flex-shrink-0"},n().createElement("img",{src:r,alt:"Chat",className:"w-full h-full object-cover",onError:function(e){e.currentTarget.onerror=null,e.currentTarget.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>'}}))),l&&n().createElement("div",{className:"fixed bottom-4 right-4 w-full max-w-sm rounded-lg overflow-hidden",style:{backgroundColor:a,boxShadow:"0 -10px 40px -15px rgba(0, 0, 0, 0.3), 0 25px 50px -12px rgba(0, 0, 0, 0.25)"}},n().createElement("div",{className:"flex items-center justify-between p-4 border-b",style:{backgroundColor:a}},n().createElement("div",{className:"flex items-center space-x-2"},n().createElement("img",{src:r,alt:"C",className:"w-10 h-10 rounded-full"}),n().createElement("div",null,n().createElement("h2",{className:"font-bold text-lg text-black",style:{fontFamily:"Cursive, sans-serif"}},"ChatBot"),n().createElement("p",{className:"text-sm text-gray-500"},"Online"))),n().createElement("button",{onClick:function(){return c(!1)},className:"text-gray-500 hover:text-gray-700"},n().createElement(u,{size:24}))),n().createElement("div",{className:"h-96 overflow-y-auto p-4 space-y-4",style:{backgroundColor:"#e9edf3"}},y.map((function(e,t){return n().createElement("div",{key:t,className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),onMouseEnter:function(){return T(t)},onMouseLeave:function(){return T(null)}},n().createElement("div",{className:"relative max-w-xs px-4 py-2 rounded-lg ".concat("user"===e.role?"bg-blue-500 text-white":"bg-white text-gray-800")},"bot"===e.role&&n().createElement("img",{src:r,alt:"C",className:"absolute -top-2 -left-2 w-6 h-6 rounded-full border-2 border-white"}),n().createElement("p",{className:"bot"===e.role?"ml-4":""},(i=e.content,a=/\*\*(.*?)\*\*/g,s=/(https?:\/\/[^\s]+)/g,i.split("\n").map((function(e,t){return n().createElement(n().Fragment,{key:t},e.split(a).map((function(e,t){return t%2==1?n().createElement("strong",{key:t},e):e.split(s).map((function(e,t){return s.test(e)?n().createElement("a",{key:t,href:e,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline"},e):e}))})),t<i.split("\n").length-1&&n().createElement("br",null))})))),E===t&&n().createElement("div",{className:"absolute bottom-full left-0 mb-1 px-2 py-1 bg-gray-700 text-white text-xs rounded"},e.timestamp.toLocaleTimeString())));var i,a,s})),P&&n().createElement("div",{className:"flex justify-start"},n().createElement("div",{className:"bg-gray-200 text-gray-800 rounded-lg px-4 py-2"},n().createElement(ks.div,{className:"flex space-x-1",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},n().createElement(ks.span,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:.6,ease:"easeInOut"}},"•"),n().createElement(ks.span,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:.6,ease:"easeInOut",delay:.2}},"•"),n().createElement(ks.span,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:.6,ease:"easeInOut",delay:.4}},"•"))))),n().createElement("div",{className:"border-t p-4",style:{backgroundColor:a}},n().createElement("div",{className:"flex items-center bg-gray-100 rounded-full"},n().createElement("input",{type:"text",value:w,onChange:function(e){return _(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),C())},placeholder:"Saisissez votre message ici",className:"flex-grow px-4 py-2 bg-transparent focus:outline-none text-black"}),n().createElement("button",{onClick:C,className:"p-2 text-blue-500 hover:text-blue-600 transition-colors"},n().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6"},n().createElement("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})))),n().createElement("div",{className:"flex justify-between items-center mt-2"},n().createElement("a",{href:"https://www.dataunboxed.io",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-gray-500 hover:text-blue-500"},"Powered by DataUnboxed"),n().createElement("div",{className:"flex space-x-2"},n().createElement("button",{className:"text-gray-500 hover:text-blue-500"},n().createElement(d,{size:16})),n().createElement("button",{className:"text-gray-500 hover:text-red-500"},n().createElement(h,{size:16})))))))}console.log("webflow-bundle.js loaded"),window.renderChatButton=function(e,t){console.log("renderChatButton called",e,t);var r=document.getElementById(e);r?(console.log("Container found, rendering ChatButton"),a().render(n().createElement(ap,t),r)):console.error("Container not found:",e)}})()})();